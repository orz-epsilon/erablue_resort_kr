

@ダンジョン初期処理_幻想郷紅魔異変
;ダンジョン構造の読み込み
;0でない時、そのマスは存在する
#DIM 深度
#DIM 分岐

ダンジョンサブタイトル = THE MIST OF SCARLET
ダンジョンマス画像URL_伏せ状態 = 壁_森
ダンジョン現在位置:0 = 0
ダンジョン現在位置:1 = 4
ダンジョン背景画像 = 背景_紅い霧砂浜

;スタート地点は必ず存在
;初期からオープン済みなので3を入れる
;ビット0：存在するか　ビット1：移動できるか　ビット2：マスをオープンするか（ビット１をONにしないと無意味）　ビット3：入れないがオープンする場合に使用
;ビット4以降：自由枠。主に宝箱の開閉やイベント達成フラグなどに使用
IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:{ダンジョン現在位置:0}:{ダンジョン現在位置:1}") == 0
	SETVAR @"ダンジョン構造配列_%ダンジョン名%:{ダンジョン現在位置:0}:{ダンジョン現在位置:1}", 3
ENDIF

FOR 深度, 1, 100
	LOCAL = 0
	FOR 分岐, 0, 9
		IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:{深度}:{分岐}")
			;既にマス情報が入ってるなら飛ばす
			LOCAL = 1
			CONTINUE
		ELSEIF ENUMFUNCBEGINSWITH(@"ダンジョンマス情報_%ダンジョン名%_{深度}_{分岐}")
			LOCAL = 1
			SETVAR @"ダンジョン構造配列_%ダンジョン名%:深度:分岐", 1
		ENDIF
	NEXT
	IF LOCAL
		ダンジョン最大深度 = 深度
	ENDIF
NEXT

@ダンジョン解説文_幻想郷紅魔異変

詳細文文字列受け渡し変数 = 
詳細文文字列受け渡し変数 += "붉은 안개가 리조트에 발생하여 운영에 지장이 생겼다.<br>"
詳細文文字列受け渡し変数 += "당신은 안개를 해소하기 위해 이세계의 문을 통과했다.<br>"
詳細文文字列受け渡し変数 += "「환상향」이라 불리는 이세계에서, 해결책을 찾아 탐색한다.<br>"
詳細文文字列受け渡し変数 += "<br>"
詳細文文字列受け渡し変数 += "던전 출전: 동방project<br>"

;推奨レベルを返す
RETURN 16

@敵討伐後処理_ダンジョン固有_幻想郷紅魔異変(討伐エネミー数)
#DIM 討伐エネミー数
;ダンジョン内で戦闘した後に呼ばれる関数、主にダンジョンごとのドロップアイテム取得に使用
;今回アイテムドロップはないので記述なし

;---------------------------------------------------------------------
;固有戦闘開始時処理
;---------------------------------------------------------------------
;霊夢と魔理沙の加勢バフ
;---------------------------------------------------------------------
@固有戦闘開始時処理_特殊_霊夢の助力_紅魔事変()
;ここ２行はエラー回避のためのもの。おまじない程度においておくこと
戦闘行動キャラ = 0
CALL アビ対象選択テンプレート_自己のみ
;バフ付け文章は出さないので1を入れておく
アビテンプレート用_アビ名表示済フラグ = 1
;大元のバフセット（効果なし）
CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 레이무의 조력_홍마사변
アビ汎用文字列:バフ・デバフ対象能力 = 레이무의 조력_홍마사변
アビ汎用変数:持続ターン = -1
アビ汎用変数:消去不可オプション = 1
アビ汎用変数:特殊表示オプション = 1
アビ汎用文字列:適用範囲 = 아군 전체
CALL アビテンプレート_有利効果_バフ効果セット
;回避UP部分
CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 레이무의 조력_홍마사변_회피율
アビ汎用文字列:バフ・デバフ対象能力 = 회피율
アビ汎用変数:効果量 = 15
アビ汎用文字列:適用範囲 = 아군 전체
CALL アビテンプレート_有利効果_付随バフ効果セット("霊夢の助力_紅魔事変")
;カウンター部分
CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 레이무의 조력_홍마사변_원호공격
アビ汎用文字列:バフ・デバフ対象能力 = 특수반응_회피 시
アビ汎用文字列:適用範囲 = 아군 전체
CALL アビテンプレート_有利効果_付随バフ効果セット("霊夢の助力_紅魔事変")

;メッセージは出さないのでここでリセット
CALL アビテンプレ変数リセット

@特殊反応_回避時_霊夢の助力_紅魔事変_援護攻撃(バフ番号, 攻撃者隊列, 回避記録順)
#DIM 回避記録順
#DIM 攻撃者隊列
#DIM バフ番号
#DIMS 立ち絵_霊夢

;立ち絵リソース記録に必要な画像のリソースを生成する
CALLF 顔グラ表示用文字列関数(キャラ検索("[楽園の素敵な巫女]博麗霊夢"),100,,,1,1)
立ち絵_霊夢 = %立ち絵リソース記録%

;顔グラ込みのセリフを出す
WSTR:(K++) = 「%TEXTR("거기!/빈틈투성이네/받았다!")%」
CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
CALL 口上変数初期化

;攻撃処理
CALL アビテンプレ変数リセット
CALL アビ対象選択テンプレート_指定(攻撃者隊列)
アビテンプレート用_アビ名 = 霊夢の援護攻撃

アビ汎用文字列:実行時メッセージ１ = 레이무의 원호 공격!
アビ汎用変数:効果量 = 500
CALL アビテンプレート_ダメージ処理_光属性

CALL アビテンプレート用_表示メッセージ変換処理
CALL メッセージ欄表示用関数(,,,0)
CALL 口上変数初期化

@バフ・デバフ特殊表示_霊夢の助力_紅魔事変(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 레이무의 조력
PRINTFORML 회피율+15%・회피 시 레이무가 원호 공격을 날린다 [삭제 불가]
PRINTFORML 지속 턴: 영구

@固有戦闘開始時処理_特殊_魔理沙の助力_紅魔事変()
;ここ２行はエラー回避のためのもの。おまじない程度においておくこと
戦闘行動キャラ = 0
CALL アビ対象選択テンプレート_自己のみ
;バフ付け文章は出さないので1を入れておく
アビテンプレート用_アビ名表示済フラグ = 1
;大元のバフセット（効果なし）
CALL アビ汎用変数文字列リセット
アビ汎用文字列:バフ・デバフ枠 = 마리사의 조력_홍마사변
アビ汎用文字列:バフ・デバフ対象能力 = 공격력
アビ汎用変数:効果割合 = 30
アビ汎用変数:持続ターン = -1
アビ汎用変数:消去不可オプション = 1
アビ汎用変数:特殊表示オプション = 1
アビ汎用文字列:適用範囲 = 아군 전체
CALL アビテンプレート_有利効果_バフ効果セット

;メッセージは出さないのでここでリセット
CALL アビテンプレ変数リセット

@バフ・デバフ特殊表示_魔理沙の助力_紅魔事変(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 마리사의 조력
PRINTFORML 공격력+30% [삭제 불가]
PRINTFORML 지속 턴: 영구

@固有戦闘開始時処理_特殊_霊夢と魔理沙の助力_紅魔事変()
CALL 固有戦闘開始時処理_特殊_霊夢の助力_紅魔事変()
CALL 固有戦闘開始時処理_特殊_魔理沙の助力_紅魔事変()

;---------------------------------------------------------------------
;マップ構造
;---------------------------------------------------------------------
;イベントミニマップなのでほぼ一本道、途中ちょっとだけ分岐
;---------------------------------------------------------------------

@ダンジョンマス情報_幻想郷紅魔異変_0_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 0
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "2_4")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			KSTR:(K++) = 붉은 안개가 자욱한 호반이다.
			CALL 再視聴確認(1)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			WSTR:(K++) = 이세계로 가는 문을 통과하여, 붉은 안개를 따라 나아가자 하나의 세계에 도착했다.
			WSTR:(K++) = 여기가 환상향인가.
			WSTR:(K++) = 주위에는 짙은 붉은 안개가 있어 잘 보이지 않지만…… 아무래도 호반인 것 같다.
			WSTR:(K++) = 당연하지만, 리조트와는 식생이나 공기가 전혀 다르다. 동쪽 공역에 있는 섬들과 비슷하다는 생각이 들지만…….
			WSTR:(K++) = 어쨌든 여기서는 이방인이다. 안개도 짙으니 조심해서 나아가자.
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_幻想郷紅魔異変_2_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 2
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "4_4")
	CASE "マスイベント"
		KSTR:(K++) = 꽤 큰 호수 같다. 냉기가 감돌아온다……
		CALL 接続ルート全開放処理(マス深度, マス分岐)
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_幻想郷紅魔異変_4_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 4
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "5_4")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 붉은 안개 속을, 새까만 구슬? 이, 날고 있다……
			WSTR:(K++) = 저것은 무엇일까. 단서도 없고, 쫓아가 볼까?
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 특히 주위에 특이한 점은 없다.
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_幻想郷紅魔異変_5_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 5
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "7_4")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			KSTR:(K++) = 검은 구슬의 소녀와 싸웠던 장소다.
			CALL 再視聴確認(0)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[宵闇の妖怪]ルーミア"),100,,,1,1)
			LOCALS = %立ち絵リソース記録%
			CALLF 任意顔グラ表示用文字列関数(キャラ検索("[宵闇の妖怪]ルーミア"),"顔_デフォルト_差分_表情",101)
			LOCALS:1 = %立ち絵リソース記録%
			WSTR:(K++) = 검은 구슬을 쫓아가다 보니, 숲을 만났다.
			WSTR:(K++) = 검은 구슬은, 나무에 닿아……
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「아야!」
			CALL メッセージ欄表示用関数(,"？？？",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ……하고, 검은 구슬 안에서, 목소리가 들려왔다 (쿵, 하고 아플 것 같은 소리도).
			WSTR:(K++) = 검은 구슬이 풀리듯이 사라지고, 안에서 이마를 누른 금발 소녀가 나타났다.
			WSTR:(K++) = 무언가 마법적인 수단으로 날고 있었던 걸까?
			WSTR:(K++) = 어쨌든, 아무래도 말은 통할 것 같다. 이야기를 들어보자.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「아야야……어라? 너는 누구야?」
			CALL メッセージ欄表示用関数(LOCALS:1,"黒い球の少女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 이 붉은 안개에 대해 조사하고 있는 자라고 답한다. 뭔가 짐작 가는 바는 없을까?
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「음~, 모르겠는데.
			WSTR:(K++) = 　이쪽에서도 물어봐도 될까?
			WSTR:(K++) = 　당신은, 잡아먹어도 되는 인류?」
			CALL メッセージ欄表示用関数(LOCALS,"黒い球の少女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ……소녀라고 생각했지만, 사람을 잡아먹는, 사람이 아닌 존재인 것 같다.
			WSTR:(K++) = 천진난만한 살기를 드러낸 검은 구슬의 소녀가 습격해왔다!
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
			敵BATTLE_STATE_STR:0:エネミー名 = Lv10_검은 구슬의 소녀
			CALL 雑魚敵遭遇汎用処理
			IF RESULT != 0 && GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
				CALL マス未踏破戻し処理(ダンジョン現在位置:0, ダンジョン現在位置:1)
				ダンジョン現在位置:0 = 4
				ダンジョン現在位置:1 = 4
				RETURN 0
			ENDIF
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;勝利後or読み返し中
			WSTR:(K++) = 어떻게든 소녀를 물리쳤다.
			WSTR:(K++) = 아무래도, 이 환상향에서는, 몸 하나로 비행하는 것이 일반적인 것 같다.
			WSTR:(K++) = 인적이 없는 것은, 방금 전 검은 구슬의 소녀와 같은 존재가 있을 수도 있겠지만, 사람들이 하늘을 날고 있기 때문일까……?
			WSTR:(K++) = 어쨌든, 변변한 단서는 되지 못했다. 다른 곳을 찾아보자.
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			LOCAL = GETVAR(@"ダンジョン構造配列_%ダンジョン名%:7:4")
			SETBIT LOCAL, 1
			SETBIT LOCAL, 2
			CLEARBIT LOCAL, 3
			SETVAR @"ダンジョン構造配列_%ダンジョン名%:7:4", LOCAL
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_幻想郷紅魔異変_7_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 7
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		;移動先Yと移動先Yを、移動先の位置に変更すること
		ダンジョン現在位置:0 = 8
		ダンジョン現在位置:1 = 4
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 接続ルート全開放処理(8, 4)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_幻想郷紅魔異変_8_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 8
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_4")
	CASE "マスイベント"
		;移動先Yと移動先Yを、移動先の位置に変更すること
		ダンジョン現在位置:0 = 7
		ダンジョン現在位置:1 = 4
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_幻想郷紅魔異変_10_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 10
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_4")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 상공을, 두 사람의 그림자가 지나가는 것이 보였다.
			WSTR:(K++) = 방금 전 검은 구슬의 소녀 건도 있지만……단서도 없다.
			WSTR:(K++) = 이번에야말로 우호적인 인물일지도 모르니, 쫓아가 보자.
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 이 앞에 두 사람의 그림자가 지나갔다.
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT




@ダンジョンマス情報_幻想郷紅魔異変_13_4(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_チルノ
#DIMS 立ち絵_魔理沙
#DIMS 立ち絵_霊夢
マス深度 = 13
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "14_2")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "14_6")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			KSTR:(K++) = 이곳은 레이무, 마리사와 만나 요정들과 싸웠던 장소다.
			KSTR:(K++) = 레이무와 함께 차를 마신다: A 칸으로
KSTR:(K++) = 날아간 마리사를 쫓아간다: B 칸으로
			CALL 再視聴確認(0)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[湖上の氷精]チルノ"),100,,,1,1)
			立ち絵_チルノ = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[普通の魔法使い]霧雨魔理沙"),101,,,1,1)
			立ち絵_魔理沙 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[楽園の素敵な巫女]博麗霊夢"),102,,,1,1)
			立ち絵_霊夢 = %立ち絵リソース記録%
WSTR:(K++) = 이것은 전투의 기척일까? 무언가가 파열하는 소리와 강한 냉기가 전해져 온다.
WSTR:(K++) = 어느 한쪽과는 우호적으로 접촉할 수 있을지도 모른다. 다가가 보자.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 「에잇, 이제 춥잖아! 냉방병 걸리겠어!」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"紅白の少女",,0)
			CALL 口上変数初期化
WSTR:(K++) = 「이건 반팔로는 몸에 안 좋다고!」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔女風の少女",,0)
			CALL 口上変数初期化
WSTR:(K++) = 「영국 소와 함께 냉동 보존될 각오는 되었을까!」
			CALL メッセージ欄表示用関数(立ち絵_チルノ,"青髪の童女",,0)
			CALL 口上変数初期化
WSTR:(K++) = 푸른 머리 소녀의 등에는 얼음 날개가 떠 있다. 아무래도 인간은 아닌 것 같다.
WSTR:(K++) = 마법인지, 자유자재로 얼음을 조종하고 있지만, 그다지 지성이 높아 보이지는 않는다.
WSTR:(K++) = 맞서는 두 소녀는…… 아마도…… 인간이다.
WSTR:(K++) = 가세하겠다고 두 소녀에게 말을 건다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 「맡길게, 추워 죽겠네!」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔女風の少女",,0)
			CALL 口上変数初期化
WSTR:(K++) = 「아, 그럼 부탁할게」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"紅白の少女",,0)
			CALL 口上変数初期化
WSTR:(K++) = ……맡겨질 때까지는 생각하지 못했네……!
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
			敵BATTLE_STATE_STR:0:エネミー名 = Lv12_얼음 날개를 가진 소녀
			敵BATTLE_STATE_STR:4:エネミー名 = Lv9_요정 같은 소녀
			CALL 雑魚敵遭遇汎用処理
			IF RESULT != 0 && GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
				CALL マス未踏破戻し処理(ダンジョン現在位置:0, ダンジョン現在位置:1)
				ダンジョン現在位置:0 = 10
				ダンジョン現在位置:1 = 4
				RETURN 0
			ENDIF
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			CALLF 顔グラ表示用文字列関数(キャラ検索("[普通の魔法使い]霧雨魔理沙"),101,,,1,1)
			立ち絵_魔理沙 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[楽園の素敵な巫女]博麗霊夢"),102,,,1,1)
			立ち絵_霊夢 = %立ち絵リソース記録%

			WSTR:(K++) = 「오오~, 꽤 하는구나」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"紅白の少女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「이 근처에서는 못 보던 얼굴이네?」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔女風の少女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 두 소녀는 각각 레이무, 마리사라고 자신을 소개했다.
			WSTR:(K++) = 짝짝, 하고 박수쳐 주는 두 사람에게 고개를 끄덕이며 설명한다.
			WSTR:(K++) = 이러저러해서, 이 환상향에 잠시 오게 되었는데…….
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「헤에, 관광지 경영자? 유람 같은 거 해보고 싶네~」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 마리사가 레이무를 가리키며, 한가하네, 라고 중얼거렸다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「알고 있어, 간다고 해도 이 이변이 끝난 후야.
			WSTR:(K++) = 　……라고 해도, 별다른 단서도 잡지 못했지만.
			WSTR:(K++) = 　왠지 이 근처인 것 같긴 해」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「안개도 이 근처가 가장 짙고 말이야.
			WSTR:(K++) = 　이 근처에, 무슨 일 있었나?」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「음~, 누가 저택째로 이사 왔던가……?」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 과연. 그 저택이라는 곳이 첫 번째 후보일까?
			WSTR:(K++) = 찾으면, 연락하는 게 좋을까……라고 해도, 연락 수단도 없지만.
			WSTR:(K++) = 둘 중 한 명을 따라가는 게 좋을까?
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「네가 해결해 줘도 상관없어」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「그럼 먼저 가는 사람이 임자겠네. 난 이쪽으로 갈게」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 말이 끝나기 무섭게 마리사는 빗자루를 타고 날아갔다.
			WSTR:(K++) = 레이무는 한숨을 쉬며 말한다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「아마 이쪽일 것 같긴 한데…… 몸이 좀 차가워졌네.
			WSTR:(K++) = 　일단 나는 차를 마시고 갈게」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 그렇게 말하며 레이무는 길가에 앉아 소매에서 대나무통을 꺼냈다.
			WSTR:(K++) = 모처럼 만난 우호적인 현지인이다. 두 사람 중 한 명을 따라가야 할 텐데…….
			WSTR:(K++) = 레이무와 함께 차를 마신다: A 칸으로
			WSTR:(K++) = 날아간 마리사를 쫓아간다: B 칸으로
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			LOCAL = GETVAR(@"ダンジョン構造配列_%ダンジョン名%:14:2")
			SETBIT LOCAL, 3
			SETVAR @"ダンジョン構造配列_%ダンジョン名%:14:2", LOCAL
			LOCAL = GETVAR(@"ダンジョン構造配列_%ダンジョン名%:14:6")
			SETBIT LOCAL, 3
			SETVAR @"ダンジョン構造配列_%ダンジョン名%:14:6", LOCAL
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_幻想郷紅魔異変_14_2(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_霊夢
#DIM 返答フラグ
マス深度 = 14
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原
		ダンジョンマス画像URL_重ね表示 = Ａマーク
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "15_2")
	CASE "マスイベント"
		IF 分岐封印判定(条件_クリア済み, "14-2", "14-6")
			KSTR:(K++) = 이 선택지는 던전 클리어까지 봉인되어 있습니다.
			;フラグをリセット
			LOCAL = GETVAR(@"ダンジョン構造配列_%ダンジョン名%:14:2")
			SETBIT LOCAL, 3
			CLEARBIT LOCAL, 2
			SETVAR @"ダンジョン構造配列_%ダンジョン名%:14:2", LOCAL
			CALL メッセージ欄表示用関数(,,,0)
			CALL 画面再描画
		ELSE
			RFLAG:ダンジョン再視聴フラグ = 0
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				SETBIT RFLAG:ダンジョン再視聴フラグ, 0
				SETBIT RFLAG:ダンジョン再視聴フラグ, 1
				SETBIT RFLAG:ダンジョン再視聴フラグ, 10
			ELSE
				KSTR:(K++) = 레이무와 함께 간다.
				CALL 再視聴確認(1)
			ENDIF
			IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
				;立ち絵リソース記録に必要な画像のリソースを生成する
				CALLF 顔グラ表示用文字列関数(キャラ検索("[楽園の素敵な巫女]博麗霊夢"),100,,,1,1)
				立ち絵_霊夢 = %立ち絵リソース記録%
				WSTR:(K++) = 「응? 무슨 일이야?」
				CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
				CALL 口上変数初期化
				KSTR:(K++) = 레이무를 따라가겠습니까?
				KSTR:(K++) = BUTTON_[예]
				KSTR:(K++) = BUTTON_[아니요]
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				$LOOP_MESSAGE
				INPUTS
				SELECTCASE RESULTS
					CASE "[예]"
						WSTR:(K++) = 지리도 모르고, 함께 가고 싶다고 레이무에게 고한다.
						WSTR:(K++) = 소녀는 별로 생각하는 기색도 없이, 아무래도 좋다는 듯 동행을 허락했다.
						CALL メッセージ欄表示用関数(,,,0)
						CALL 口上変数初期化
						WSTR:(K++) = 「상관없어. 헤어지면 두고 갈 거지만」
						CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
						CALL 口上変数初期化
						WSTR:(K++) = 차를 다 마신 레이무는 사뿐히 떠올라, %CALLNAME:PLAYER%는 한 번도 쳐다보지 않고 어딘가로 날아간다.
						WSTR:(K++) = 멍하니 있으면 정말로 버려질 것 같다. 바로 쫓아가자.
						CALL メッセージ欄表示用関数(,,,0)
						CALL 口上変数初期化
						返答フラグ = 1
					CASE "[아니요]"
						WSTR:(K++) = 아니, 조금 더 어느 쪽을 따라갈지 생각하자.
						WSTR:(K++) = 레이무에게는 아무것도 아니라고 답한다.
						CALL メッセージ欄表示用関数(,,,0)
						CALL 口上変数初期化
						WSTR:(K++) = 「뭐야, 이상한 녀석이네」
						WSTR:(K++) = 레이무는 다시 차를 마시기 시작했다…….`
						CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
						CALL 口上変数初期化
						返答フラグ = 2
					CASEELSE
						CLEARLINE 1
						REUSELASTLINE  
						GOTO LOOP_MESSAGE
				ENDSELECT
			ENDIF
			IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
				;戦闘部分
			ENDIF
			IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
				;再視聴では通らない報酬部分
				IF 返答フラグ == 1
					CALL 接続ルート全開放処理(マス深度, マス分岐)
					CALL 踏破マス開放処理(15, 2)
					CALL 分岐マス選択セット(マス深度, マス分岐)
				ELSEIF 返答フラグ == 2
					;いいえ時、フラグをリセット
					LOCAL = GETVAR(@"ダンジョン構造配列_%ダンジョン名%:14:2")
					SETBIT LOCAL, 3
					CLEARBIT LOCAL, 2
					SETVAR @"ダンジョン構造配列_%ダンジョン名%:14:2", LOCAL
				ENDIF
			ENDIF
			RFLAG:ダンジョン再視聴フラグ = 0
			CALL メッセージ欄表示用関数(,,,0)
			CALL 画面再描画
		ENDIF
ENDSELECT

@ダンジョンマス情報_幻想郷紅魔異変_14_6(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_魔理沙
#DIM 返答フラグ
マス深度 = 14
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

		ダンジョンマス画像URL_重ね表示 = Ｂマーク
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "15_6")
	CASE "マスイベント"
		IF 分岐封印判定(条件_クリア済み, "14-2", "14-6")
			KSTR:(K++) = 이 선택지는 던전 클리어까지 봉인되어 있습니다.
			;フラグをリセット
			LOCAL = GETVAR(@"ダンジョン構造配列_%ダンジョン名%:14:6")
			SETBIT LOCAL, 3
			CLEARBIT LOCAL, 2
			SETVAR @"ダンジョン構造配列_%ダンジョン名%:14:6", LOCAL
			CALL メッセージ欄表示用関数(,,,0)
			CALL 画面再描画
		ELSE
			RFLAG:ダンジョン再視聴フラグ = 0
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				SETBIT RFLAG:ダンジョン再視聴フラグ, 0
				SETBIT RFLAG:ダンジョン再視聴フラグ, 1
				SETBIT RFLAG:ダンジョン再視聴フラグ, 10
			ELSE
				KSTR:(K++) = 날아간 마리사를 쫓아간다.
				CALL 再視聴確認(1)
			ENDIF
			IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
				;立ち絵リソース記録に必要な画像のリソースを生成する
				CALLF 顔グラ表示用文字列関数(キャラ検索("[普通の魔法使い]霧雨魔理沙"),100,,,1,1)
				立ち絵_魔理沙 = %立ち絵リソース記録%
				KSTR:(K++) = 날아간 마리사를 쫓아갈까요?
				KSTR:(K++) = BUTTON_[예]
				KSTR:(K++) = BUTTON_[아니요]
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				$LOOP_MESSAGE
				INPUTS
				SELECTCASE RESULTS
					CASE "[예]"
						WSTR:(K++) = 지리도 모르고, 여기는 날아간 마리사를 쫓아가자.
						WSTR:(K++) = 하늘을 향해 손을 흔들며 쫓아가자, 눈치챈 마리사가 돌아와 주었다.
						WSTR:(K++) = 함께 가고 싶다고 전하자, 소녀는 흔쾌히 승낙해 준다.
						CALL メッセージ欄表示用関数(,,,0)
						CALL 口上変数初期化
						WSTR:(K++) = 「상관없어. 너도 꽤 하는 것 같고 말이야」
						CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
						CALL 口上変数初期化
						WSTR:(K++) = 마리사는 1m 정도의 높이로 날아, %CALLNAME:PLAYER%들에게 속도를 맞춰 준다.
						CALL メッセージ欄表示用関数(,,,0)
						CALL 口上変数初期化
						WSTR:(K++) = 「자, 가자. 차라도 내어주는 저택 찾으러」
						CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
						CALL 口上変数初期化
						返答フラグ = 1
					CASE "[아니요]"
						WSTR:(K++) = 아니, 조금 더 어느 쪽을 따라갈지 생각하자.
						CALL メッセージ欄表示用関数(,,,0)
						CALL 口上変数初期化
						返答フラグ = 2
					CASEELSE
						CLEARLINE 1
						REUSELASTLINE  
						GOTO LOOP_MESSAGE
				ENDSELECT
			ENDIF
			IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
				;戦闘部分
			ENDIF
			IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
				;再視聴では通らない報酬部分
				IF 返答フラグ == 1
					CALL 接続ルート全開放処理(マス深度, マス分岐)
					CALL 踏破マス開放処理(15, 6)
					CALL 分岐マス選択セット(マス深度, マス分岐)
				ELSEIF 返答フラグ == 2
					;いいえ時、フラグをリセット
					LOCAL = GETVAR(@"ダンジョン構造配列_%ダンジョン名%:14:6")
					SETBIT LOCAL, 3
					CLEARBIT LOCAL, 2
					SETVAR @"ダンジョン構造配列_%ダンジョン名%:14:6", LOCAL
				ENDIF
			ENDIF
			RFLAG:ダンジョン再視聴フラグ = 0
			CALL メッセージ欄表示用関数(,,,0)
			CALL 画面再描画
		ENDIF
ENDSELECT


@ダンジョンマス情報_幻想郷紅魔異変_15_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 15
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		;移動先Yと移動先Yを、移動先の位置に変更すること
		CALL 接続ルート全開放処理(16, 2)
		ダンジョン現在位置:0 = 16
		ダンジョン現在位置:1 = 2
		ダンジョンマス画像URL_伏せ状態 = 壁_街
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_幻想郷紅魔異変_15_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 15
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		;移動先Yと移動先Yを、移動先の位置に変更すること
		CALL 接続ルート全開放処理(16, 6)
		ダンジョン現在位置:0 = 16
		ダンジョン現在位置:1 = 6
		ダンジョンマス画像URL_伏せ状態 = 壁_街
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_幻想郷紅魔異変_16_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 16
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "18_2")
	CASE "マスイベント"
		;移動先Yと移動先Yを、移動先の位置に変更すること
		ダンジョン背景画像 = 背景_紅い霧砂浜
		ダンジョン現在位置:0 = 15
		ダンジョン現在位置:1 = 2
		ダンジョンマス画像URL_伏せ状態 = 壁_森
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_幻想郷紅魔異変_16_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 16
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_草原

		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "19_6")
	CASE "マスイベント"
		;移動先Yと移動先Yを、移動先の位置に変更すること
		ダンジョン背景画像 = 背景_紅い霧砂浜
		ダンジョン現在位置:0 = 15
		ダンジョン現在位置:1 = 6
		ダンジョンマス画像URL_伏せ状態 = 壁_森
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_幻想郷紅魔異変_18_2(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_霊夢
#DIMS 立ち絵_美鈴
マス深度 = 18
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_街

		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "21_4")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		ダンジョン背景画像 = 背景_紅い霧砂浜
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			KSTR:(K++) = 레이무와 함께 문지기인 홍 메이링과 싸웠다.
			CALL 再視聴確認(0)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[楽園の素敵な巫女]博麗霊夢"),100,,,1,1)
			立ち絵_霊夢 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[華人小娘]紅美鈴"),101,,,1,1)
			立ち絵_美鈴 = %立ち絵リソース記録%
			WSTR:(K++) = 레이무를 쫓아 호반을 가는 동안, 안개가 점점 짙어지고 있다는 것을 깨닫는다.
			WSTR:(K++) = 게다가, 뭔가…… 저택일까? 높은 담장의 그림자가 보이기 시작했다.
			WSTR:(K++) = 더욱 가까워지는 동안, 정면에 문도 보이기 시작한다.
			WSTR:(K++) = 그곳에는 이델바 왕국의 복장과 비슷한 의상을 입은 소녀가, 선 채로 졸고 있었다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「스피이…………」
			WSTR:(K++) = 깨우기 미안할 정도로, 행복하게 잠들어 있다……
			CALL メッセージ欄表示用関数(立ち絵_美鈴,"赤毛の少女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「이얏」
			WSTR:(K++) = 레이무는 주저 없이 고헤이로 붉은 머리 소녀를 때려 깨웠다!
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「음냐앗 안 잤어요 안 잤어요……라고, 어라, 손님이신가요?
			WSTR:(K++) = 　홍마관에 어서 오세요」
			CALL メッセージ欄表示用関数(立ち絵_美鈴,"赤毛の少女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 그녀는 고개를 흔들어, 정신을 바짝 차린 듯하다.
			WSTR:(K++) = 자세를 바로잡은 그녀에게, 붉은 안개에 대해 짐작 가는 것이 없는지 물어본다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「엣, 어떻게 아셨, 아니, 아, 없어요, 짐작 가는 거. 싫다 정말~」
			CALL メッセージ欄表示用関数(立ち絵_美鈴,"赤毛の少女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ……그것은 '뭔가 있다'는 얼굴과 목소리와 말처럼 느껴진다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「크윽, 들켰나……! 아가씨를 위해, 침입자를 통과시킬 수는 없어!」
			CALL メッセージ欄表示用関数(立ち絵_美鈴,"赤毛の少女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 아니 아직 침입할 거라고 결정하지도 않았는데……
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「무녀를 하는 평범한 사람을 붙잡고 침입자라니, 심한 요괴네.
			WSTR:(K++) = 　자, 어서 같이 때려눕히자고」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 붉은 머리 소녀가 습격해왔다!
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
			敵BATTLE_STATE_STR:0:エネミー名 = Lv14_붉은 머리 격투 소녀
			戦闘時_特殊処理フラグ = 霊夢の助力_紅魔事変
			CALL 雑魚敵遭遇汎用処理
			IF RESULT != 0 && GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
				CALL マス未踏破戻し処理(ダンジョン現在位置:0, ダンジョン現在位置:1)
				ダンジョン現在位置:0 = 16
				ダンジョン現在位置:1 = 2
				RETURN 0
			ENDIF
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[楽園の素敵な巫女]博麗霊夢"),100,,,1,1)
			立ち絵_霊夢 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[華人小娘]紅美鈴"),101,,,1,1)
			立ち絵_美鈴 = %立ち絵リソース記録%
			WSTR:(K++) = 「젠장, 배수진이다!」
			WSTR:(K++) = 말을 내뱉고, 소녀는 저택으로 달려간다.
			CALL メッセージ欄表示用関数(立ち絵_美鈴,"赤毛の少女",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「길 안내까지 해주다니 친절하네. 어서 빨리 가자」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 레이무는 낙관적으로 성큼성큼 나아간다.
			WSTR:(K++) = 하지만 저택에는 다른 인원도 있을 것이고, 그것이 방금 전 그녀처럼 싸울 수 있는 자일 가능성이 높다.
			WSTR:(K++) = 조심해서 나아가자. 설마, 혼자서 '진'이라고 말할 리도 없을 테고.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_幻想郷紅魔異変_19_6(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_魔理沙
#DIMS 立ち絵_パチュリー
#DIMS 立ち絵_小悪魔
マス深度 = 19
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_街

		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "21_4")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		ダンジョン背景画像 = 背景_紅魔館
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			KSTR:(K++) = 마리사와 함께 도서관에서 파츄리와 싸웠다.
			CALL 再視聴確認(0)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			ダンジョン背景画像 = 背景_紅い霧砂浜
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[普通の魔法使い]霧雨魔理沙"),100,,,1,1)
			立ち絵_魔理沙 = %立ち絵リソース記録%
			WSTR:(K++) = 마리사와 함께 호반을 걷는 동안, 안개가 점점 짙어지고 있다는 것을 깨닫는다.
			WSTR:(K++) = 게다가, 뭔가…… 저택일까? 높은 담장의 그림자가 보이기 시작했다.
			WSTR:(K++) = 더욱 가까이 다가가는 동안, 정면에 문도 보이기 시작한다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 하지만, 주위에는 아무도 없는 것 같다.
			WSTR:(K++) = 전투의 흔적이 남아있는 것을 보니, 먼저 레이무가 와 있었던 것일까?
			WSTR:(K++) = 문 너머에 있는 저택을 보니, 벽부터 지붕까지 새빨갛게 칠해져 있다. 아무리 봐도 수상하다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「방해할게ー. 겸사겸사 방해 외의 것도 할게」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 마리사는 겁먹지 않고 성큼성큼 저택 안으로 들어간다.
			WSTR:(K++) = 디자인으로 보아 붉은 안개와 무관하지 않은 것 같다. %CALLNAME:PLAYER%들도 마리사의 뒤를 이어, 저택으로 침입한다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			ダンジョン背景画像 = 背景_紅魔館
WSTR:(K++) = 저택에 침입하자, 묘한 위화감을 느낀다.
WSTR:(K++) = ……큰 저택이긴 했지만, 역시 외관에 비해 너무 넓다.
WSTR:(K++) = 천장은 넓고, 복도도 넓다――몸 하나로 날 수 있는 소녀들이라면, 공중전조차 가능할 것이다.
WSTR:(K++) = 만약 여기서 군세 같은 적에게 습격당하면 속수무책일 것이다.
WSTR:(K++) = 주의해서 나아가도록 하자……。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 발걸음을 옮기지만…………왠지, 아무도 없는 것 같다……
WSTR:(K++) = 이 넓이의 저택, 인구 밀도가 낮아지는 것은 알겠지만……
WSTR:(K++) = 어찌 됐든 침입자 상대로, 아무도 오지 않는다는 것은 괜찮은 걸까.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 그렇게 아무도 만나지 않고 저택 안을 배회하고 있자, 특이한 향기가 풍겨온다.
WSTR:(K++) = ……이것은, 홍차 향기일까……?
WSTR:(K++) = 아무래도, 근처 방에서 풍겨오는 것 같다.
WSTR:(K++) = 들어가 보도록 하자.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 문을 열고 들어가 보니, 도서관 같은 공간이 펼쳐져 있었다.
WSTR:(K++) = 어둡고, 곰팡이 냄새가 난다……정리도 제대로 되어 있지 않은 것 같다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 「와아, 책이 잔뜩 있어. 나중에 쓱 빌려가야지」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
			CALL 口上変数初期化
WSTR:(K++) = 침입자에게 빌려줄까? 같은 말을 하면서 걷고 있는데, 빙글빙글 회전하며 비행하는 책을 발견했다.
WSTR:(K++) = 이 환상향에서는 뭐든지 날아다니는 걸까――라고 생각하고 있는데, 책이 빛을 모으기 시작했다. 아마도 공격의 징조일 것이다.
WSTR:(K++) = ……라고 한가하게 생각할 틈이 없었다!
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 「오, 마침 한가하던 참이었어. 같이 날려버리자!」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
			CALL 口上変数初期化
WSTR:(K++) = 책의 사역마가 습격해왔다!
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
			敵BATTLE_STATE_STR:2:エネミー名 = Lv9_책의 사역마
			敵BATTLE_STATE_STR:5:エネミー名 = Lv9_책의 사역마
			敵BATTLE_STATE_STR:6:エネミー名 = Lv9_책의 사역마
			戦闘時_特殊処理フラグ = 魔理沙の助力_紅魔事変
			CALL 雑魚敵遭遇汎用処理
			IF RESULT != 0 && GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
				CALL マス未踏破戻し処理(ダンジョン現在位置:0, ダンジョン現在位置:1)
				ダンジョン現在位置:0 = 16
				ダンジョン現在位置:1 = 6
				RETURN 0
			ENDIF
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[普通の魔法使い]霧雨魔理沙"),100,,,1,1)
			立ち絵_魔理沙 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[動かない大図書館]パチュリー・ノーレッジ"),101,,,1,1)
			立ち絵_パチュリー = %立ち絵リソース記録%
WSTR:(K++) = 「거기! 내 도서관에서 난동 부리지 마!」
			CALL メッセージ欄表示用関数(立ち絵_パチュリー,"紫色の少女",,0)
			CALL 口上変数初期化
WSTR:(K++) = 책을 격파하자, 보라색 소녀와 검은 교복 같은 의상을 입은 악마 같은 소녀가 다가왔다.
WSTR:(K++) = 홍차 향이 난다…… 그녀가 마시고 있었던 걸까?
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 「당신, 누구야? 일단 문지기는 있었던 것 같은데」
			CALL メッセージ欄表示用関数(立ち絵_パチュリー,"紫色の少女",,0)
			CALL 口上変数初期化
WSTR:(K++) = 「없었어. 아니, 아까 그 책 제목이 『문지기』였을지도」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
			CALL 口上変数初期化
WSTR:(K++) = 이러저러해서, 붉은 안개를 멈추러 왔다. 라고 질문에 답한다.
WSTR:(K++) = 당신은 이 저택의 주인인가? 안개를 내뿜고 있다면, 멈춰줬으면 좋겠다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 「흐음. 그럼, 레미────저택의 주인과는 절대 만나게 하지 않을 거야」
			CALL メッセージ欄表示用関数(立ち絵_パチュリー,"紫色の少女",,0)
			CALL 口上変数初期化
WSTR:(K++) = ……이 환상향에서는 모두 혈기가 왕성한 걸까?
WSTR:(K++) = 보라색 소녀가 덮쳐왔다!
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
			敵BATTLE_STATE_STR:0:エネミー名 = Lv14_보라색 소녀
			敵BATTLE_STATE_STR:4:エネミー名 = Lv10_악마 같은 소녀
			戦闘時_特殊処理フラグ = 魔理沙の助力_紅魔事変
			CALL 雑魚敵遭遇汎用処理
			IF RESULT != 0 && GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
				CALL マス未踏破戻し処理(ダンジョン現在位置:0, ダンジョン現在位置:1)
				ダンジョン現在位置:0 = 16
				ダンジョン現在位置:1 = 6
				RETURN 0
			ENDIF
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[普通の魔法使い]霧雨魔理沙"),100,,,1,1)
			立ち絵_魔理沙 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[動かない大図書館]パチュリー・ノーレッジ"),101,,,1,1)
			立ち絵_パチュリー = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[名もなき小さな悪魔]小悪魔"),102,,,1,1)
			立ち絵_小悪魔 = %立ち絵リソース記録%
WSTR:(K++) = 「무큐~……」
			CALL メッセージ欄表示用関数(立ち絵_パチュリー,"紫色の少女",,0)
			CALL 口上変数初期化
WSTR:(K++) = 「파, 파츄리 님……!」
			CALL メッセージ欄表示用関数(立ち絵_小悪魔,"悪魔っぽい少女",,0)
			CALL 口上変数初期化
WSTR:(K++) = 쓰러져 버린 보라색 소녀를, 악마 같은 소녀가 안고 도망쳐 갔다.
WSTR:(K++) = 도망쳐 간 곳에 무언가 있을지도 모른다. 쫓아가자.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 「슬슬 흑막에 가까워진 건가?」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_幻想郷紅魔異変_21_4(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_咲夜
#DIMS 立ち絵_魔理沙
#DIMS 立ち絵_霊夢
マス深度 = 21
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_街

		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "23_4")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		ダンジョン背景画像 = 背景_紅魔館
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
			IF GETBIT(ダンジョン構造配列_幻想郷紅魔異変:14:2, 4)
				;霊夢ルート
				CLEARBIT RFLAG:ダンジョン再視聴フラグ, 4
			ELSE
				;魔理沙ルート
				SETBIT RFLAG:ダンジョン再視聴フラグ, 4
			ENDIF
		ELSE
			$再視聴表示
			IF GETBIT(ダンジョン構造配列_幻想郷紅魔異変:14:2, 4) && GETBIT(ダンジョン構造配列_幻想郷紅魔異変:14:6, 4)
				IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 4)
					;霊夢ルート
KSTR:(K++) = 레이무와 함께 사쿠야와 싸워, 마리사와 합류했다.　　　_BUTTON_[루트 전환]
				ELSE
					;魔理沙ルート
KSTR:(K++) = 마리사와 함께 사쿠야와 싸워, 레이무와 합류했다.　　　_BUTTON_[루트 전환]
				ENDIF
			ELSEIF GETBIT(ダンジョン構造配列_幻想郷紅魔異変:14:2, 4)
				;霊夢ルート
				CLEARBIT RFLAG:ダンジョン再視聴フラグ, 4
KSTR:(K++) = 레이무와 함께 사쿠야와 싸워, 마리사와 합류했다.
			ELSE
				;魔理沙ルート
				SETBIT RFLAG:ダンジョン再視聴フラグ, 4
KSTR:(K++) = 마리사와 함께 사쿠야와 싸워, 레이무와 합류했다.
			ENDIF
			CALL 再視聴確認(0, "[ルートを切り替え]")
			SIF RESULT
				GOTO 再視聴表示
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[完全で瀟洒な従者]十六夜咲夜"),100,,,1,1)
			立ち絵_咲夜 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[普通の魔法使い]霧雨魔理沙"),101,,,1,1)
			立ち絵_魔理沙 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[楽園の素敵な巫女]博麗霊夢"),102,,,1,1)
			立ち絵_霊夢 = %立ち絵リソース記録%
			IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 4) == 0
				;霊夢ルート
WSTR:(K++) = 복도를 나아가고 있는데, 인기척이 들렸다.
WSTR:(K++) = 아까 그 문지기 소녀일까? 이번에야말로 이야기를 들을 수 있으면 좋겠는데……
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「아아 정말, 청소가 진행되지 않아! 요정이라도 좋으니, 메이드를 고용해야 할까!」
				CALL メッセージ欄表示用関数(立ち絵_咲夜,"メイドの少女",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「당신……은, 이곳의 주인이 아닌 것 같네」
				CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 그녀는, 이쪽을 발견하자, 팟, 하고, 눈앞에 나타났다.
				WSTR:(K++) = 순간이동의 일종일까?
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「당신들은? 아가씨의 손님일까……라고 해도, 내가 파악하지 못할 리 없고. 침입자네.
				WSTR:(K++) = 　메이린은 뭘 하고 있었던 걸까……
				WSTR:(K++) = 　늦었지만, 나는 이곳의 메이드장 사쿠야.
				WSTR:(K++) = 　영초 만에 청소해 드리겠어요!」
				CALL メッセージ欄表示用関数(立ち絵_咲夜,"咲夜",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「성급한 메이드네. 소란을 피우는 건 바라는 바지만」
				CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 메이드장, 사쿠야가 덮쳐오고……
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「잠깐 잠깐! 드디어 따라잡았다고.
				WSTR:(K++) = 　볼거리를 놓치지 않는 것도 좋은 마녀의 조건이지」
				CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「어머, 벌써 따라왔네」
				CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 뒤에서 엄청난 속도로 날아온 마리사가, 기세 그대로 가세한다.
				WSTR:(K++) = 그럼 다시. 메이드장, 사쿠야가 덮쳐왔다!
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			ELSE
				;魔理沙
				WSTR:(K++) = 도서관의 두 사람을 쫓아 복도를 나아가자, 근처에서 전투음이 들려왔다.
				WSTR:(K++) = 소리가 나는 쪽으로 나아가자, 레이무와 메이드복 차림의 소녀가 싸우고 있다!
				WSTR:(K++) = 가세하려고 마리사와 함께 레이무의 곁으로 달려갔다.
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「어머, 벌써 따라잡았네」
				CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 메이드복 차림의 소녀는 경계하는지, 일단 거리를 두고 자세를 취하고 있다.
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「아 정말, 청소하느라 바쁜데! 여기저기 방해꾼들뿐이잖아!」
				CALL メッセージ欄表示用関数(立ち絵_咲夜,"メイドの少女",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「실례잖아. 방해 말고도 할 수 있다고」
				CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「그럼 청소……는 너로는 못 할 것 같네. 그쪽은 잘할 것 같지만」
				CALL メッセージ欄表示用関数(立ち絵_咲夜,"メイドの少女",,0)
				CALL 口上変数初期化
				IF 仕事レベル:PLAYER:1 >= 3
					WSTR:(K++) = 잡무에 대해서는 확실히 특기 분야지만……
				ELSE
					WSTR:(K++) = 잡무에 대해서는 조금 실력이 있지만……
				ENDIF
				WSTR:(K++) = 그것보다 이 붉은 안개에 대해 이야기를 들려줄 수 없을까?
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「확실히 안개는 우리 집에서 내고 있어. 햇빛도 가릴 수 있고, 아가씨는 어두운 걸 좋아하시니까」
				CALL メッセージ欄表示用関数(立ち絵_咲夜,"メイドの少女",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 멈춰줄 수 없을까? 우리 집 근처까지 흘러와서 폐를 끼치고 있으니.
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「그건 아가씨가 결정할 일이고, 방해꾼은 아가씨를 만나게 하지 않아.
				WSTR:(K++) = 　늦었지만, 저는 이곳의 메이드장 사쿠야입니다.
				WSTR:(K++) = 　영초 만에 청소해 드리겠어요!」
				CALL メッセージ欄表示用関数(立ち絵_咲夜,"咲夜",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「그렇다면, 이 녀석을 쓰러뜨리면 내가 메이드장이겠군」
				CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 메이드장, 사쿠야가 덮쳐왔다!
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			ENDIF
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
			敵BATTLE_STATE_STR:0:エネミー名 = Lv16_메이드장 사쿠야
			戦闘時_特殊処理フラグ = 霊夢と魔理沙の助力_紅魔事変
			CALL 雑魚敵遭遇汎用処理
			IF RESULT != 0 && GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
				CALL マス未踏破戻し処理(ダンジョン現在位置:0, ダンジョン現在位置:1)
				IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 4) == 0
					ダンジョン現在位置:0 = 18
					ダンジョン現在位置:1 = 2
				ELSE
					ダンジョン現在位置:0 = 19
					ダンジョン現在位置:1 = 6
				ENDIF
				RETURN 0
			ENDIF
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[完全で瀟洒な従者]十六夜咲夜"),100,,,1,1)
			立ち絵_咲夜 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[普通の魔法使い]霧雨魔理沙"),101,,,1,1)
			立ち絵_魔理沙 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[楽園の素敵な巫女]博麗霊夢"),102,,,1,1)
			立ち絵_霊夢 = %立ち絵リソース記録%
			WSTR:(K++) = 「강해…… 이상한 녀석들이네. 바깥 사람들과도 달라……」
			CALL メッセージ欄表示用関数(立ち絵_咲夜,"咲夜",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 가령 이세계에서 왔으니――그렇게 대답하려던 찰나, 어딘가에서 높고 어린 소녀의 목소리가 들려왔다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 『좋아. 들여보내, 사쿠야』
			CALL メッセージ欄表示用関数(,"？？？",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「아가씨!?」
			CALL メッセージ欄表示用関数(立ち絵_咲夜,"咲夜",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 『바깥의, 게다가 바깥 세계에서 온 손님이라니, 홍마관이 처음으로 맞이하기에 걸맞지 않아?
			WSTR:(K++) = 　그런 손님의 피는, 어떤 맛이 날까. 기대되는걸』
			CALL メッセージ欄表示用関数(,"？？？",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 펄럭펄럭, 실내임에도 불구하고 박쥐가 날아간다.
			WSTR:(K++) = 사쿠야는 한숨을 쉬고, 이쪽을 향해 돌아섰다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「그럼 안내해 드리겠습니다, 손님」
			CALL メッセージ欄表示用関数(立ち絵_咲夜,"咲夜",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 거부할 선택지는…… 없는 것 같다.
			WSTR:(K++) = 초대받았으니 거절하는 것도 실례겠지.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「차가웠던 몸은 따뜻해졌어. 이제 차는 필요 없을 것 같아」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「달콤한 만두라도 기대하고 싶은걸」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_幻想郷紅魔異変_23_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 23
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_街

		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		;移動先Yと移動先Yを、移動先の位置に変更すること
		CALL 接続ルート全開放処理(24, 4)
		ダンジョン現在位置:0 = 24
		ダンジョン現在位置:1 = 4
		ダンジョン背景画像 = 背景_紅魔館
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_幻想郷紅魔異変_24_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 24
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_街

		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "26_4")
	CASE "マスイベント"
		;移動先Yと移動先Yを、移動先の位置に変更すること
		ダンジョン現在位置:0 = 23
		ダンジョン現在位置:1 = 4
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_幻想郷紅魔異変_26_4(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_咲夜
#DIMS 立ち絵_魔理沙
#DIMS 立ち絵_霊夢
#DIMS 立ち絵_レミリア
マス深度 = 26
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_街

		ダンジョンマス画像URL_重ね表示 = エネミーアイコン_赤
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "30_4")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			KSTR:(K++) = 이변의 흑막인 레밀리아와 싸웠다
			CALL 再視聴確認(0)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[永遠に紅い幼き月]レミリア"),100,,,1,1)
			立ち絵_レミリア = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[完全で瀟洒な従者]十六夜咲夜"),101,,,1,1)
			立ち絵_咲夜 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[普通の魔法使い]霧雨魔理沙"),102,,,1,1)
			立ち絵_魔理沙 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[楽園の素敵な巫女]博麗霊夢"),103,,,1,1)
			立ち絵_霊夢 = %立ち絵リソース記録%
			WSTR:(K++) = 안내받은 곳은 넓은 발코니였다.
			WSTR:(K++) = 그곳에는 하얀 드레스를 입은 소녀가 붉은 차를 마시고 있었다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「어서 와.
			WSTR:(K++) = 　나는 이 홍마관의 주인, 레밀리아 스칼렛.
			WSTR:(K++) = 　당신은?」
			CALL メッセージ欄表示用関数(立ち絵_レミリア,"？？？",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 이름을 밝히자, 그녀――레밀리아는 고개를 끄덕이며 일어섰다.
			WSTR:(K++) = 작다.
			WSTR:(K++) = 휴먼의 10살 아이 정도의 키일까?
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 다만, 겉보기 나이 그대로는 아닌 것 같고…… 겉보기 힘 그대로도 아닐 것이다.
			WSTR:(K++) = 눈에 보일 정도로 강대한 마력이 소용돌이치고 있다…… .
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「그래서? 굳이 이 홍마관까지 온 이유는?」
			CALL メッセージ欄表示用関数(立ち絵_レミリア,"レミリア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 이계의 문을 통해, 안개가 이쪽 세계까지 새어 나오고 있다.
			WSTR:(K++) = 이쪽으로서는 환상향이라는 잠재적인 고객도 많을 땅과의 교류를 끊고 싶지 않다.
			WSTR:(K++) = ……리조트 우대권 1년치 정도로 타협해 주실 수 없을까요?
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「리조트? 헤에…… 우대권? 흐음. 재미있는 말을 하는구나. 어, 경영하고 있는 건가?」
			WSTR:(K++) = 고개를 끄덕이자, 레밀리아는 조금 흥미로운 표정을 지었다.
			CALL メッセージ欄表示用関数(立ち絵_レミリア,"レミリア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「좋아. 1년치 우대권은 받아둘게.
			WSTR:(K++) = 　안개도 그쪽 세계에는 가지 않도록, 우리 마법사에게 상담해 줄게」
			CALL メッセージ欄表示用関数(立ち絵_レミリア,"レミリア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 완전히 멈춰주셨으면 하는데, 그렇게는 안 될까.
			WSTR:(K++) = 바깥 세계에서 와놓고, 너무 강하게 말할 수도 없지만……
			WSTR:(K++) = 대답에 망설이던 차에, 동행하고 있던 두 소녀가 앞으로 나선다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「그럼 곤란한데」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「빨리 안개를 멈춰줄 수 있을까」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ……레밀리아는, 분명히 불쾌한 표정이 되었다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「사쿠야. 그쪽 둘은 맡길게」
			CALL メッセージ欄表示用関数(立ち絵_レミリア,"レミリア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「알겠습니다」
			CALL メッセージ欄表示用関数(立ち絵_咲夜,"咲夜",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 사쿠야의 모습이 사라지고, 동시에 레이무와 마리사의 모습도 사라졌다.
			WSTR:(K++) = 몇 초 후, 상공에서 전투 소리가 들려온다……
			WSTR:(K++) = 레밀리아는 마음을 다잡은 듯 고개를 끄덕였다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「그럼, 이렇게 할까요.
			WSTR:(K++) = 　안개는 멈춰줄게요.
			WSTR:(K++) = 　그리고, 이제부터 내가 너를 죽일 거야」
			CALL メッセージ欄表示用関数(立ち絵_レミリア,"レミリア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「네가 살아남으면 그걸로 끝이야. 리조트에 평범하게 손님으로 갈게.
			WSTR:(K++) = 　네가 죽으면, 내가 시생인(좀비)으로 만들어서, 네 리조트를, 나 전용 리조트로 만들어줄게」
			CALL メッセージ欄表示用関数(立ち絵_レミリア,"レミリア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ……리조트 강탈은 곤란한데.
			WSTR:(K++) = 레밀리아가 날개를 펼친다.
			WSTR:(K++) = 홍무가 찢어지고, 새빨간 보름달이 드러난다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「이렇게 달도 붉으니까――」
			WSTR:(K++) = 
			WSTR:(K++) = ――맞이해 줘? 찾아오는 밤에는.
			WSTR:(K++) = 환영합니다, 방문하는 밤에는――.
			CALL メッセージ欄表示用関数(立ち絵_レミリア,"レミリア",,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 1)
			;戦闘部分
			敵BATTLE_STATE_STR:0:エネミー名 = Lv18_흡혈귀 레밀리아
			CALL 雑魚敵遭遇汎用処理
			IF RESULT != 0 && GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
				CALL マス未踏破戻し処理(ダンジョン現在位置:0, ダンジョン現在位置:1)
				ダンジョン現在位置:0 = 24
				ダンジョン現在位置:1 = 4
				RETURN 0
			ENDIF
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT





@ダンジョンマス情報_幻想郷紅魔異変_30_4(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_咲夜
#DIMS 立ち絵_魔理沙
#DIMS 立ち絵_霊夢
#DIMS 立ち絵_レミリア
マス深度 = 30
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_街

		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
KSTR:(K++) = 이변을 해결하고, 새로운 리조트의 고객을 확보했다.
			CALL 再視聴確認(1)
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[永遠に紅い幼き月]レミリア"),100,,,1,1)
			立ち絵_レミリア = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[完全で瀟洒な従者]十六夜咲夜"),101,,,1,1)
			立ち絵_咲夜 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[普通の魔法使い]霧雨魔理沙"),102,,,1,1)
			立ち絵_魔理沙 = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[楽園の素敵な巫女]博麗霊夢"),103,,,1,1)
			立ち絵_霊夢 = %立ち絵リソース記録%
WSTR:(K++) = 이계의 문을 조정한다.
WSTR:(K++) = 이것으로 환상향과의 사이가 안정되었고, 붉은 안개가 재발생해도, 이쪽으로 흘러들어올 일은 없을 것이다.
WSTR:(K++) = 설치한 것은 우리이므로, 관리도 이쪽에서 하지만, 가끔 신경 써주면 기쁠 것이다――
WSTR:(K++) = 레이무 일행은 고개를 끄덕이며, 차를 홀짝였다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 「뭐 잘할 거야. ……그런데, 나도 그 리조트? 에 가도 되는 걸까.
WSTR:(K++) = 　별로, 수중에 돈, 이라는 건 나 가지고 있지 않은데」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
WSTR:(K++) = 「어, 너, 돈이라는 게 있어? 시주하러 오는 참배객도 없는데?」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
			CALL 口上変数初期化
WSTR:(K++) = 「시주는 없지만, 호의는 많이 가지고 있어, 나」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
WSTR:(K++) = ……뭐, 루피로 지불해 주시는 것이 가장 좋지만……
WSTR:(K++) = 환상향에도, 하늘에서도 가치 있는 물품은 존재하는 것 같고, 하늘에 없는 것, 전혀 다른 이론으로 만들어진 물품도 있는 것 같다.
WSTR:(K++) = 그러한 것을 가져와 주시면, 어느 정도 융통성은 발휘할 것이다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 「그래? 그럼, 호의 포인트가 다 떨어지면 신세 지러 갈게」
			CALL メッセージ欄表示用関数(立ち絵_霊夢,"霊夢",,0)
			CALL 口上変数初期化
WSTR:(K++) = 「그럼 지금부터 돌아가는데 따라가는 게 좋지 않아?」
			CALL メッセージ欄表示用関数(立ち絵_魔理沙,"魔理沙",,0)
			CALL 口上変数初期化
WSTR:(K++) = 싸우기 시작한 홍백과 흑백에게서 시선을 돌린다.
			WSTR:(K++) = 햇빛 아래, 양산을 쓴 어린 소녀――레밀리아와 메이드 사쿠야가 다가오고 있다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「이 앞에 리조트가 있는 걸까?
			WSTR:(K++) = 　일정을 비우고 가볼까. 사원 여행이라는 건가?」
			CALL メッセージ欄表示用関数(立ち絵_レミリア,"レミリア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「아가씨, 저희는 사원이라고 할 수는……
			WSTR:(K++) = 　그렇게 말한다면, 홍마관 일행입니다요.」
			CALL メッセージ欄表示用関数(立ち絵_咲夜,"咲夜",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「뭔가 다른 건가, 그게?」
			CALL メッセージ欄表示用関数(立ち絵_レミリア,"レミリア",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ……이로써 환상향 주민들에게도 리조트 홍보를 할 수 있었을 것이다.
			WSTR:(K++) = 레밀리아 일행을 초대해서 평판을 퍼뜨리게 하는 것도 좋을지도 모른다.
			WSTR:(K++) = 경영 계획을 다시 세우는 것이 기대된다.
			WSTR:(K++) = 우선, 환상향 주민들이 무엇을 좋아하는지 리서치하고 돌아가기로 하자.
			WSTR:(K++) = 인육밖에 먹지 못하는 자들만 있는 것은 아닐 것이다. 아마도……
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = [낙원의 멋진 무녀]하쿠레이 레이무가 리조트를 방문하게 되었다!
			WSTR:(K++) = [평범한 마법사]키리사메 마리사가 리조트를 방문하게 되었다!
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = [화인 소저]홍 메이링이 리조트를 방문하게 되었다!
			WSTR:(K++) = [이름 없는 작은 악마]코아쿠마가 리조트를 방문하게 되었다!
WSTR:(K++) = [움직이지 않는 대도서관]파츄리 널릿지가 리조트를 방문하게 되었다!
WSTR:(K++) = [완전하고 세련된 종자]이자요이 사쿠야가 리조트를 방문하게 되었다!
WSTR:(K++) = [영원히 붉은 어린 달]레밀리아가 리조트를 방문하게 되었다!
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CFLAG:(キャラ検索("[楽園の素敵な巫女]博麗霊夢")):招待不可フラグ = 0
			CFLAG:(キャラ検索("[普通の魔法使い]霧雨魔理沙")):招待不可フラグ = 0
			CFLAG:(キャラ検索("[華人小娘]紅美鈴")):招待不可フラグ = 0
			CFLAG:(キャラ検索("[名もなき小さな悪魔]小悪魔")):招待不可フラグ = 0
			CFLAG:(キャラ検索("[動かない大図書館]パチュリー・ノーレッジ")):招待不可フラグ = 0
			CFLAG:(キャラ検索("[完全で瀟洒な従者]十六夜咲夜")):招待不可フラグ = 0
			CFLAG:(キャラ検索("[永遠に紅い幼き月]レミリア")):招待不可フラグ = 0
			ダンジョン終了状況 = 踏破達成
			ダンジョンクリアフラグ_幻想郷紅魔異変 = 1
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

