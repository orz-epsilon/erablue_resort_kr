

@ダンジョン初期処理_魔導書の謎解き試練
;ダンジョン構造の読み込み
;0でない時、そのマスは存在する
#DIM 深度
#DIM 分岐

ダンジョンサブタイトル = THE BOOK OF RIDDLES
ダンジョンマス画像URL_伏せ状態 = 壁_遺跡
ダンジョン現在位置:0 = 0
ダンジョン現在位置:1 = 4
ダンジョン背景画像 = 背景_遺跡

;スタート地点は必ず存在
;初期からオープン済みなので3を入れる
;ビット0：存在するか　ビット1：移動できるか　ビット2：マスをオープンするか（ビット１をONにしないと無意味）　ビット3：入れないがオープンする場合に使用
;ビット4以降：自由枠。主に宝箱の開閉やイベント達成フラグなどに使用
IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:{ダンジョン現在位置:0}:{ダンジョン現在位置:1}") == 0
	SETVAR @"ダンジョン構造配列_%ダンジョン名%:{ダンジョン現在位置:0}:{ダンジョン現在位置:1}", 3
ENDIF

FOR 深度, 1, 100
	LOCAL = 0
	FOR 分岐, 0, 9
		IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:{深度}:{分岐}")
			;既にマス情報が入ってるなら飛ばす
			LOCAL = 1
			CONTINUE
		ELSEIF ENUMFUNCBEGINSWITH(@"ダンジョンマス情報_%ダンジョン名%_{深度}_{分岐}")
			LOCAL = 1
			SETVAR @"ダンジョン構造配列_%ダンジョン名%:深度:分岐", 1
		ENDIF
	NEXT
	IF LOCAL
		ダンジョン最大深度 = 深度
	ENDIF
NEXT

@ダンジョン解説文_魔導書の謎解き試練

詳細文文字列受け渡し変数 = 
詳細文文字列受け渡し変数 += "리조트에 초대한 이세계의 손님, 프리렌 일행이 마도서에 갇혀버렸다. <br>"
詳細文文字列受け渡し変数 += "당신은 성정수 era와 함께 프리렌 일행을 맞이하러 가기 위해, <br>"
詳細文文字列受け渡し変数 += "수수께끼 풀이의 시련을 가진 마도서 안으로 향한다. <br>"
詳細文文字列受け渡し変数 += "<br>"
詳細文文字列受け渡し変数 += "던전 출처: 장송의 프리렌 <br>"

;推奨レベルを返す
RETURN 1

@敵討伐後処理_ダンジョン固有_魔導書の謎解き試練(討伐エネミー数)
#DIM 討伐エネミー数
;ダンジョン内で戦闘した後に呼ばれる関数、主にダンジョンごとのドロップアイテム取得に使用
;今回アイテムドロップはないので記述なし

;---------------------------------------------------------------------
;マップ構造
;---------------------------------------------------------------------
;イベントミニマップなのでほぼ一本道
;---------------------------------------------------------------------

@ダンジョンマス情報_魔導書の謎解き試練_0_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 0
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "1_4")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 마도서를 열고, 안으로 들어간다.
			WSTR:(K++) = 순식간에 주변 풍경이 바뀌고, 석조 유적 같은 건물 내부로 이동한 듯하다.
			WSTR:(K++) = 옆에는 성정수 era의 모습이 있다. 무사히 떨어지지 않고 돌입할 수 있었던 것 같다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「흐음……고풍스러운 연출이지만, 술식은 꽤 새롭네……."
			WSTR:(K++) = 　만들어진 건 기껏해야 2, 3년 전쯤일까」
			CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
			CALL 口上変数初期化
			WSTR:(K++) = era는 신나서 주변을 살피고 있다. 즐거워 보여서 다행이다.
			WSTR:(K++) = 책 속은 어둑하지만, 조금 떨어진 곳에 인기척이 보인다.
			WSTR:(K++) = 아마도 먼저 책 속에 들어와 있던 손님들일 것이다. 먼저 나아가 합류하자.
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 조금 떨어진 곳에 인기척이 보인다.
			KSTR:(K++) = 아마도 먼저 책 속에 들어와 있던 손님들일 것이다.
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_魔導書の謎解き試練_1_4(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_フリーレン
#DIMS 立ち絵_フェルン
#DIMS 立ち絵_シュタルク
マス深度 = 1
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "4_4")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			$再視聴表示
			KSTR:(K++) = 프리렌, 페른, 슈타르크와 합류했다.
			CALL 再視聴確認(再戦闘_なし)
			SIF RESULT
				GOTO 再視聴表示
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[葬送]フリーレン"),100,,,1,1)
			立ち絵_フリーレン = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[フリーレンの弟子]フェルン"),101,,,1,1)
			立ち絵_フェルン = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[戦士]シュタルク"),102,,,1,1)
			立ち絵_シュタルク = %立ち絵リソース記録%
			WSTR:(K++) = era를 데리고, 근처에 보이던 인영 쪽으로 다가간다.
			WSTR:(K++) = 한 명은 백발에 머리를 두 갈래로 묶은 가녀린 소녀.
			WSTR:(K++) = 한 명은 보랏빛이 도는 검은 머리를 길게 늘어뜨리고 검은 로브를 두른 젊은 여성.
			WSTR:(K++) = 마지막으로 커다란 도끼를 짊어진 붉은 머리의 젊은 청년.
			WSTR:(K++) = %CALLNAME:PLAYER%가 리조트에 초대한 「프리렌」「페른」「슈타르크」가 틀림없을 것이다.
			WSTR:(K++) = %CALLNAME:PLAYER%= %CALLNAME:PLAYER%은(는) 세 사람에게 말을 걸어, 지금까지의 경위를 설명한다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「과연, 책 속의 공간인가.
			WSTR:(K++) = %CALLNAME:PLAYER%= 　이쪽 세계에는 재미있는 마법이 있네」
			CALL メッセージ欄表示用関数(立ち絵_フリーレン,"フリーレン",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「저희가 발이 묶여 있던 이유도 알았습니다.
			WSTR:(K++) = 　슈타르크 님이 공격을 한 벌칙이었군요」
			CALL メッセージ欄表示用関数(立ち絵_フェルン,"フェルン",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「미안해…… 마물인 줄 알았단 말이야」
			CALL メッセージ欄表示用関数(立ち絵_シュタルク,"シュタルク",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 세 사람 바로 옆에는 호화로운 로브를 두른 해골 석상이 있다.
			WSTR:(K++) = 석상은 무언가 문장이 새겨진 석판을 들고 있으며, 마력에 반응하여 글자를 쓸 수 있는 것 같다.
			WSTR:(K++) = 즉, 이것이 『수수께끼 풀이』의 무대 장치이며, 석상에 대한 공격 등은 반칙이라는 뜻일 것이다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「한 번의 공격으로 한 시간 동안 해답 불능.
			WSTR:(K++) = 　몇 번이나 공격했을 때는 다른 벌칙이 발동할 가능성이 있겠네.
			WSTR:(K++) = 　제대로 수수께끼를 푸는 게 제일 좋겠지」
			CALL メッセージ欄表示用関数(立ち絵_フリーレン,"フリーレン",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 프리렌의 행동거지는 숙련된 마법사의 그것이다.
			WSTR:(K++) = 시련이라고는 해도, 수수께끼 정도라면 금방 풀어버리겠지.
			WSTR:(K++) = 성정수 era도 자신 있어 보이고, 이 정도라면 고생하지 않고 탈출할 수 있을 것 같다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「어이쿠, 무슨 소리를 하는 거야.
			WSTR:(K++) = 　네가 푸는 거야, 나의 계약자여」
			CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 뭔가 말하기 시작했잖아 이 녀석.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「나나 저기 있는 마법사가 금방 풀고 끝내면 재미없잖아.
			WSTR:(K++) = 　이런 건 사람이 고민하는 모습을 보는 게 즐겁거든」
			CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「재미있을지는 모르겠지만, 그렇네. 이런 수행도 가끔은 괜찮을까.
			WSTR:(K++) = 　페른, 풀어볼까」
			CALL メッセージ欄表示用関数(立ち絵_フリーレン,"フリーレン",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 프리렌의 재촉을 받은 페른은, 순순히 수수께끼 풀이에 도전하기 시작했다.
			WSTR:(K++) = era가 기대로 가득 찬 눈으로 이쪽을 바라본다.
			WSTR:(K++) = 어쩔 수 없으니, %CALLNAME:PLAYER%도 수수께끼 풀이에 도전하자.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT




@ダンジョンマス情報_魔導書の謎解き試練_4_2(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_フリーレン
#DIMS 立ち絵_フェルン
#DIMS 立ち絵_シュタルク
マス深度 = 4
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
	CASE "マスイベント"
		KSTR:(K++) = 누구에게 이야기를 들어볼까?
		KSTR:(K++) = BUTTON_[슈타르크와 이야기하다]_(약간의 힌트)
		KSTR:(K++) = BUTTON_[페른과 이야기하다]_(큰 힌트)
		KSTR:(K++) = BUTTON_[프리렌과 이야기하다]_(거의 정답)
		KSTR:(K++) = BUTTON_[역시 그만두다]
		CALL メッセージ欄表示用関数(,,,0)
		CALL 口上変数初期化
		$LOOP_MESSAGE
		INPUTS
		SELECTCASE RESULTS
			CASE "[シュタルクと話す]"
				CALLF 顔グラ表示用文字列関数(キャラ検索("[戦士]シュタルク"),102,,,1,1)
				立ち絵_シュタルク = %立ち絵リソース記録%
				WSTR:(K++) = 붉은 머리 전사에게 말을 걸어보자. 이 수수께끼, 어떻게 생각해?
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「어, 나? 나 이런 거 잘 못 하는데…….`
				WSTR:(K++) = 　근데, 비기지는 않았잖아?
				WSTR:(K++) = 　뭔가 이렇게…… 잘 조합하면, 딱 들어맞지 않을까?」
				CALL メッセージ欄表示用関数(立ち絵_シュタルク,"シュタルク",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 슈타르크는 끙끙 앓으며 고민하고 있다.
				WSTR:(K++) = 확실히 비기는 경우가 없다는 부분은 중요한 정보인 것 같다. 다시 한번 생각해 보자.
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			CASE "[フェルンと話す]"
				CALLF 顔グラ表示用文字列関数(キャラ検索("[フリーレンの弟子]フェルン"),101,,,1,1)
				立ち絵_フェルン = %立ち絵リソース記録%
				WSTR:(K++) = 검은 머리 마법사에게 말을 걸어보자. 이 수수께끼, 어떻게 생각해?
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「그렇네요…….`
				WSTR:(K++) = 　페더 님의 가위가 하나만 유독 튀어나와 있는 부분이 신경 쓰입니다.
				WSTR:(K++) = 　여기서부터 생각해 나갈 생각입니다」
				CALL メッセージ欄表示用関数(立ち絵_フェルン,"フェルン",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 페른은 땅에 글자를 쓰며 생각하고 있다.
				WSTR:(K++) = 페더의 가위는 확실히 특징적이다. 다시 한번 생각해 보자.
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			CASE "[フリーレンと話す]"
				CALLF 顔グラ表示用文字列関数(キャラ検索("[葬送]フリーレン"),100,,,1,1)
				立ち絵_フリーレン = %立ち絵リソース記録%
				WSTR:(K++) = 백발의 마법사에게 말을 걸어보자. 이 수수께끼, 어떻게 생각해?
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「우리 세계에도 예전부터 있는 논리 계열의 수수께끼네.
				WSTR:(K++) = 　이런 건 말이야, 상황을 한정해서 생각해 보는 거야.
				WSTR:(K++) = 　예를 들어, 페더가 가위를 냈을 때 랜들의 손은……」
				CALL メッセージ欄表示用関数(立ち絵_フリーレン,"フリーレン",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「이런, 그 이상은 답을 가르쳐주는 것과 마찬가지다. 거기서 멈춰라, 마법사」
				CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
				CALL 口上変数初期化
				WSTR:(K++) = era에게 입을 막힌 프리렌은 으음으음 신음하고 있다.
				WSTR:(K++) = 상황을 한정한다, 인가. 다시 한번 생각해 보자.
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			CASE "[やっぱりやめる]"
				CALL 口上変数初期化
			CASEELSE
				CLEARLINE 1
				REUSELASTLINE  
				GOTO LOOP_MESSAGE
		ENDSELECT
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_魔導書の謎解き試練_4_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 4
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "4_2")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "6_4")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 석상이 가지고 있는 수수께끼를 보자.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			KSTR:(K++) = 여기에, 가위바위보를 10회 하는 두 남자, 페더와 랜들이 있다.
			KSTR:(K++) = 페더는 바위를 1회, 가위를 7회, 보를 2회 냈다.
			KSTR:(K++) = 랜들은 바위를 3회, 가위를 3회, 보를 4회 냈다.
			KSTR:(K++) = 비기는 일은 한 번도 없었다고 하면, 이긴 횟수가 많은 쪽은 누구인가?
			CALL メッセージ欄表示用関数()
			CALL 口上変数初期化
			WSTR:(K++) = 꽤 어려워 보이는 수수께끼다.
			WSTR:(K++) = 다른 누군가와 함께 생각하여, 힌트가 될 만한 생각을 얻어도 좋을지도 모른다.
			WSTR:(K++) = 혹은, 도저히 모르겠다면 포기하고 era에게 답을 듣는 방법도 있다.
			WSTR:(K++) = 힌트를 들을 경우 위 칸으로. 해답을 하거나, 혹은 포기한다면 오른쪽 칸으로 나아가자.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 여기에, 가위바위보를 10회 하는 두 남자, 페더와 랜들이 있다.
			KSTR:(K++) = 페더는 바위를 1회, 가위를 7회, 보를 2회 냈다.
			KSTR:(K++) = 랜들은 바위를 3회, 가위를 3회, 보를 4회 냈다.
			KSTR:(K++) = 비기는 일이 한 번도 없었다고 한다면, 이긴 횟수가 더 많은 쪽은 누구인가?
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_魔導書の謎解き試練_6_4(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_フェルン
マス深度 = 6
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "7_4")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			$再視聴表示
			KSTR:(K++) = 첫 번째 수수께끼에 도전했다.
			CALL 再視聴確認(1)
			SIF RESULT
				GOTO 再視聴表示
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			WSTR:(K++) = 자, 뭐라고 답할까.
			KSTR:(K++) = BUTTON_[페더가 더 많이 이겼다]
			KSTR:(K++) = BUTTON_[랜들이 더 많이 이겼다]
			KSTR:(K++) = BUTTON_[둘 다 똑같다]
			KSTR:(K++) = BUTTON_[포기하고 era에게 답을 듣는다]
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[フェザーの勝ちが多い]", "[ランドルの勝ちが多い]"
					WSTR:(K++) = 「오답!!」
					CALL メッセージ欄表示用関数(,"石像の声",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 석상에서 목소리가 울려 퍼짐과 동시에, %CALLNAME:PLAYER% 위에서 대량의 물이 쏟아져 내렸다.
					WSTR:(K++) = 다칠 정도의 기세는 아니었지만, 흠뻑 젖어 버렸다……
					WSTR:(K++) = 오답에 대한 페널티인 것 같다. 다시 한번 생각해 보자.
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
					IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
						CALL マス未踏破戻し処理(ダンジョン現在位置:0, ダンジョン現在位置:1)
						ダンジョン現在位置:0 = 4
						ダンジョン現在位置:1 = 4
					ENDIF
					RETURN 0
				CASE "[どっちも同じ]"
					CALLF 顔グラ表示用文字列関数(キャラ検索("[フリーレンの弟子]フェルン"),101,,,1,1)
					立ち絵_フェルン = %立ち絵リソース記録%
					WSTR:(K++) = 「너의 예지를 인정하노라……」
					CALL メッセージ欄表示用関数(,"石像の声",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 석상에서 목소리가 울려 퍼짐과 동시에, 다음 방으로 향하는 문이 열렸다.
					WSTR:(K++) = 무사히 정답을 맞힌 것 같다.
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「페더 님도 랜들 님도 5승 5패. 즉, 같다가 정답입니다.
					WSTR:(K++) = 　맞아서 안심했습니다」
					CALL メッセージ欄表示用関数(立ち絵_フェルン,"フェルン",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 페른 쪽도 정답을 찾아낸 것 같다.
					WSTR:(K++) = 당당하게 다음 방으로 나아가자.
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
				CASE "[ギブアップしてeraに答えてもらう]"
					CALLF 顔グラ表示用文字列関数(キャラ検索("[フリーレンの弟子]フェルン"),101,,,1,1)
					立ち絵_フェルン = %立ち絵リソース記録%
					WSTR:(K++) = 「어쩔 수 없군, 나의 계약자는.
					WSTR:(K++) = 　그럼 성정수(星晶獣)인 내가 해답과 해설을 해주지」
					CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 부탁드립니다 era 님.
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「우선 주목해야 할 점은 「비기지 않았다」와 「가장 많은 페더의 가위」다.
					WSTR:(K++) = 　즉, 여기서 「페더가 가위일 때 ＝ 랜들이 바위 ＋ 랜들이 보」라는 상황을 도출할 수 있다.
					WSTR:(K++) = 　이 시점에서 페더는 4승 3패, 랜들은 3승 4패라는 것이 확정되는 것이다」
					CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「나머지 「란돌이 가위 = 페더가 바위 + 페더가 보」일 때에 대해서만 생각하면 돼.
					WSTR:(K++) = 　합계하면, 둘 다 5승 5패가 되는 셈이지」
					CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
					CALL 口上変数初期化
					WSTR:(K++) = era가 으스대는 얼굴로 설명하며 답을 입력하자, 다음 방으로 향하는 문이 열렸다.
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「맞아서 다행입니다」
					CALL メッセージ欄表示用関数(立ち絵_フェルン,"フェルン",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 페른은 정답을 찾아낸 것 같았다.
					WSTR:(K++) = %CALLNAME:PLAYER%는 포기해 버렸지만, 마음을 다잡고 다음 방으로 나아가자.
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_魔導書の謎解き試練_7_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 7
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		;移動先Yと移動先Yを、移動先の位置に変更すること
		IF 初来訪マス判定用フラグ
			;移動直後はマスイベント発動しないので、移動先のルート開放をここで行う
			CALL 接続ルート全開放処理(8, 4)
		ENDIF
		ダンジョン現在位置:0 = 8
		ダンジョン現在位置:1 = 4
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_魔導書の謎解き試練_8_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 8
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "11_4")
	CASE "マスイベント"
		;移動先Yと移動先Yを、移動先の位置に変更すること
		ダンジョン現在位置:0 = 7
		ダンジョン現在位置:1 = 4
		CALL 画面再描画
ENDSELECT




@ダンジョンマス情報_魔導書の謎解き試練_11_2(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_フリーレン
#DIMS 立ち絵_フェルン
#DIMS 立ち絵_シュタルク
マス深度 = 11
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
	CASE "マスイベント"
		KSTR:(K++) = 누구에게 이야기를 들어볼까?
		KSTR:(K++) = BUTTON_[슈타르크와 이야기한다]_（약간의 힌트）
		KSTR:(K++) = BUTTON_[페른과 이야기한다]_（큰 힌트）
		KSTR:(K++) = BUTTON_[프리렌과 이야기한다]_（거의 정답）
		KSTR:(K++) = BUTTON_[역시 그만둔다]
		CALL メッセージ欄表示用関数(,,,0)
		CALL 口上変数初期化
		$LOOP_MESSAGE
		INPUTS
		SELECTCASE RESULTS
			CASE "[シュタルクと話す]"
				CALLF 顔グラ表示用文字列関数(キャラ検索("[戦士]シュタルク"),102,,,1,1)
				立ち絵_シュタルク = %立ち絵リソース記録%
				WSTR:(K++) = 슈타르크에게 말을 걸어보자. 이 수수께끼, 어떻게 생각해?
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「잠깐만 기다려줘. 복잡해서…….
				WSTR:(K++) = 　음, 가장 많으면 10명이고. 어라, 자신과 연인과는 악수하지 않은 건가. 그럼 음 8명으로……」
				CALL メッセージ欄表示用関数(立ち絵_シュタルク,"シュタルク",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 슈타르크는 끙끙거리며 고민하고 있다.
WSTR:(K++) = 다만 「악수한 인원수의 최대수는 ８명」이라는 점은 중요한 힌트가 될 것 같다. 다시 한번 생각해 보자.
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			CASE "[フェルンと話す]"
				CALLF 顔グラ表示用文字列関数(キャラ検索("[フリーレンの弟子]フェルン"),101,,,1,1)
				立ち絵_フェルン = %立ち絵リソース記録%
				WSTR:(K++) = 페른에게 말을 걸어보자. 이 수수께끼, 어떻게 생각해?
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「모두 대답한 수가 다르다는 것은……
				WSTR:(K++) = 　９명의 질문에 대한 답은 각각 ０，１，２，３，４，５，６，７，８명이라고 생각합니다.
				WSTR:(K++) = 　다만, 이것을 어떻게 조합해 나갈지가 문제라서……」
				CALL メッセージ欄表示用関数(立ち絵_フェルン,"フェルン",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 페른은 땅에 글자를 써서 생각하고 있다.
				WSTR:(K++) = 질문의 답은 ０명부터 ８명까지 틀림없을 것이다.
				WSTR:(K++) = 여기서 조합을 구할 수 없는지, 다시 한번 생각해 보자.
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			CASE "[フリーレンと話す]"
				CALLF 顔グラ表示用文字列関数(キャラ検索("[葬送]フリーレン"),100,,,1,1)
				立ち絵_フリーレン = %立ち絵リソース記録%
				WSTR:(K++) = 프리렌에게 말을 걸어보자. 이 수수께끼, 어떻게 생각해?
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「조금 복잡하지만, 해법으로서는 같은 것의 반복이네.
				WSTR:(K++) = 　각각을 개별적으로 생각하는 것이 아니라, 연인 １쌍마다 생각해 보자.
				WSTR:(K++) = 　８명이라고 답한 사람의 연인은, 몇 명이라고 답한 사람이 될까. 그것은……」
				CALL メッセージ欄表示用関数(立ち絵_フリーレン,"フリーレン",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「이런, 그 이상은 답을 가르쳐주는 것과 같다. 거기서 멈춰라, 마법사」
				CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
				CALL 口上変数初期化
				WSTR:(K++) = era에게 입을 막힌 프리렌은 으음으음 하고 신음하고 있다.
				WSTR:(K++) = 연인 한 쌍마다 생각하는 건가. 다시 한번 생각해 보자.
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			CASE "[やっぱりやめる]"
				CALL 口上変数初期化
			CASEELSE
				CLEARLINE 1
				REUSELASTLINE  
				GOTO LOOP_MESSAGE
		ENDSELECT
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_魔導書の謎解き試練_11_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 11
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "11_2")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_4")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 다음 방에 왔다. 이 방에서도 같은 석상이, 수수께끼가 적힌 석판을 들고 있는 것 같다.
			WSTR:(K++) = 석상이 들고 있는 수수께끼를 살펴보자.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			KSTR:(K++) = 여기에, 연인 사이인 로미오와 줄리엣이 있다.
			KSTR:(K++) = 로미오와 줄리엣은, 4쌍의 연인들(총 8명)을 초대하여 파티를 열었다.
			KSTR:(K++) = 파티 중에서, 참가한 10명은 「첫 만남의 상대」와만 악수를 했다.
			CALL メッセージ欄表示用関数()
			CALL 口上変数初期化
			KSTR:(K++) = 파티가 끝난 후, 로미오는 자신 이외의 파티 참가자 9명에게 「몇 명과 악수를 했는지」를 물었다.
			KSTR:(K++) = 그러자, 9명 전원이 다른 대답을 했다.
			KSTR:(K++) = 그렇다면, 줄리엣은 몇 명과 악수를 했을까?
			KSTR:(K++) = 덧붙이자면, 「이 파티에서 자신의 연인과 처음 만났다」는 사람은 없다.
			CALL メッセージ欄表示用関数()
			CALL 口上変数初期化
			WSTR:(K++) = 꽤 어려워 보이는 수수께끼다.
			WSTR:(K++) = 다른 누군가와 함께 생각해서, 힌트가 될 만한 생각을 얻어도 좋을지도 모른다.
			WSTR:(K++) = 아니면, 도저히 모르겠다면 포기하고 era에게 답을 듣는 방법도 있다.
			WSTR:(K++) = 힌트를 들을 경우 위 칸으로. 해답하거나, 혹은 포기한다면 오른쪽 칸으로 나아가자.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 여기에, 연인 사이인 로미오와 줄리엣이 있다.
			KSTR:(K++) = 로미오와 줄리엣은, 4쌍의 연인들(총 8명)을 초대하여 파티를 열었다.
KSTR:(K++) = 파티에서, 참가한 10명은 '처음 만나는 상대'와만 악수를 했다.
			CALL メッセージ欄表示用関数()
			CALL 口上変数初期化
			KSTR:(K++) = 파티가 끝난 후, 로미오는 자신을 제외한 파티 참가자 9명에게 '몇 명과 악수를 했는지' 물었다.
			KSTR:(K++) = 그러자, 9명 전원이 다른 대답을 했다.
			KSTR:(K++) = 그렇다면, 줄리엣은 몇 명과 악수를 했을까?
			KSTR:(K++) = 덧붙이자면, '이 파티에서 자신의 연인을 처음 만났다'는 사람은 없다.
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_魔導書の謎解き試練_13_4(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_フェルン
マス深度 = 13
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "15_4")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			$再視聴表示
			KSTR:(K++) = 두 번째 수수께끼에 도전했다.
			CALL 再視聴確認(1)
			SIF RESULT
				GOTO 再視聴表示
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			WSTR:(K++) = 자, 어떻게 답할까.
			KSTR:(K++) = BUTTON_[숫자를 입력한다]
			KSTR:(K++) = BUTTON_[포기하고 era에게 답을 듣는다]
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[数字を入力する]"
					DRAWLINE
					PRINTL 임의의 숫자를 입력해 주세요 (반각 숫자)
					DRAWLINE
					INPUT
					SELECTCASE RESULT
						CASE 4
							CALLF 顔グラ表示用文字列関数(キャラ検索("[フリーレンの弟子]フェルン"),101,,,1,1)
							立ち絵_フェルン = %立ち絵リソース記録%
							WSTR:(K++) = 「너의 예지를 인정하노라……」
							CALL メッセージ欄表示用関数(,"石像の声",,0)
							CALL 口上変数初期化
							WSTR:(K++) = 석상에서 목소리가 울려 퍼짐과 동시에, 다음 방으로 향하는 문이 열렸다.
							WSTR:(K++) = 무사히 정답을 맞힌 것 같다.
							CALL メッセージ欄表示用関数(,,,0)
							CALL 口上変数初期化
							WSTR:(K++) = 「로미오 님도 줄리엣 님도, 둘 다 4명과 악수를 했네요.
							WSTR:(K++) = 　어떻게든 정답을 맞혔습니다」
							CALL メッセージ欄表示用関数(立ち絵_フェルン,"フェルン",,0)
							CALL 口上変数初期化
WSTR:(K++) = 페른도 정답을 찾아낸 것 같았다.
							WSTR:(K++) = 당당하게 다음 방으로 나아가자.
							CALL メッセージ欄表示用関数(,,,0)
							CALL 口上変数初期化
						CASEELSE
							WSTR:(K++) = 「오답!!」
							CALL メッセージ欄表示用関数(,"石像の声",,0)
							CALL 口上変数初期化
							WSTR:(K++) = 석상에서 목소리가 울려 퍼짐과 동시에, %CALLNAME:PLAYER% 위에서 대량의 물이 쏟아져 내렸다.
							WSTR:(K++) = 다칠 정도의 기세는 아니었지만, 흠뻑 젖어버렸다……。
							WSTR:(K++) = 오답에 대한 페널티인 것 같았다. 다시 한번, 생각해 보자.
							CALL メッセージ欄表示用関数(,,,0)
							CALL 口上変数初期化
							IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
								CALL マス未踏破戻し処理(ダンジョン現在位置:0, ダンジョン現在位置:1)
								ダンジョン現在位置:0 = 11
								ダンジョン現在位置:1 = 4
							ENDIF
							RETURN 0
					ENDSELECT
				CASE "[ギブアップしてeraに答えてもらう]"
					CALLF 顔グラ表示用文字列関数(キャラ検索("[フリーレンの弟子]フェルン"),101,,,1,1)
					立ち絵_フェルン = %立ち絵リソース記録%
					WSTR:(K++) = 「어쩔 수 없군, 나의 계약자여.
					WSTR:(K++) = 　그럼 성정수인 내가 해답과 해설을 해주지」
					CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 부탁드립니다 era님.
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「우선 주목해야 할 점은 「모두 악수한 사람 수가 다르다」「연인과 초면인 사람은 없다」는 점이다.
					WSTR:(K++) = 　즉, 여기서 「각자의 대답은 0명~8명」이라는 상황을 도출할 수 있다.
					WSTR:(K++) = 　그럼 다음으로, 「8명이라고 대답한 사람의 연인」에 대해 생각해 보자」
					CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「8명이라고 대답한 사람이 존재하는 이상, 「8명이라고 대답한 사람과 그 연인 외에는, 반드시 1번은 악수를 했다」는 것이 된다.
					WSTR:(K++) = 　즉, 소거법에 의해 「8명이라고 대답한 사람의 연인은, 0명이라고 대답한 사람이다」는 것이 확정되는 것이다」
					CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 　나머지는 반복이다. 7명이라고 대답한 사람은, 「0명이라고 대답한 사람・자신・자신의 연인 외의 모든 사람과 악수를 했다」는 것이므로
					WSTR:(K++) = 　7명이라고 답한 자와 그 연인 외에는, 반드시 2번 악수를 하고 있다. 즉 「7명이라고 답한 자의 연인은, 1명이라고 답한 자이다」」
					CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「조합으로는 8-0, 7-1, 6-2, 5-3이 되고……남은 마지막 조합은 4-4.
					WSTR:(K++) = 　즉 줄리엣이 악수한 인원수는 4명이다.
					WSTR:(K++) = 　로미오만은 질문에 답하지 않았기 때문에, 줄리엣과 인원수가 같아도 모순되지 않는다.
					WSTR:(K++) = 　자, 너는 어디까지 이해했으려나?」
					CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
					CALL 口上変数初期化
					WSTR:(K++) = era가 으스대는 얼굴로 해설하면서 답을 입력하자, 다음 방으로 나아가는 문이 열렸다.
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「어떻게든 정답을 맞혔습니다」
					CALL メッセージ欄表示用関数(立ち絵_フェルン,"フェルン",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 페른 쪽은 정답을 이끌어내고 있었던 것 같다.
					WSTR:(K++) = %CALLNAME:PLAYER%는 포기해 버렸지만, 마음을 다잡고 다음 방으로 나아가자.
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_魔導書の謎解き試練_15_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 15
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		;移動先Yと移動先Yを、移動先の位置に変更すること
		IF 初来訪マス判定用フラグ
			;移動直後はマスイベント発動しないので、移動先のルート開放をここで行う
			CALL 接続ルート全開放処理(16, 4)
		ENDIF
		ダンジョン現在位置:0 = 16
		ダンジョン現在位置:1 = 4
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_魔導書の謎解き試練_16_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 16
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "19_4")
	CASE "マスイベント"
		;移動先Yと移動先Yを、移動先の位置に変更すること
		ダンジョン現在位置:0 = 15
		ダンジョン現在位置:1 = 4
		CALL 画面再描画
ENDSELECT




@ダンジョンマス情報_魔導書の謎解き試練_19_2(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_フリーレン
#DIMS 立ち絵_フェルン
#DIMS 立ち絵_シュタルク
マス深度 = 19
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
	CASE "マスイベント"
		KSTR:(K++) = 누구에게 이야기를 들어볼까?
		KSTR:(K++) = BUTTON_[페른과 이야기한다]_（약간의 힌트）
		KSTR:(K++) = BUTTON_[프리렌과 이야기한다]_（큰 힌트）
		KSTR:(K++) = BUTTON_[슈타르크와 이야기한다]_（거의 정답）
		KSTR:(K++) = BUTTON_[역시 그만둔다]
		CALL メッセージ欄表示用関数(,,,0)
		CALL 口上変数初期化
		$LOOP_MESSAGE
		INPUTS
		SELECTCASE RESULTS
			CASE "[フェルンと話す]"
				CALLF 顔グラ表示用文字列関数(キャラ検索("[フリーレンの弟子]フェルン"),101,,,1,1)
				立ち絵_フェルン = %立ち絵リソース記録%
				WSTR:(K++) = 페른에게 말을 걸어보자. 이 수수께끼, 어떻게 생각해?
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「티아마트님 2명과 유그드라실님 3명이 콜로서스님과 같으니까……
				WSTR:(K++) = 　티아마트님은…… 이거, 체중이 확정되지 않는 건가……」
				CALL メッセージ欄表示用関数(立ち絵_フェルン,"フェルン",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 페른은 땅에 글자를 써서 생각하고 있다.
				WSTR:(K++) = 확실히, 이 조건으로는 각자의 체중은 확정되지 않는다.
				WSTR:(K++) = 혹시, 성정수의 체중과 답은 관계없는 것이 아닐까? 다시 한번 생각해 보자.
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			CASE "[フリーレンと話す]"
				CALLF 顔グラ表示用文字列関数(キャラ検索("[葬送]フリーレン"),100,,,1,1)
				立ち絵_フリーレン = %立ち絵リソース記録%
				WSTR:(K++) = 프리렌에게 말을 걸어보자. 이 수수께끼, 어떻게 생각해?
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「「나」가 무엇을 가리키는지가 중요하지 않을까.
				WSTR:(K++) = 　이런 수수께끼도 그립네.
				WSTR:(K++) = 　옛날, 힘멜 일행과 여행을 했을 때도 수수께끼 던전에 도전한 적이 있었지……」
				CALL メッセージ欄表示用関数(立ち絵_フリーレン,"フリーレン",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 추억 이야기가 시작되어 버렸다. 재미있을 것 같은 이야기지만, 길어질 것 같다.
				WSTR:(K++) = 「나」가 무엇을 가리키는지를 생각하는 건가. 다시 한번 생각해 보자.
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			CASE "[シュタルクと話す]"
				CALLF 顔グラ表示用文字列関数(キャラ検索("[戦士]シュタルク"),102,,,1,1)
				立ち絵_シュタルク = %立ち絵リソース記録%
				WSTR:(K++) = 슈타르크에게 말을 걸어보자. 이 수수께끼, 어떻게 생각해?
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「에이…… 이거 말장난이잖아……
				WSTR:(K++) = 　왜냐면 상의 모습이」
				CALL メッセージ欄表示用関数(立ち絵_シュタルク,"シュタルク",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「이런, 그 이상은 답을 알려주는 것과 같아. 거기서 멈춰라」
				CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 슈탈크는 era에게 입을 막혀 끙끙거리고 있다.
				WSTR:(K++) = 조각상의 모습인가. 문제를 내는 조각상은 어떤 모습이었을까?
				WSTR:(K++) = 이전 칸을 다시 한번 보고 오는 것도 좋을지도 모른다. 다시 한번 생각해 보자.
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			CASE "[やっぱりやめる]"
				CALL 口上変数初期化
			CASEELSE
				CLEARLINE 1
				REUSELASTLINE  
				GOTO LOOP_MESSAGE
		ENDSELECT
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_魔導書の謎解き試練_19_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 19
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "19_2")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "21_4")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 다음 방에 왔다. 이 방에서도 같은 석상이, 수수께끼가 적힌 석판을 들고 있는 것 같다.
			WSTR:(K++) = 또한, 석판에는 이것이 마지막 수수께끼라고 적혀 있다.
			WSTR:(K++) = 석상이 들고 있는 수수께끼를 보자.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			KSTR:(K++) = 여기에, 체중이 100톤인 성정수 콜로서스가 있다.
			KSTR:(K++) = 티아마트의 체중은 콜로서스의 절반보다 가볍고, 유그드라실의 체중은 티아마트보다 가볍다.
			KSTR:(K++) = 티아마트 2인분의 체중과 유그드라실 3인분의 체중을 더한 것과, 콜로서스의 체중은 같다.
			KSTR:(K++) = 자, 그럼 나는 몇 톤인가? 
			CALL メッセージ欄表示用関数()
			CALL 口上変数初期化
			WSTR:(K++) = 이것은……? 색다른 수수께끼인 것 같다.
			WSTR:(K++) = 다른 누군가와 함께 생각해서, 힌트가 될 만한 생각을 얻어도 좋을지도 모른다.
			WSTR:(K++) = 아니면, 도저히 모르겠다면 포기하고 era에게 답을 듣는 방법도 있다.
			WSTR:(K++) = 힌트를 들을 경우에는 위 칸으로. 해답하거나, 아니면 포기할 경우 오른쪽 칸으로 나아가자.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 여기에, 체중이 100톤인 성정수 콜로서스가 있다.
			KSTR:(K++) = 티아마트의 체중은 콜로서스의 절반보다 가볍고, 위그드라실의 체중은 티아마트보다 가볍다.
			KSTR:(K++) = 티아마트 2인분의 체중과 위그드라실 3인분의 체중을 더한 것과 콜로서스의 체중은 같다.
			KSTR:(K++) = 자, 그럼 나는 몇 톤일까? 
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_魔導書の謎解き試練_21_4(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_フェルン
マス深度 = 21
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "23_4")
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			$再視聴表示
			KSTR:(K++) = 세 번째 수수께끼에 도전했다.
			CALL 再視聴確認(1)
			SIF RESULT
				GOTO 再視聴表示
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			WSTR:(K++) = 자, 뭐라고 답할까.
			KSTR:(K++) = BUTTON_[답을 입력한다]
			KSTR:(K++) = BUTTON_[포기하고 era에게 답을 듣는다]
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[答えを入力する]"
					DRAWLINE
					PRINTL 임의의 답을 입력해 주세요 (전각)
					DRAWLINE
					INPUTS
					SELECTCASE RESULTS
						CASE "スケルトン", "スケル"
							CALLF 顔グラ表示用文字列関数(キャラ検索("[フリーレンの弟子]フェルン"),101,,,1,1)
							立ち絵_フェルン = %立ち絵リソース記録%
							WSTR:(K++) = 「너의 예지를 인정하노라……」
							CALL メッセージ欄表示用関数(,"石像の声",,0)
							CALL 口上変数初期化
							WSTR:(K++) = 석상에서 목소리가 울려 퍼짐과 동시에, 다음 방으로 향하는 문이 열렸다.
							WSTR:(K++) = 무사히 정답을 맞힌 것 같다.
							CALL メッセージ欄表示用関数(,,,0)
							CALL 口上変数初期化
							WSTR:(K++) = 「……체중, 관계없지 않습니까」
							CALL メッセージ欄表示用関数(立ち絵_フェルン,"フェルン",,0)
							CALL 口上変数初期化
							WSTR:(K++) = 페른은 이해하지 못한 듯, 뾰로통하게 볼을 부풀리고 있다.
							WSTR:(K++) = 이것으로 수수께끼는 모두 끝난 것 같다.
							WSTR:(K++) = 앞으로 나아가 책 속에서 탈출하자.
							CALL メッセージ欄表示用関数(,,,0)
							CALL 口上変数初期化
						CASEELSE
							WSTR:(K++) = 「오답!!」
							CALL メッセージ欄表示用関数(,"石像の声",,0)
							CALL 口上変数初期化
							WSTR:(K++) = 석상에서 목소리가 울려 퍼짐과 동시에, %CALLNAME:PLAYER% 위에서 대량의 물이 쏟아져 내렸다.
							WSTR:(K++) = 다칠 정도의 기세는 아니었지만, 흠뻑 젖어버렸다……。
							WSTR:(K++) = 오답에 대한 페널티인 듯하다. 다시 한번, 생각해 보자.
							CALL メッセージ欄表示用関数(,,,0)
							CALL 口上変数初期化
							IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
								CALL マス未踏破戻し処理(ダンジョン現在位置:0, ダンジョン現在位置:1)
								ダンジョン現在位置:0 = 11
								ダンジョン現在位置:1 = 4
							ENDIF
							RETURN 0
					ENDSELECT
				CASE "[ギブアップしてeraに答えてもらう]"
					CALLF 顔グラ表示用文字列関数(キャラ検索("[フリーレンの弟子]フェルン"),101,,,1,1)
					立ち絵_フェルン = %立ち絵リソース記録%
					WSTR:(K++) = 「어쩔 수 없군, 나의 계약자는.
					WSTR:(K++) = 　그럼 성정수(星晶獣)인 내가 해답과 해설을 해주지」
					CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 부탁드립니다 era님.
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「우선 주목해야 할 점은 「대답해야 할 것은 「나」이며, 성정수(星晶獣)는 관계없다」는 점이다.
					WSTR:(K++) = 　즉, 체중 100톤이니 뭐니 하는 것은 일절 관계없다.
					WSTR:(K++) = 　처음 2문제가 논리를 묻는 수수께끼였던 것을 감안한, 일종의 함정 문제로군」
					CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「그럼, 「나」란 무엇인가. 그것은 문제를 내고 있는 석상 그 자체를 말한다.
					WSTR:(K++) = 　석상의 모습은 기억하는가? 그렇다, 「호화로운 로브를 두른 해골 석상」이다.
					WSTR:(K++) = 　해골에, 「◯◯톤」이라고 하면…… 「스켈레톤」을 떠올리는 것은 어렵지 않을 것이다」
					CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「뭐, 말장난 같은 것이다.
					WSTR:(K++) = 　감이 올지 안 올지는 운의 요소도 크다. 대답하지 못해도 낙담할 필요는 없어」
					CALL メッセージ欄表示用関数("顔エラ","星晶獣era",,0)
					CALL 口上変数初期化
					WSTR:(K++) = era가 으스대며 해설하면서 답을 입력하자, 마지막 문이 열렸다.
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
					WSTR:(K++) = 「……체중, 관계없지 않습니까?」
					CALL メッセージ欄表示用関数(立ち絵_フェルン,"フェルン",,0)
					CALL 口上変数初期化
					WSTR:(K++) = 페른 쪽도 몰랐던 것 같아, 뾰로통하게 뺨을 부풀리고 있다.
					WSTR:(K++) = %CALLNAME:PLAYER%는 포기해 버렸지만, 이걸로 수수께끼는 끝인 것 같다.
					WSTR:(K++) = 앞으로 나아가, 책 속에서 탈출하자.
					CALL メッセージ欄表示用関数(,,,0)
					CALL 口上変数初期化
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_魔導書の謎解き試練_23_4(ARGS)
#DIM マス深度
#DIM マス分岐
#DIMS 立ち絵_フリーレン
#DIMS 立ち絵_フェルン
#DIMS 立ち絵_シュタルク
マス深度 = 23
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
	CASE "マスイベント"
		RFLAG:ダンジョン再視聴フラグ = 0
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT RFLAG:ダンジョン再視聴フラグ, 0
			SETBIT RFLAG:ダンジョン再視聴フラグ, 1
			SETBIT RFLAG:ダンジョン再視聴フラグ, 10
		ELSE
			$再視聴表示
			KSTR:(K++) = 마법을 손에 넣어, 책 속에서 탈출했다.
			CALL 再視聴確認(1)
			SIF RESULT
				GOTO 再視聴表示
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 0)
			CALLF 顔グラ表示用文字列関数(キャラ検索("[葬送]フリーレン"),100,,,1,1)
			立ち絵_フリーレン = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[フリーレンの弟子]フェルン"),101,,,1,1)
			立ち絵_フェルン = %立ち絵リソース記録%
			CALLF 顔グラ表示用文字列関数(キャラ検索("[戦士]シュタルク"),102,,,1,1)
			立ち絵_シュタルク = %立ち絵リソース記録%
			WSTR:(K++) = 수수께끼를 풀고 나아간 가장 안쪽에는, 한 권의 마도서가 떠 있었다.
			WSTR:(K++) = 마도서 안에서 마도서라는 것도 이상한 이야기지만, 어쨌든 이걸로 마법을 습득할 수 있는 것 같다.
			WSTR:(K++) = 어떤 마법이 담겨 있을까. 프리렌이 마도서를 손에 들고, 팔랑팔랑 넘긴다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「이것은……「책을 열 때, 마지막으로 읽은 페이지를 한 번에 여는 마법」이네」
			CALL メッセージ欄表示用関数(立ち絵_フリーレン,"フリーレン",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 책갈피를 사용하면 되는 것 아닌가.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「프리렌님은 특이한 마법을 모으는 것을 좋아하세요」
			CALL メッセージ欄表示用関数(立ち絵_フェルン,"フェルン",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 본인이 만족한다면 좋겠지만…….
			WSTR:(K++) = 어쨌든, 문제도 있었지만 이걸로 탈출할 수 있을 것이다.
			WSTR:(K++) = 리조트에서 편히 쉬다 가셨으면 좋겠다며, 세 사람에게 환영의 뜻을 표한다.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = 「오랜만에 마을에서 잠들 수 있다니, 기대되네」
			CALL メッセージ欄表示用関数(立ち絵_シュタルク,"シュタルク",,0)
			CALL 口上変数初期化
WSTR:(K++) = 「다른 세계라니, 역시 나도 처음이니까 말이야.
WSTR:(K++) = 　이세계의 마도서를 가능한 한 많이 사두고 싶네」
			CALL メッセージ欄表示用関数(立ち絵_フリーレン,"フリーレン",,0)
			CALL 口上変数初期化
WSTR:(K++) = 「너무 낭비하지 마세요. 노자도 불안한데요」
			CALL メッセージ欄表示用関数(立ち絵_フェルン,"フェルン",,0)
			CALL 口上変数初期化
WSTR:(K++) = 시끌벅적 떠드는 세 사람과 함께, 마도서에서 탈출한다.
WSTR:(K++) = 성정수 era도 수수께끼 풀이 놀이에 만족한 듯, 기분 좋아 보이는 얼굴을 하고 있다.
WSTR:(K++) = 꽤나 힘든 던전이었지만, 아무도 다치지 않았으니 좋다고 해둘까.
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
WSTR:(K++) = [장송]프리렌이 리조트를 방문하게 되었다!
WSTR:(K++) = [프리렌의 제자]페른이 리조트를 방문하게 되었다!
WSTR:(K++) = [전사]슈타르크가 리조트를 방문하게 되었다!
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		IF GETBIT(RFLAG:ダンジョン再視聴フラグ, 10)
			;再視聴では通らない報酬部分
			CFLAG:(キャラ検索("[葬送]フリーレン")):招待不可フラグ = 0
			CFLAG:(キャラ検索("[フリーレンの弟子]フェルン")):招待不可フラグ = 0
			CFLAG:(キャラ検索("[戦士]シュタルク")):招待不可フラグ = 0

			IF 滞在キャラ上限 - 滞在キャラ数 - 集客人数 - FLAG:滞在キャラ枠先確保分 > 2
				解放キャラ招待:(FINDELEMENT(解放キャラ招待, 0)) = キャラ検索("[葬送]フリーレン")
				解放キャラ招待:(FINDELEMENT(解放キャラ招待, 0)) = キャラ検索("[フリーレンの弟子]フェルン")
				解放キャラ招待:(FINDELEMENT(解放キャラ招待, 0)) = キャラ検索("[戦士]シュタルク")
				FLAG:滞在キャラ枠先確保分 += 3
			ENDIF

			ダンジョン終了状況 = 踏破達成
			ダンジョンクリアフラグ_魔導書の謎解き試練 = 1
		ENDIF
		RFLAG:ダンジョン再視聴フラグ = 0
		CALL メッセージ欄表示用関数(,,,0)
		CALL 画面再描画
ENDSELECT




