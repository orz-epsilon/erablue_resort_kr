;==================================================================================================
@ゆきずりセックス判定(ARG)
;-------------------------------------------------
;ARG番のキャラがゆきずりセックスを実行するかを返す関数
;実行する場合フラグ立てまで行う
;開始時, 実行中には1を返す
;終了時, 開始しない時, 途中終了時には0を返す
;--------------------------------------------------------------------------------------------------

;--------------------------------------------------------------------------------------------------

;既に実行中の場合は継続判定に移行する。直前の行動が「覗く」ならとりあえず継続処理
IF IS_ゆきずりセックス中(ARG) || TCVAR:ARG:ゆきずりセックス_覗きフラグ
	CALL ゆきずりセックス継続判定(ARG)
	RETURN RESULT
ENDIF

;▼処理を行うかの判定▼
;直前の行動が時間が経過しないコマンドの場合は処理をスキップ
SIF !TIME_PROGRESS(TFLAG:行動前時刻)
	RETURN 0

;睡眠中は素直に寝てなさい
SIF CFLAG:ARG:睡眠
	RETURN 0
;ダウン中も素直に寝てなさい
SIF BASE:ARG:体力 < 1
	RETURN 0

;あなた宅に上がり込まない
SIF CFLAG:ARG:現在マップ種別 == 0 && CFLAG:ARG:現在位置 >= 2000
	RETURN 0
;脱衣所、風呂場などの異性禁止エリアに侵入しない
SIF CFLAG:ARG:現在マップ種別 == 0 && (CFLAG:ARG:現在位置 >= 7 && CFLAG:ARG:現在位置 <= 14)
	RETURN 0
SIF CFLAG:ARG:現在マップ種別 == 0 && (CFLAG:ARG:現在位置 >= 700 && CFLAG:ARG:現在位置 <= 900)
	RETURN 0

;性知識が無い場合は誘わない
SIF 知識素質:ARG:性知識 < 0
	RETURN 0
	
;性感帯無い場合も駄目
SIF !HAS_EROGENOUS_ZONE(ARG)
	RETURN 0
	
;同行中はやんないよ
SIF CFLAG:ARG:同行
	RETURN 0
SIF CFLAG:ARG:一緒に遊ぶ
	RETURN 0
SIF CFLAG:ARG:デート
	RETURN 0
SIF CFLAG:ARG:うふふ
	RETURN 0
SIF MODE_存在判定_いずれか側("同行系", ARG)
	RETURN 0
SIF MODE_存在判定_いずれか側("キス系", ARG)
	RETURN 0
SIF MODE_存在判定_ターゲット側("全裸散歩", ARG)
	RETURN 0
SIF MODE_存在判定_いずれか側("ハーヴィンオナホ系", ARG)
	RETURN 0

;既に誰かが同じ場所で隠密してるなら発生しない
FOR LOCAL, 0, CHARANUM
	SIF LOCAL == ARG
		CONTINUE
	SIF IS_SAME_ROOM(ARG, LOCAL) && CFLAG:LOCAL:隠密
		RETURN 0
NEXT

;興味の場合は4h、愛好の場合は2h、中毒の場合は1h毎にそれぞれ判定を発生させる
SELECTCASE 性癖素質:ARG:ゆきずりセックス
	CASE 1
		SIF TCVAR:ARG:ゆきずりセックス_終了時刻 + 4 * 60 > NOW()
			RETURN 0
	CASE 2
		SIF TCVAR:ARG:ゆきずりセックス_終了時刻 + 2 * 60 > NOW()
			RETURN 0
	CASE 3
		SIF TCVAR:ARG:ゆきずりセックス_終了時刻 + 1 * 60 > NOW()
			RETURN 0
ENDSELECT

;現在の性欲値が性癖レベルによる割合以下(1:50%,2:40%,3:30%)なら発生しない
SIF BASE:ARG:性欲 < (MAXBASE:ARG:性欲 * ( 10 - ( 6 - 性癖素質:ARG:ゆきずりセックス )) / 10 )
	RETURN 0
	
;実行閾値の設定
SIF !ゆきずりセックス実行判定(ARG)
	RETURN 0



;ゆきずりセックス回数のカウントアップ
IF CFLAG:ARG:リゾート内ゆきずりセックス回数 < 1
	CALL 履歴データベース登録(CFLAG:ARG:人物番号, @"<font color='#%カラーパレット_HTML("薄ピンク")%'>初めてリゾート内で[ゆきずりセックス]をした</font>","うふふ")
ELSEIF CFLAG:ARG:リゾート内ゆきずりセックス回数 == 9
	CALL 履歴データベース登録(CFLAG:ARG:人物番号, @"<font color='#%カラーパレット_HTML("薄ピンク")%'>リゾート内で[ゆきずりセックス]をした回数が１０回に到達した</font>","うふふ")
ELSEIF CFLAG:ARG:リゾート内ゆきずりセックス回数 == 49
	CALL 履歴データベース登録(CFLAG:ARG:人物番号, @"<font color='#%カラーパレット_HTML("薄ピンク")%'>リゾート内で[ゆきずりセックス]をした回数が５０回に到達した</font>","うふふ")
ELSEIF CFLAG:ARG:リゾート内ゆきずりセックス回数 == 99
	CALL 履歴データベース登録(CFLAG:ARG:人物番号, @"<font color='#%カラーパレット_HTML("薄ピンク")%'>リゾート内で[ゆきずりセックス]をした回数が１００回に到達した</font>","うふふ")
ENDIF
CFLAG:ARG:リゾート内ゆきずりセックス回数 ++

;プレイ内容の決定
CALL ゆきずりセックス内容決定(ARG)

;残り時間と絶頂値を初期化
TCVAR:ARG:ゆきずりセックス_残時間 = 90
TCVAR:ARG:ゆきずりセックス_絶頂値 = 100

;隠密状態にする
CFLAG:ARG:隠密 = 1

RETURN 1

;==================================================================================================
@ゆきずりセックス実行判定(ARG)
#FUNCTION
;-------------------------------------------------
;ARG番のキャラがゆきずりセックスを実行するかを返す関数
;実行する場合には1を返し、それ以外は0を返す
;--------------------------------------------------------------------------------------------------
#DIM 誘い係数
#DIM 誘われ係数
#DIM 何もしない係数
;--------------------------------------------------------------------------------------------------


;**********************************************************************************
; 誘われ係数の設定
;  --- 性的魅力に関わる素質や誘う側が優位に立てそうな素質に影響。
;      対象キャラの性欲値は影響しない。
;      「エロい人」や「気の弱そうな人」、「優しそうな人」は誘われやすくなり、
;      「見た目が子供」「怖そうな人」「厳しそうな人」「断られそうな人」は若干誘われにくくなる。

;係数の初期化
誘われ係数 = 0

;○「エロい人」判定の素質群
;素質[淫乱]所持している
SIF TALENT:ARG:淫乱
	誘われ係数 += 1

;素質[恥薄い]所持している
SIF TALENT:ARG:羞恥心 < 0
	誘われ係数 += 1

;巨乳以上である
SIF TALENT:ARG:バストサイズ > 0
	誘われ係数 += 1

;発情期中である なんかそういうフェロモンでてそう
SIF CFLAG:ARG:発情期フラグ
	誘われ係数 += 1

;○「気の弱そうな人」判定の素質群
;素質[臆病]所持している
SIF TALENT:ARG:度胸 < 0
	誘われ係数 += 1

;素質[押しに弱い]所持している
SIF TALENT:ARG:マイペース < 0
	誘われ係数 += 1

;素質[プライド低い]所持している
SIF TALENT:ARG:プライド < 0
	誘われ係数 += 1

;○「優しそうな人」判定の素質群
;素質[素直]所持している
SIF TALENT:ARG:態度 < 0
	誘われ係数 += 1

;素質[大人しい]所持している
SIF TALENT:ARG:応答 < 0
	誘われ係数 += 1

;素質[淑女的]所持している
SIF TALENT:ARG:精神的余裕 == 2
	誘われ係数 += 1

;素質[面倒見が良い]所持している
SIF TALENT:ARG:無関心 < 0
	誘われ係数 += 1


;●マイナス判定の素質群
;素質[気丈]所持している
SIF TALENT:ARG:度胸 > 0
	誘われ係数 -= 1

;素質[反抗的]所持している
SIF TALENT:ARG:態度 > 0
	誘われ係数 -= 1

;素質[プライド高い]所持している
SIF TALENT:ARG:応答 > 0
	誘われ係数 -= 1

;素質[生意気]所持している
SIF TALENT:ARG:プライド > 0
	誘われ係数 -= 1

;素質[ツンデレ]所持している
SIF TALENT:ARG:ツンデレ
	誘われ係数 -= 1

;素質[真面目][自制心]所持している
SIF TALENT:ARG:自制心 > 0
	誘われ係数 -= 1

;素質[無関心]所持している
SIF TALENT:ARG:無関心 > 0
	誘われ係数 -= 1

;素質[抵抗]所持している
SIF TALENT:ARG:抵抗
	誘われ係数 -= 1
	
;見た目が子供っぽい
SIF TALENT:ARG:外見年齢 == 10 && TALENT:ARG:外見年齢 == 11
	誘われ係数 -= 1


;最低でも3は持つようにする
誘われ係数 = MAX(3,誘われ係数)

;**********************************************************************************
; 誘い係数の設定
;  --- 現在の性欲値や欲情状態に強く影響

;係数を現在の性欲割合で初期化
誘い係数 = (BASE:ARG:性欲 * 100) / MAXBASE:ARG:性欲

;素質[淫乱]所持している
SIF TALENT:ARG:淫乱
	誘い係数 += 1

;最低でも3は持つようにする
誘い係数 = MAX(3,誘い係数)


;**********************************************************************************
; 何もしない係数の設定
;  --- 基本値は誘い+誘われ。

何もしない係数 = 誘い係数 + 誘われ係数


;乱数で実行判定を行う
SELECTCASE RAND:(誘い係数 + 誘われ係数 + 何もしない係数)
	CASE 0 TO 誘い係数
		;誘い
		TCVAR:ARG:ゆきずりセックス_誘い = 0
		
	CASE 誘い係数 TO 誘い係数 + 誘われ係数
		;誘われ
		TCVAR:ARG:ゆきずりセックス_誘い = 1
		
	CASEELSE
		;何もしないはそのまま0を返す
		RETURNF 0
		
ENDSELECT

;ランダムな竿役の決定 0918時点でとりあえず7種。CASEELSEだけちょっと確率高め
TCVAR:ARG:ゆきずりセックス_相手モブ = RAND:8
TCVAR:ARG:ゆきずりセックス_相手描写 = 0

;同室なら物陰に行く描写を行う
IF CFLAG:ARG:同室
	SETCOLOR カラーパレット("えっちな色")
	IF TCVAR:ARG:ゆきずりセックス_誘い
		;NPCに誘われる
		PRINTFORML %CALLNAME:ARG%은(는) 관광객에게 성행위를 요구받아 물그림자 속으로 이동했다……
		;お金を対価に性行為を持ち掛けられた%CALLNAME:ARG%は、交渉のすえ/待っていたとばかりに嬉々として/妖艶な笑みをうかべて承諾すると客に手を引かれ物陰に連れ込まれていった……
	ELSE
		;NPCを誘う
		PRINTFORML %CALLNAME:ARG%은(는) 근처에 있던 관광객을 유혹하여 물그림자 속으로 이동했다……
	ENDIF
	RESETCOLOR
ENDIF

RETURNF 1



;==================================================================================================
@ゆきずりセックス継続判定(ARG)
;-------------------------------------------------
;ARG番のキャラがゆきずりセックスを継続するか返す関数
;継続する場合には1を返し、終了する場合には0を返す
;--------------------------------------------------------------------------------------------------

;--------------------------------------------------------------------------------------------------

;対象の隠密状態を継続
CFLAG:ARG:隠密 = 1

;時間が経過しないコマンドの場合は処理をスキップ
IF TIME_PROGRESS(TFLAG:行動前時刻)
	
	;残時間の減少処理
	TCVAR:ARG:ゆきずりセックス_残時間 = MAX(0, TCVAR:ARG:ゆきずりセックス_残時間 - TIME_PROGRESS(TFLAG:行動前時刻))

	;直前の行動で絶頂値とパラメータの変動処理を行っているならそれらの処理をスキップ
	IF !TCVAR:ARG:ゆきずりセックス_覗きフラグ
		CALL ゆきずりセックス_絶頂値更新(ARG, TIME_PROGRESS(TFLAG:行動前時刻))
		CALL ゆきずりセックス_パラメータ変動処理(ARG, TIME_PROGRESS(TFLAG:行動前時刻))
	ENDIF

ENDIF

;覗きフラグを切っておく
TCVAR:ARG:ゆきずりセックス_覗きフラグ = 0

;行為中にあなたが物陰に入ってきた処理
CALL ゆきずりセックス_遭遇処理(ARG)


;継続確認
IF IS_ゆきずりセックス中(ARG)
	RETURN 1
ELSE
	
	;同じ部屋にいるなら移動先PRINT
	IF CFLAG:ARG:同室
		SETCOLOR カラーパレット("えっちな色")
		PRINTFORML 얼굴을 붉힌 %CALLNAME:ARG%가 낯선 남자와 물그림자 속에서 나왔다……
		RESETCOLOR
	ENDIF
	
	;各関連変数を初期化
	TCVAR:ARG:ゆきずりセックス_体位 = 0
	TCVAR:ARG:ゆきずりセックス_残時間 = 0
	TCVAR:ARG:ゆきずりセックス_絶頂値 = 0
	
	;終了時間を記録
	TCVAR:ARG:ゆきずりセックス_終了時刻 = NOW()

	;覗きバレフラグを閉じておく
	TCVAR:ARG:覗きバレ = 0
	
	;隠密を解除
	CFLAG:ARG:隠密 = 0

	RETURN 0
ENDIF


;==================================================================================================
@ゆきずりセックス_絶頂値更新(ARG, 経過時間)
;-------------------------------------------------
;お相手側の絶頂値の変動を行う。
;変動量は対象の欲望と技巧によって増加し、10分を基準として経過時間によって補正がかかる。
;(5分なら50%、20分なら200%)
;--------------------------------------------------------------------------------------------------
#DIM 経過時間
#DIM 変動値
;--------------------------------------------------------------------------------------------------
IF TCVAR:ARG:ゆきずりセックス_絶頂値 > 0
	変動値 = 20
	変動値 += ABL:ARG:欲望
	変動値 += ABL:ARG:技巧
	
	;10分をベースに、経過時間変動値を補正
	変動値 *= 経過時間
	変動値 /= 10
	
	TCVAR:ARG:ゆきずりセックス_絶頂値 = MAX(0, TCVAR:ARG:ゆきずりセックス_絶頂値 - 変動値)
	
ELSE
	TCVAR:ARG:ゆきずりセックス_絶頂値 = 100
ENDIF


;==================================================================================================
@ゆきずりセックス_パラメータ変動処理(ARG, 経過時間=1)
;-------------------------------------------------
;各種パラメータの増加、性欲の減少などの変動を行う
;変動量は
;--------------------------------------------------------------------------------------------------
#DIM 絶頂閾値
#DIM 経過時間
#DIM ループ変数
#DIM 絶頂数
#DIM 性欲減少量
;--------------------------------------------------------------------------------------------------

;絶頂数を初期化
絶頂数 = 0
絶頂閾値 = 20

;絶頂閾値に対応感度を補正
SELECTCASE TCVAR:ARG:ゆきずりセックス_体位
	CASE 1 ;V
		絶頂閾値 -= TALENT:ARG:Ｖ感度
	CASE 2 ;A
		絶頂閾値 -= TALENT:ARG:Ａ感度
ENDSELECT

;対象キャラの絶頂判定
; …経過時間を閾値で割った数だけ処理を繰り返す。感度がデフォなら10分で1回、20分で2回。
FOR ループ変数, 0, 経過時間/絶頂閾値
	CALL ゆきずりセックス_絶頂加算(ARG)
	絶頂数 ++
NEXT
;上の端数は確率で絶頂判定。感度がデフォなら15分で1回の絶頂と50%の確率でさらに絶頂
IF 経過時間%絶頂閾値 > RAND:絶頂閾値
	CALL ゆきずりセックス_絶頂加算(ARG)
	絶頂数 ++
ENDIF

;絶頂数が1以上あるならZP取得処理
IF 絶頂数
	CALL ZP_取得処理(ARG, 絶頂数, 0)
	
	;絶頂出来たら性欲を20%程発散する
	;性欲減少量 = MAXBASE:ARG:性欲 / 5
	
	;絶頂で性欲を固定値で発散する 最大性欲が高いほど満足に程遠くなるって寸法よ
	性欲減少量 = 100
	
	BASE:ARG:性欲 = MAX(BASE:ARG:性欲 - 性欲減少量, 0)
ENDIF


;==================================================================================================
@ゆきずりセックス_絶頂加算(ARG)
;-------------------------------------------------
;絶頂判定を経て絶頂した時の処理
;--------------------------------------------------------------------------------------------------
;部位によって絶頂箇所を加算
SELECTCASE TCVAR:ARG:ゆきずりセックス_体位
	CASE 1 ;V
		EXP:ARG:Ｖ絶頂経験 += 1
		CALL TAKE_SPERM(ARG, -2, 25)
	CASE 2 ;A
		EXP:ARG:Ａ絶頂経験 += 1
		CALL TAKE_SPERM_A(ARG, -2, 25)
ENDSELECT
EXP:ARG:絶頂経験 += 1


;==================================================================================================
@ゆきずりセックス_遭遇処理(ARG)
;-------------------------------------------------
;「物陰に隠れる」で行為中のキャラに遭遇してしまったときの処理
;--------------------------------------------------------------------------------------------------
#DIM 経過時間
;--------------------------------------------------------------------------------------------------

IF CFLAG:PLAYER:隠密 && IS_SAME_ROOM(ARG)

	DRAWLINE
	
	;ここで行為中のキャラとばったり遭遇
	
	;いずれ「そのまま見られながら行為を続行」とかそういうのを付けたい
	
	PRINTFORML 누군가 선객이 있는 것 같다……
	PRINTFORMW %CALLNAME:PLAYER%은(는) 선객에게 방해가 되지 않도록 조용히 그 자리를 떠났다.
	
	DRAWLINE
	
	
	;あなたと同行者の隠密を解除する
	CFLAG:PLAYER:隠密 = 0
	FOR LOCAL, 1, CHARANUM
		SIF TARGET:LOCAL < 1
			BREAK
		SIF CFLAG:(TARGET:LOCAL):同行 || CFLAG:(TARGET:LOCAL):うふふ
			CFLAG:(TARGET:LOCAL):隠密 = 0
	NEXT
	
ENDIF


;==================================================================================================
@ゆきずりセックス_覗く(ARG)
;-------------------------------------------------
;「COMF404_覗く」からゆきずりセックスを覗き見る処理
;--------------------------------------------------------------------------------------------------
#DIM 経過時間
;--------------------------------------------------------------------------------------------------

;覗きフラグを立てる
TCVAR:ARG:ゆきずりセックス_覗きフラグ = 1

;経過時間を加算
TIME += 12

;絶頂値の変動 15分は決め打ち(覗き見3分+このイベント経過時間の12分)
CALL ゆきずりセックス_絶頂値更新(ARG, 15)

;共通文章
PRINTFORM 물그림자를 엿보니,
SELECTCASE TCVAR:ARG:ゆきずりセックス_体位
	CASE 1 ;Ｖ性交
		PRINTFORML 낯선 남자에게 질 구멍을 꿰뚫려 신음하는 %CALLNAME:ARG%의 모습을 목격했다.
	CASE 2 ;Ａ性交
		PRINTFORML 낯선 남자의 남근을 엉덩이 구멍으로 물고 있는 %CALLNAME:ARG%의 모습을 목격했다.
	CASEELSE ;その他
		PRINTFORML %CALLNAME:ARG%가 사랑스럽게 낯선 남자의 페니스에 봉사하는 모습을 목격했다.
ENDSELECT
PRINTW

IF TALENT:ARG:性別 == 1 && TCVAR:ARG:ゆきずりセックス_相手描写 == 0
;女性を前提とした追加文
	SIF CFLAG:ARG:リゾート内ゆきずりセックス回数 > 10
		PRINTFORM 이번에
	PRINTFORM %CALLNAME:ARG%
	IF TCVAR:ARG:ゆきずりセックス_体位 >= 1
		PRINTFORM %TEXTR("유혹한/끌어들인/몸을 허락한/다리를 벌린/범하고 있는")% 것은
	ELSE
		PRINTFORM %TEXTR("유혹한/끌어들인")% 것은
	ENDIF

	SELECTCASE TCVAR:ARG:ゆきずりセックス_相手モブ
	CASE 0
	;冴えない童貞
		PRINTFORMW , 멀리서 봐도 별 볼 일 없는 %TEXTR("시시한/음침해 보이는")% 청년이다.
		PRINTL
		IF TCVAR:ARG:ゆきずりセックス_体位 >= 1
			PRINTFORML 방금 전까지 동정이었을 것이다.
			PRINTFORML 분명히 서툰 움직임의 남자는, 본래 어울릴 리 없는 아름다운 %CALLNAME:ARG%의 몸 앞에서 %TEXTR("탐욕스럽게/게걸스럽게")% 거칠게 허리를 흔들며,
			PRINTFORMW %CALLNAME:ARG%에 대해서는 조금도 생각하지 않고, %TEXTR("인생에서 처음 맛보는 성교 쾌락/갑자기 솟아난 최고의 암컷 구멍")%에 몰두하고 있다.
			PRINTL
			PRINTFORML 난폭하게 허리를 잡히고, 때로는 %TEXTR("흔적이 남을 정도로/쥐어짜듯이")% 강하게 가슴을 더듬거리면서,
			PRINTFORMW 고통마저 느끼고 있을 %CALLNAME:ARG%은 그러나, 첫 경험의 배덕감과 흥분에 %TEXTR("가득 찬/도취된")% 표정으로 남자의 육봉을 받아들인다.
		ELSE
			PRINTFORML 제대로 된 여성 경험 같은 건 지금까지 없었을 것이다.
			PRINTFORMW 바랄 수도 없을 정도의 미녀에 의한 %TEXTR("음경/미사용 페니스")%에 대한 헌신적인 성 봉사를 받으며, 남자는 하늘을 우러러보듯이 그 엄청난 쾌락에 빠져 있다.
			IF CSTR:ARG:ゆきずりセックス_プレイ内容 == "フェラチオ"
				PRINTL
				PRINTFORML 이제는 쾌락을 탐하는 것밖에 머리에 없는 청년에게, %CALLNAME:ARG%를 배려할 리가 없다.
				IF TALENT:ARG:角あり
					PRINTFORM 소중한 뿔
				ELSE
					PRINTFORM 아름다운 머리카락
				ENDIF
				PRINTFORML 을 난폭하게 잡히면서, 더, 더 라며 제멋대로 박아 넣는 페니스를,
				PRINTFORMW %CALLNAME:ARG%는 그럼에도 헌신적으로, 입술로, 혀로, 목으로 받아들여 봉사한다.
			ENDIF
		ENDIF
	CASE 1
	;恰幅のいい中年
		PRINTFORMW , 불룩하게 배가 나온 체격 좋은 중년이다.
		PRINTL
		PRINTFORML 차림새가 좋은 이 남자는, 창관 등에도 익숙하게 다녔을 것이다.
		IF TCVAR:ARG:ゆきずりセックス_体位 >= 1
			PRINTFORMW %CALLNAME:ARG%의 안쪽을 찌르는 허리놀림은 익숙한 것이어서, %CALLNAME:ARG%는 쾌락에 피부를 거품처럼 만들면서 억누를 수 없는 교성에 목을 떨게 한다.
		ELSE
			PRINTFORMW 페니스에 %CALLNAME:ARG%의 정성스러운 봉사를 받으면서, 남자는 감사를 표하듯이 %CALLNAME:ARG%의 머리를 쓰다듬는다.
		ENDIF
	CASE 2
	;おねショタ(またはインピオ)
		IF TALENT:ARG:年齢層 == 10 || (BASE:ARG:年齢 <= 13 && BASE:ARG:年齢 != 0)
			PRINTFORMW , 같은 또래의 소년이다.
		ELSE
PRINTFORMW , 아직%TEXTR("어린/어려")% 남자아이다.
		ENDIF
		PRINTL
		IF TCVAR:ARG:ゆきずりセックス_体位 >= 1
PRINTFORML 아직 몽정을 했는지도 모르는 나이의 소년을 상대로, 이끄는 듯이 허리를 흔드는%CALLNAME:ARG%。
PRINTFORMW %TEXTR("너무 이른 실천 성교육/어린 몸으로 느끼는 「어른의 놀이」/처음 하는 「섹스」")%의 쾌락에, 소년은%TEXTR("빠져/농락당해")% 버린 채%TEXTR("필사적으로/무작정")% 허리를 부딪쳤다.
		ELSE
PRINTFORML 아직 「거기」%TEXTR("가 기분 좋아질 수 있는 기관이라는/가 기분 좋아지기 위한 기관이라는/를 만지면 기분 좋다는")% 것조차 몰랐을 것이다.
PRINTFORMW %CALLNAME:ARG%의 정성스러운 봉사에%TEXTR("아직 작은/어린")% 자지를 터질 듯이 크게 만들고, 소년은 하늘을 우러러보며 첫 쾌락에 빠져 있다.
		ENDIF
		PRINTL
PRINTFORML 어린 소년의 순수한 성을,%CALLNAME:ARG%은(는) 그저 쾌락을 위해 탐한다.
PRINTFORML 첫 성경험을 이토록 강렬하게, 그리고 이토록 아름다운 미녀를 상대로 맞이해버린 소년은,
PRINTFORMW 불쌍하게도, 분명 이제%TEXTR("지역의 또래 여자아이/평범한 여자아이")% 정도로는 만족할 수 없을 정도로 성벽이 왜곡되어 버렸을 것이다.
	CASE 3
	;ショタおね風味
		IF TALENT:ARG:年齢層 == 10 || (BASE:ARG:年齢 <= 13 && BASE:ARG:年齢 != 0)
PRINTFORMW , 같은 또래의 소년이다.
		ELSE
PRINTFORMW , 아직%TEXTR("어린/어려")% 남자아이다.
		ENDIF
		PRINTL
		IF TCVAR:ARG:ゆきずりセックス_体位 >= 1
PRINTFORML 아무래도 겉모습과는 달리, 이 소년은 「공부벌레」인 것 같다.
PRINTFORML 지역의 또래%TEXTR("상대로/의 어린 몸으로")% 많이 「%TEXTR("공부/연습")%」했을까? 이미 익숙한 성을 천진난만하게 휘두르며, 조숙한 아이는 허리를 부딪친다.
			PRINTL
PRINTFORML 분명 여자를 「사용하면 기분 좋은 장난감」 정도로밖에 생각하지 않을 것이다. %CALLNAME:ARG%이 최고의 미녀라고 해도, 예외는 아니다.
PRINTFORML 천진난만한 채로. 본능적인 채로. 어리면서도 익혀가고 있는 「여자를 지배하는 방법」을 익혀가고 있는 소년은,
PRINTFORMW 난폭하게%CALLNAME:ARG%의 허리를 잡고 「기분 좋은 구멍」으로 놀면서, 제멋대로 가슴을 주무르고 입술에 게걸스럽게 달라붙는다.
			PRINTL
			PRINTFORML 어림으로 인한 순진한 잔혹함과, 나이에 걸맞지 않는 기교.
			PRINTFORMW 상상 이상의 자극적인 상대에게 환희한 %CALLNAME:ARG%은(는) 당하는 대로를 허락하고, 이 순간만의 작은 「주인님」을 달콤한 조임과 교성으로 대접했다.
		ELSE
			PRINTFORML 아무래도 겉모습과는 달리, 이 소년은 「공부벌레」인 것 같다. 분명 지역에서는 또래 아이들을 실컷 「이용해」왔을 것이다.
			IF CSTR:ARG:ゆきずりセックス_プレイ内容 == "フェラチオ"
				PRINTFORM 무릎 꿇고 구강성교 봉사하는 %CALLNAME:ARG%의
				IF TALENT:ARG:角あり
					PRINTFORM 소중한 뿔
				ELSE
					PRINTFORM 아름다운 머리카락
				ENDIF
				PRINTFORML 을(를) 장난감을 손에 쥐듯 잡고,
				PRINTFORMW 고삐처럼 잡아당겨 더한 봉사를 요구하는 모습은, 분명 「봉사시키는 데 익숙한」 자의 그것이다.
			ELSE
				PRINTFORMW %TEXTR("능글거리며/제 것인 양 가슴을 주무르며")%수음 봉사를 받는 모습은, 분명 「봉사시키는 데 익숙한」 자의 그것이다.
			ENDIF
			PRINTL
			PRINTFORML 순진한 채로 여자를 깔보고, %CALLNAME:ARG%와 같은 극상의 미녀일지라도 「기분 좋은 장난감」 정도로밖에 생각하지 않을 어린 폭군.
			PRINTFORMW 상상 이상의 자극적인 상대에게 환희한 %CALLNAME:ARG%은(는) 당하는 대로를 허락하고, 이 순간만의 작은 「주인님」에게 더한 봉사를 바쳤다.
		ENDIF
	CASE 4
	;ガタイのいい男
		PRINTFORMW , 체격이 좋은 「딱 봐도」라는 느낌의 남자다.
		PRINTL
		PRINTFORML 탄탄한 몸. 얼굴도 나쁘지 않다. 분명 여자를 실컷 먹어봤을 것 같은 풍모의 그는, 실제로 그 말대로인 듯했다.
		IF TCVAR:ARG:ゆきずりセックス_体位 >= 1
			PRINTFORML 수많은 전투를 연상시키는 능숙한 애무는 그야말로, %CALLNAME:ARG%이(가) 원했던 「즉석 쾌락」 그 자체였고,
			PRINTFORMW %CALLNAME:ARG%은(는) 안쪽을 찔리면서, 몇 번이고 밀려오는 절정에 등을 떨며 교성을 지른다.
		ELSE
			PRINTFORML 「봉사받는 것이 당연하다」는 태도로%CALLNAME:ARG%의 봉사를 받는 모습은 오히려 위풍당당함마저 넘쳐흐르고,
			PRINTFORMW %CALLNAME:ARG%은 말을 건 남자가 예상 이상이었음을 기뻐하듯이, 마음을 담아 그에게 봉사하고 있다.
		ENDIF
	CASE 5
	;おじいちゃん  老練な手管
		PRINTFORMW , 얼굴에 주름이 깊게 패인 노년이라고 해도 무방한 남성이다.
		PRINTL
		PRINTFORML 허리가 굽고 머리도 숱이 적어진 노인이라 할지라도, %CALLNAME:ARG% 정도의 여자를 상대할 수 있다면, 늙은 몸이라도 발기하는 모양이다.
		PRINTFORMW 쇠퇴했던 성 기능은 이곳에 와서 급속히 활성화되어, 남자는 눈을 번뜩이며 생기 있게, 오랜만에 인생 최고일 극상의 암컷을 만끽하고 있다.
		IF TCVAR:ARG:ゆきずりセックス_体位 >= 1
			PRINTL
			PRINTFORM 페니스로 안쪽을 쿡쿡 찌르면서 마디 굵은 손이 가슴을 주무르고, 마른 나뭇가지 같은 손가락이 유두를 간지럽힌다.
			PRINTFORM 전성기를 되찾은 듯한 남자의 노련하고 끈적한 애무에, %CALLNAME:ARG%은 등골을 떨며 달콤하게 녹아내리는 목소리로 앙칼지게 울었다.
		ENDIF
	
;	CASE 6
	;ならずものっぽいやつ レイプごっこ
;		IF TCVAR:ARG:ゆきずりセックス_体位 >= 1
;			PRINTFORM 
;		ELSE
;			PRINTFORM 
;		ENDIF


	CASEELSE
		IF TCVAR:ARG:ゆきずりセックス_誘い && RAND:2 == 0
		;彼女持ちのやつ。自分から誘った場合限定
			PRINTFORMW , 특별히 눈에 띄는 곳 없는, 그야말로 평범한 남자다.
			PRINTL
			PRINTFORML ……아니, 아는 사이는 아니지만, 곰곰이 생각해보니 희미하게 본 기억은 있었다.
			IF TCVAR:ARG:ゆきずりセックス_体位 >= 1
				IF RAND:2 == 0
					PRINTFORML 오너로서의 기억이 확실하다면, 그는 분명 아내와 함께 숙박하고 있는 손님이었을 것이다.
					PRINTFORMW ……아아, 이게 무슨 일인가. %CALLNAME:ARG%는%TEXTR("하필이면/천박하게도")% 상대가 있는 남자를 그 몸으로 유혹하여, 그의 사랑을 시험하고 있는 것이다!
					PRINTL
					PRINTFORML 물론, 그에게는 가혹한 이야기이다.
					PRINTFORML 얼굴도 몸도, 사랑하는 아내와는 비교할 수 없는 극상의 암컷이, 마침 좋게 몸을 내밀고 다리를 벌린다.
					PRINTFORMW 이 상황에서 미치지 않을 남자 따위는 없을 것이다.
					PRINTL
					PRINTFORML 배덕 속에서 맛보는 %CALLNAME:ARG%의 몸. 그 뇌가 타버릴 듯한 기분 좋음을 알아버린 것이다.
					PRINTFORML 불쌍한 그는 분명 이제, 아내와의 섹스로는 만족할 수 없을 것이다…….
					PRINTL
					PRINTFORML 육욕에 져, 자신의 사랑을 「%CALLNAME:ARG%와의 단 한 번의 %TEXTR("바람난 교미/섹스")% 이하의 가치」로 스스로 떨어뜨려 버린 남자의 신음에,
					PRINTFORMW %CALLNAME:ARG%은 만족스러운 미소를 띠며 악덕과 쾌락으로 가득 찬 교성을 지르고 있다.
				ELSE
					PRINTFORML 오너로서의 기억이 확실하다면, 그는 분명 그녀와 함께 숙박하고 있는 손님이었을 것이다.
					PRINTFORMW ……아아, 이게 무슨 일인가. %CALLNAME:ARG%는 %TEXTR("하필이면/비열하게도")% 상대가 있는 남자를 그 몸으로 유혹하여, 그의 사랑을 시험하고 있는 것이다!
					PRINTL
					PRINTFORML 물론, 그에게는 가혹한 이야기이다.
					PRINTFORML 얼굴도 몸도, 연인과는 비교할 수 없는 최상의 암컷이, 편리하게 몸을 내어주고 다리를 벌린다.
					PRINTFORMW 이 상황에서 미치지 않을 남자는 없을 것이다.
					PRINTL
					PRINTFORML 육욕에 져, 자신의 사랑을 「%CALLNAME:ARG%와의 단 한 번의 %TEXTR("바람난 교미/섹스")% 이하의 가치」로 스스로 떨어뜨려 버린 남자의 신음에,
					PRINTFORMW %CALLNAME:ARG%는 만족스러운 미소를 띠며 악덕과 쾌락으로 가득 찬 교성을 지르고 있다.
				ENDIF
			ELSE
				IF RAND:2 == 0
					PRINTFORML 오너로서의 기억이 확실하다면, 그는 분명 아내와 함께 숙박하고 있는 손님이었을 것이다.
					PRINTFORMW ……아아, 이게 무슨 일인가. %CALLNAME:ARG%는 %TEXTR("하필이면/비열하게도")% 상대가 있는 남자를 그 몸으로 유혹하여, 그의 사랑을 시험하고 있는 것이다!
					PRINTL
					PRINTFORML 물론, 그에게는 가혹한 이야기이다.
					PRINTFORML 얼굴도 몸도, 사랑하는 아내와는 비교할 수 없는 최상의 암컷이, 편리하게 자신에게 성봉사를 제안한다.
					PRINTFORMW 이 상황에서 미치지 않을 남자는 없을 것이다.
					PRINTL
					PRINTFORML 배덕 속에서 맛보는%CALLNAME:ARG%의 애무. 그 뇌가 타버릴 듯한 기분 좋음을 알아버린 것이다.
					PRINTFORML 불쌍한 그는 분명 이제, 아내의 봉사에 사랑은 느껴도, 만족하는 것 따위는 할 수 없을 것이다……。
					PRINTL
					PRINTFORML 육욕에 져, 자신의 사랑을 「%CALLNAME:ARG%의 야한 봉사 이하의 가치」로 스스로 격하시켜버린 남자의 신음에,
					PRINTFORMW %CALLNAME:ARG%은(는) 만족스러운 미소를 띠며 페니스에 대한 봉사를 계속하고 있다……。
				ELSE
					PRINTFORML 오너로서의 기억이 확실하다면, 그는 분명 여자친구와 함께 숙박하고 있는 손님이었을 것이다.
					PRINTFORMW ……아아, 이게 무슨 일인가. %CALLNAME:ARG%은(는)%TEXTR("하필이면/천박하게도")%상대방이 있는 남자를 그 몸으로 유혹하여, 그의 사랑을 시험하고 있는 것이다!
					PRINTL
					PRINTFORML 무엇보다, 그에게는 가혹한 이야기이다.
					PRINTFORML 얼굴도 몸도, 연인 따위와는 비교할 수 없는 극상의 암컷이, 편리하게도 자신에게 성봉사를 제안한다.
					PRINTFORMW 이 상황에서 미치지 않을 남자 따위는 없을 것이다.
					PRINTL
					PRINTFORML 배덕 속에서 맛보는%CALLNAME:ARG%의 애무. 그 뇌가 타버릴 듯한 기분 좋음을 알아버린 것이다.
					PRINTFORML 불쌍한 그는 분명 이제, 연인의 봉사에 사랑은 느껴도, 만족하는 것 따위는 할 수 없을 것이다……。
					PRINTL
					PRINTFORML 육욕에 져, 자신의 사랑을 「%CALLNAME:ARG%의 야한 봉사 이하의 가치」로 스스로 격하시켜버린 남자의 신음에,
					PRINTFORMW %CALLNAME:ARG%은(는) 만족스러운 미소를 띠며 페니스에 대한 봉사를 계속하고 있다……。
				ENDIF
			ENDIF
		ELSE
		;それ以外。ごく普通の男性
			PRINTFORMW , 멀리서 봐도 별 볼 일 없는, 그야말로 평범한 남자다.
			PRINTL
			IF TCVAR:ARG:ゆきずりセックス_体位 >= 1
				PRINTFORML 갑자기 내려온, 극상의 여자를 안을 수 있는 기회. 뜻밖의 기쁨에, 남자의 긴장이 이쪽에서도 엿보인다.
				PRINTL
				PRINTFORML 처음에는 조심스러워하는 듯했던 그가, 점차 제멋대로, 욕망에 솔직해져 가는 모습에,
				PRINTFORMW %CALLNAME:ARG%은(는) 황홀한 표정을 지으며 남자의 페니스를 받아들이고 있다.
			ELSE
				PRINTFORML 갑자기 찾아온, 최고의 여자의 봉사를 받을 수 있는 행운. 예상 밖의 기쁨에, 남자의 긴장이 이쪽에서도 엿보인다.
				PRINTL
				PRINTFORML 처음에는 조심스러워하는 듯했던 그가, 점차 제멋대로, 욕망에 솔직해져 가는 모습에,
				PRINTFORMW %CALLNAME:ARG%은(는) 황홀한 표정을 지으며 남자의 페니스에 봉사하고 있다.
			ENDIF
		ENDIF
	ENDSELECT
	TCVAR:ARG:ゆきずりセックス_相手描写 = 1
;2回目以降
ELSE 
	PRINTFORM %CALLNAME:ARG%은(는)
;相手モブ描写	
	SELECTCASE TCVAR:ARG:ゆきずりセックス_相手モブ
		CASE 0
			PRINTFORM	%TEXTR("시원찮은/음침해 보이는")% 청년
		CASE 1
			PRINTFORM	%TEXTR("불룩하게 배가 나온/체격이 좋은")% 중년
		CASE 2 TO 3
			IF TALENT:ARG:年齢層 == 10 || (BASE:ARG:年齢 <= 13 && BASE:ARG:年齢 != 0)
				PRINTFORM 같은 또래의 소년
			ELSE
				PRINTFORM %TEXTR("작은/어린")% 남자아이
			ENDIF
		CASE 4
			PRINTFORM 체격 좋은 남자
		CASE 5
			PRINTFORM 테크니션 노인
;		CASE 6
			
		CASEELSE
			PRINTFORM %TEXTR("별 볼 일 없는/평범한")% 남자
		ENDSELECT
;体位描写
	SELECTCASE TCVAR:ARG:ゆきずりセックス_体位
		CASE 0 ;奉仕
			PRINTFORMW 에게 %CSTR:ARG:ゆきずりセックス_プレイ内容%으로 봉사하고 있다.
		CASE 1 ;V性交
			PRINTFORMW 와 %CSTR:ARG:ゆきずりセックス_プレイ内容%로 교감하고 있다.
		CASE 2 ;A性交
			PRINTFORMW %CSTR:ARG:ゆきずりセックス_プレイ内容%와 교접하고 있다.
	ENDSELECT
ENDIF

;お相手の絶頂とかち合ったかで分岐
IF TCVAR:ARG:ゆきずりセックス_絶頂値 > 0
	;通常時
	IF !TCVAR:ARG:覗きバレ
		;まだバレてない
		
		;覗きバレ判定を行う
		IF TCVAR:ARG:使い魔覗き中
			;使い魔覗き中は相手の魔法知識Lvによってバレる可能性がある
			IF RAND:10 < 知識素質:ARG:魔法知識*2
				;覗きバレフラグを立てる
				TCVAR:ARG:覗きバレ = 1
				
			ENDIF
		ENDIF
		;どちらにせよ一定の確率でバレちゃう(大体10%ぐらい)
		SIF RAND:10 < 1
			TCVAR:ARG:覗きバレ = 1
		
		IF TCVAR:ARG:覗きバレ
			PRINTFORML 음란한 광경을 만끽하고 있자, %CALLNAME:ARG%이(가) 힐끗 이쪽을 바라보았다.
			PRINTFORML 시선은 틀림없이 이쪽을 붙잡고 있다. 이것은 우연이 아니다, 들켰다……!!
			SIF TCVAR:ARG:使い魔覗き中 && 知識素質:ARG:魔法知識 >= 1
				PRINTFORML 마법 지식에 능통한 %CALLNAME:ARG%에게 사역마를 보낸 것은 악수였을지도 모른다……
			PRINTFORMW 
			PRINTL
			SELECTCASE RAND:3
				CASE 0
					PRINTFORM 시선을 눈치챈 %CALLNAME:ARG%은(는) 그러나, 이쪽을 향해 불적한 미소를 지으며
				CASE 1
					PRINTFORM 시선을 눈치챈 %CALLNAME:ARG%은(는) 이쪽을 향해 윙크를 하자,
				CASE 2
					PRINTFORM 시선을 눈치챈 %CALLNAME:ARG%은(는) 장난스럽게 쉬잇 하고 입에 손가락을 대자,
			ENDSELECT
			PRINTFORML 아까보다 격렬하게 행위에 몰두하기 시작했다.
			PRINTL
			PRINTFORML 그것이 이쪽을 향한 비난인지, 아니면 「보여지고 있다」는 것에 흥분하고 있는지는 알 수 없지만……
			PRINTFORMW 어느 쪽이든, 더욱 음란한 모습을 보이는 %CALLNAME:ARG%의 모습에 이쪽도 눈을 떼지 못하고 있었다……
		ELSE
			;ばれてない
			PRINTFORMW 눈앞의 수컷과 암컷은 엿보이고 있다는 것을 눈치채지 못하고, 서로 성적인 쾌락을 탐하고 있다……
		ENDIF
	ELSE
		;すでにバレている
		PRINTFORML %CALLNAME:ARG%은(는) 힐끗 이쪽으로 시선을 돌려, %CALLNAME:PLAYER%이(가) 아직 엿보고 있는 것을 확인하자
		PRINTFORML 일부러 들리도록 신음 소리를 내거나, 격렬함을 더하거나 하며, 이쪽의 정욕을 부추긴다.
		PRINTFORMW 적나라한 모습을 드러내 이쪽을 즐겁게 해주는%TEXTR("기특한 모습에/서비스 정신에")% 감사하며, %CALLNAME:PLAYER%은(는) %CALLNAME:ARG%의%TEXTR("정사/비밀스러운 일")%을(를) 천천히 만끽했다……
	ENDIF
	
ELSE
	;お相手側の絶頂とかち合っちゃった
	
	PRINTFORM 마침 남자가 절정을 맞이한 타이밍이었던 것 같고,
	SELECTCASE TCVAR:ARG:ゆきずりセックス_体位
		CASE 1 ;Ｖ性交
PRINTFORML %CALLNAME:ARG%은(는) 쾌락에 몸을 떨면서 발사된 백탁을 질 내에서 받아들이고 있었다.
			PRINTL
PRINTFORML 리조트에서의 바캉스 도중, %CALLNAME:ARG%와 같은 최상의 암컷
			IF TCVAR:ARG:ゆきずりセックス_誘い
				PRINTFORML 을 낚아채서,
			ELSE
				PRINTFORML 에게 유혹되어,
			ENDIF
PRINTFORMW 그 몸을 마음껏 즐긴 끝에, 가장 깊숙한 곳에 찔러 넣어 허리를 밀어붙이면서의 무책임한 질 내 사정.
			PRINTL
PRINTFORML %TEXTR("일부러 「안은 안 돼」「오늘은 위험하니까」 등이라며 부추기면서의 나약한 저항을, 힘으로 억누르면서/욕망의 모든 것을 긍정받는 대로")%욕망을 토해내는, 그 쾌락은 실로 지상일 것이다.
PRINTFORML 하늘을 우러러 %TEXTR("등/허리")%를 떨면서의 길고 긴 사정을 마친 남자가 페니스를 빼자, 다 담지 못했던 정액이 넘쳐흘러, 뚝뚝 바닥을 더럽혔다.
			IF TCVAR:ARG:覗きバレ
				PRINTL
				PRINTFORML %CALLNAME:ARG%은(는) 여음을 손가락으로 벌려, 확실히 씨앗이 뿌려진 것을 남자에게… 혹은 그 안에서 엿보고 있는 %CALLNAME:PLAYER%에게 보여주었다.
			ENDIF
			PRINTW
		CASE 2 ;Ａ性交
PRINTFORML %CALLNAME:ARG%은(는) 쾌락에 몸을 떨면서 발사된 백탁을 항문으로 받아들이고 있었다.
PRINTFORML 긴 사정을 마친 남자가 페니스를 빼자, 다 담지 못했던 정액이 넘쳐흘러, 뚝뚝 바닥을 더럽힌다.
			IF TCVAR:ARG:覗きバレ
				PRINTFORML %CALLNAME:ARG%은(는) 엉덩이를 양손으로 벌려, 정액이 넘쳐흐르는 항문을 남자에게… 혹은 그 안에서 엿보고 있는 %CALLNAME:PLAYER%에게 보여주었다.
			ENDIF
		CASEELSE ;奉仕
PRINTFORML 남자의 정액이 봉사하고 있는 %CALLNAME:ARG%에게 쏟아졌다.
			IF TCVAR:ARG:覗きバレ
				PRINTFORML %CALLNAME:ARG%은(는) 자신을 향해 대량으로 나온 정액을 남자에게… 혹은 그 안에서 엿보고 있는 %CALLNAME:PLAYER%에게 보여주었다.
			ENDIF
	ENDSELECT
	PRINTFORML 
	PRINTFORML ………………………
	PRINTFORMW
	 
	IF TCVAR:ARG:ゆきずりセックス_残時間
		;延長戦
		PRINTFORML 행위 후의 음란한 %CALLNAME:ARG%의 모습에 자극받은 남자의 페니스는 다시 불끈불끈 단단해지며, 말없이 %CALLNAME:ARG%에게 처리를 재촉한다.
		PRINTFORMW 만족에 이르지 못한 %CALLNAME:ARG%도 내밀어진 페니스를 황홀한 표정으로 바라보며, 우발적인 성행위를 다시 시작했다……
		
	ELSE
		;終わり
		PRINTFORML 서로 만족한 두 사람은 잠시 여운에 잠긴 뒤, 서둘러 흐트러진 옷을 고치기 시작했다.
		PRINTFORMW 이대로는 마주치고 말 거야……%CALLNAME:PLAYER%은(는) 서둘러 그 자리를 떠났다.
	ENDIF
ENDIF

;パラメータ更新
CALL ゆきずりセックス_パラメータ変動処理(ARG, 15)


;==================================================================================================
@ゆきずりセックス途中終了(ARG)
;-------------------------------------------------
;ARG番のキャラがゆきずりセックスを何らかの理由で途中終了した際に動かす関数
;フラグ周りを初期化する
;--------------------------------------------------------------------------------------------------
TCVAR:ARG:ゆきずりセックス_残時間 = 0
TCVAR:ARG:ゆきずりセックス_絶頂値 = 100
RETURN 0


;==================================================================================================
@IS_ゆきずりセックス中(ARG)
#FUNCTION
;-------------------------------------------------
;ARG番のキャラがゆきずりセックス中であるかを判定する関数
;残時間が0以下で、相手が絶頂したタイミングで終了(0)を返す。
;--------------------------------------------------------------------------------------------------
#DIM 行為中判定 = 1
;--------------------------------------------------------------------------------------------------
IF !TCVAR:ARG:ゆきずりセックス_残時間  && !TCVAR:ARG:ゆきずりセックス_絶頂値
	RETURNF 0
ELSE
	RETURNF 1
ENDIF


;==================================================================================================
@ゆきずりセックス内容決定(ARG)
;-------------------------------------------------
;各感覚と技巧を基に行為の内容を決定する。(Ｖ性交、Ａ性交、性奉仕)
;基本的にどれも最低でも1の重みを持ち、オプションの設定次第では初体験を捧げる可能性を持つ
;--------------------------------------------------------------------------------------------------
#DIMS プレイ内容
#DIM Ｖ性交重み
#DIM Ａ性交重み
#DIM 奉仕重み
#DIM 重み合計
;--------------------------------------------------------------------------------------------------

;プレイ内容の重み決定
;Ｖ性交 … 「Ｖなし」ではなく、「純潔設定あり」で「処女」以外の場合のみ実行
SIF TALENT:ARG:Ｖ感度 > -2 && !(OPTION変数:夜這い処女・童貞 && TALENT:ARG:処女)
	;Ｖ感覚に影響する
	Ｖ性交重み += MAX(1, ABL:ARG:Ｖ感覚)

;Ａ性交 … 「Ａなし」ではなく、「純潔設定あり」で「Ａ処女」以外の場合のみ実行
SIF TALENT:ARG:Ａ感度 > -2 && !(OPTION変数:夜這い処女・童貞 && TALENT:ARG:Ａ処女)
	;Ａ感覚に影響する
	Ａ性交重み += MAX(1, ABL:ARG:Ａ感覚)

;奉仕 … NPCから誘われた時に重みを得る。
SIF TCVAR:ARG:ゆきずりセックス_誘い
	;奉仕精神と素質[献身的]に影響する。
	奉仕重み += MAX(1, ABL:ARG:奉仕精神) + (TALENT:ARG:献身的*2)

;重み合計を算出
重み合計 = Ｖ性交重み+Ａ性交重み+奉仕重み

;プレイ内容の決定
IF 重み合計
	;重み合計を基に乱数でプレイ内容を決定
	SELECTCASE RAND:重み合計
		;=========================================================
		; ●奉仕性交
		;=========================================================
		;基本的にはキャラの性欲は満たされず絶頂しない(NPCは満足する)
		CASE IS < 奉仕重み
			;挿入以外の性交…フェラチオ、手コキ
			
			;どのプレイでも奉仕快楽経験を積む
			EXP:ARG:奉仕快楽経験 ++
			
			SELECTCASE RAND:2
				CASE 0
					プレイ内容 = フェラチオ
					EXP:ARG:口淫経験 ++
					
				CASE 1
					プレイ内容 = 手コキ
					EXP:ARG:手淫経験 ++
			ENDSELECT
			
			
		;=========================================================
		; ●Ｖ性交
		;=========================================================
		CASE 奉仕重み TO 奉仕重み+Ｖ性交重み-1
			;Ｖ性交
			SELECTCASE RAND:12
				CASE 0
					プレイ内容 = 正常位
				CASE 1
					プレイ内容 = 後背位
				CASE 2
					プレイ内容 = 寝バック
				CASE 3
					プレイ内容 = 対面座位
				CASE 4
					プレイ内容 = 背面座位
				CASE 5
					プレイ内容 = 騎乗位
				CASE 6
					プレイ内容 = 側位
				CASE 7
					プレイ内容 = 屈曲位
				CASE 8
					プレイ内容 = 駅弁
				CASE 9
					プレイ内容 = 背面駅弁
				CASE 10
					プレイ内容 = 対面立位
				CASE 11 
					プレイ内容 = 立ちバック
			ENDSELECT
			
			;部位を設定
			TCVAR:ARG:ゆきずりセックス_体位 = 1
			
			;初めて判定
			IF EXP:ARG:Ｖ性交経験 == 0
				CALL 履歴データベース登録(CFLAG:ARG:人物番号, @"<font color='#%カラーパレット_HTML("薄ピンク")%'>出会ったばかりの相手に自ら処女を捧げてしまった</font><img src='えっちハート'>","うふふ")
			ENDIF
			TALENT:ARG:処女 = 0
			
			;経験回数
			EXP:ARG:Ｖ経験 ++
			EXP:ARG:Ｖ性交経験 ++
			
			
		;=========================================================
		; ●Ａ性交
		;=========================================================
		CASE 奉仕重み+Ｖ性交重み TO 奉仕重み+Ｖ性交重み+Ａ性交重み-1
			;Ａ性交
			SELECTCASE RAND:12
				CASE 0
					プレイ内容 = Ａ正常位
				CASE 1
					プレイ内容 = Ａ後背位
				CASE 2
					プレイ内容 = Ａ寝バック
				CASE 3
					プレイ内容 = Ａ対面座位
				CASE 4
					プレイ内容 = Ａ背面座位
				CASE 5
					プレイ内容 = Ａ騎乗位
				CASE 6
					プレイ内容 = Ａ側位
				CASE 7
					プレイ内容 = Ａ屈曲位
				CASE 8
					プレイ内容 = Ａ駅弁
				CASE 9
					プレイ内容 = Ａ背面駅弁
				CASE 10
					プレイ内容 = Ａ対面立位
				CASE 11 
					プレイ内容 = Ａ立ちバック
			ENDSELECT
			
			;体位を設定
			TCVAR:ARG:ゆきずりセックス_体位 = 2
			
			;初めて判定
			IF EXP:ARG:Ａ性交経験 == 0
				CALL 履歴データベース登録(CFLAG:ARG:人物番号, @"<font color='#%カラーパレット_HTML("薄ピンク")%'>出会ったばかりの相手に自ら後ろの初めてを捧げてしまった</font><img src='えっちハート'>","うふふ")
			ENDIF
			TALENT:ARG:Ａ処女 = 0
			
			;経験回数
			EXP:ARG:Ａ経験 ++
			EXP:ARG:Ａ性交経験 ++
			
	ENDSELECT
ELSE
	;全ての重みが0の時は「手コキ」にする。
	プレイ内容 = 手コキ
	EXP:ARG:手淫経験 ++
	
ENDIF

;プレイ内容を保管
CSTR:ARG:ゆきずりセックス_プレイ内容 = %プレイ内容%


