@一言コメント解説エディタ(CSV番号=-1, キャラ名="", 人称:0="", 人称:1="")
#DIM CSV番号
#DIM 好感度コメント
#DIM 表示モード, 2
#DIMS キャラ名, 4
#DIMS Column_M
#DIMS Column_S
#DIM L_CNT
#DIM L_CNT2
#DIMS コメント_業務中, 20, 9
#DIMS コメント_状況別, 20, 9
#DIMS コメント_好感度, 6, 6
#DIMS コメント_解説, 1, 9
#DIM L_SPR, 4
#DIMS コメント種類 = "コメント_業務中", "コメント_状況別", "コメント_好感度", "コメント_解説"
#DIMS 業務中リスト = "ロビー受付", "バーテンダー", "司書", "プール監視員", "道具屋", "土産物屋", "食事処", "装飾品店"
#DIMS 状況別リスト = "飲み会", "睡眠中", "一緒に隠れている最中", "デート中", "一緒に遊んでいる最中", "同行中", "隠れているあなたに気づいていない時", "野外オナニー中"
#DIMS 好感度リスト = "友情度", "信頼度", "恋心度", "性愛度", "固有好感度", "恋慕度"
#DIMS 関係名, 6, 6
#DIMS コメント_値, 10
#DIMS 人称, 2

表示モード = 100
表示モード:1 = 1000
VARSET コメント_業務中
VARSET コメント_状況別
VARSET コメント_好感度
VARSET コメント_解説
VARSET 関係名

L_SPR:0 = 100 + ROUNDUP(VARSIZE("コメント_業務中"), 1)
FOR LOCAL, 1, VARSIZE("コメント種類")
	L_SPR:LOCAL = ROUNDUP(VARSIZE(コメント種類:LOCAL) + L_SPR:(LOCAL-1), 1)
NEXT

FOR LOCAL, 0, 6
	SPLIT 関係呼称:LOCAL, "/", LOCALS
	FOR L_CNT, 0, 4
		関係名:L_CNT:LOCAL '= LOCALS:L_CNT
	NEXT
NEXT
SPLIT 関係呼称:6, "/", LOCALS
FOR L_CNT, 0, 6
	関係名:5:L_CNT '= LOCALS:L_CNT
NEXT

;今のところタイトル画面orCSVエディタからのみ呼出の想定で、キャラクタ変数を利用するためにキャラ追加。
;他から呼び出したい要望があれば後で考える。そもそも誰も使ってな……考えるのはやめよう
MASTER = CHARANUM
ADDCHARA 0

$コメント_INIT
IF キャラ名 == ""
	IF !EXISTCSV(CSV番号) && CSV番号 != -1
		キャラ名 = 未定
	ELSE
		IF CSV番号 == -1
			CALL CSVコピー処理(1)
			CSV番号 = RESULT
			IF !EXISTCSV(CSV番号)
				DELCHARA CHARANUM-1
				RETURN 0
			ENDIF
		ENDIF
		VARSET RESULTS
		SPLIT CSVNAME(CSV番号), "]", RESULTS
		キャラ名:0 = %REPLACE(CSVNAME(CSV番号), ".*\]", "")%
		キャラ名:1 = %SUBSTRING(RESULTS:0, 1, -1)%
		キャラ名:2 = %CSVCALLNAME(CSV番号)%
		キャラ名:3 = %CSVCALLNAME(CSV番号)%
	ENDIF
ENDIF

TARGET = CHARANUM
IF EXISTCSV(CSV番号)
	ADDCHARA CSV番号
	IF !EXISTFUNCTION(@"口上側初期パラメータ変更_{CSV番号}") && EXISTCSV(CSV番号)
		SIF CSVCSTR(CSV番号, GETNUM(CSTR, "一人称")) == ""
			CSTR:一人称 = %人称:0%
		SIF CSVCSTR(CSV番号, GETNUM(CSTR, "二人称")) == ""
			CSTR:二人称 = %人称:1%
	ENDIF
ELSE
	ADDCHARA 999
	NO:TARGET = CSV番号
	CALLNAME:TARGET = %キャラ名%
	CSTR:一人称 = %人称:0%
	CSTR:二人称 = %人称:1%
ENDIF

IF EXISTFUNCTION(@"キャラ固有好感度関係名_{CSV番号}")
	FOR L_CNT, 0, 6
		CALLFORM キャラ固有好感度関係名_{CSV番号}(関係閾値:L_CNT)
		関係名:4:L_CNT '= RESULTS
	NEXT
ENDIF

IF EXISTFUNCTION(@"口上側初期パラメータ変更_{CSV番号}")
	CALLFORM 口上側初期パラメータ変更_{CSV番号}()
ENDIF

$コメント_LOOP
ログ保存用文字列 =
Column_M = <div rect='81,0,5850,594' border='31' bcolor='#C0C0C0'></div>
Column_M += @"<div rect='156,62,5775,531'>"
Column_M += @"캐릭터 이미지 아래에 한 줄만 표시되는 코멘트나, 호감도에 따라 변화하는 코멘트 및 캐릭터 해설을 간략하게 설정합니다<br>"
Column_M += @"■------------------------------------------------------------------------------------------------------------■<br>"
Column_M += @"등록 번호：{CSV番号}　이름：%キャラ名%<br>"
Column_M += @"1인칭　：\@ CSTR:一人称 != "" ? %CSTR:一人称%# (미설정)\@　　2인칭　：\@ CSTR:二人称 != "" ? %CSTR:二人称%# (미설정)\@<br>"
Column_M += @"</div>"

Column_M += @"<div rect='81,625,1937,2812' border='31' bcolor='#C0C0C0'></div><div rect='2050,625,3875,2812' border='31' bcolor='#C0C0C0'></div>"
Column_M += @"<div rect='156,687,1937,2812'>"
Column_M += @"<button value='100'>[100] 한마디 코멘트를 설정한다</button>"
Column_M += @"<br>"
IF 表示モード < L_SPR:1
	Column_M += @"<button value='100'>├[100] 업무 중 코멘트를 설정한다</button>"
	Column_M += @"<br>"
	Column_M += @"<button value='{L_SPR:0}'>└[{L_SPR:0}] 상황별 코멘트를 설정한다</button>"
	Column_M += @"<br>"
ELSE
	LOCALS += "<button value='100'><font color='#808080'>└ 전개한다</font></button>"
	LOCALS += "<br>"
ENDIF
Column_M += @"<button value='{L_SPR:1}'>[{L_SPR:1}] 호감도 코멘트를 설정한다</button>"
Column_M += @"<br>"
IF INRANGE(表示モード, L_SPR:1, L_SPR:1+5)
	Column_M += @"<button value='{L_SPR:1 + 1}'>├[{L_SPR:1 + 1}] 우정 코멘트를 설정한다</button>"
	Column_M += @"<br>"
	Column_M += @"<button value='{L_SPR:1 + 2}'>├[{L_SPR:1 + 2}] 신뢰도 코멘트를 설정한다</button>"
	Column_M += @"<br>"
	Column_M += @"<button value='{L_SPR:1 + 3}'>├[{L_SPR:1 + 3}] 연심도 코멘트를 설정한다</button>"
	Column_M += @"<br>"
	Column_M += @"<button value='{L_SPR:1 + 4}'>├[{L_SPR:1 + 4}] 성애도 코멘트를 설정한다</button>"
	Column_M += @"<br>"
	Column_M += @"<button value='{L_SPR:1 + 5}'>└[{L_SPR:1 + 5}] 고유 호감도 코멘트를 설정한다</button>"
	Column_M += @"<br>"
ELSE
	LOCALS += @"<button value='{L_SPR:1}'><font color='#808080'>└ 전개한다</font></button>"
	LOCALS += "<br>"
ENDIF
Column_M += @"<button value='{L_SPR:1 + 6}'>[{L_SPR:1 + 6}] 연모도 코멘트를 설정한다</button>"
Column_M += @"<br>"
Column_M += @"<button value='{L_SPR:2}'>[{L_SPR:2}] 캐릭터 해설을 설정한다</button>"
Column_M += @"<br>"
Column_M += @"<br>"
Column_M += @"<br>"
IF !EXISTFUNCTION(@"口上側初期パラメータ変更_{CSV番号}") && EXISTCSV(CSV番号)
	IF CSVCSTR(CSV番号, GETNUM(CSTR, "一人称")) == ""
		Column_M += @"<button value='600'>[600] 1인칭을 설정한다</button>"
		Column_M += @"<br>"
	ENDIF
	IF CSVCSTR(CSV番号, GETNUM(CSTR, "二人称")) == ""
		Column_M += @"<button value='601'>[601] 2인칭을 설정한다</button>"
		Column_M += @"<br>"
	ENDIF
ENDIF
Column_M += @"<br>"
Column_M += @"<button value='700'>[700] 작업 상황을 저장한다</button>"
Column_M += @"<br>"
Column_M += @"<button value='701'>[701] 작업 상황을 불러온다</button>"
Column_M += @"<br>"
Column_M += @"<button value='800'>[800] 이것으로 결정한다</button>"
Column_M += @"<br>"
Column_M += @"<button value='999'>[999] 돌아간다</button>"
Column_M += @"</div>"

Column_S = <div rect='2125,687,3675,2812'>

SELECTCASE 表示モード
	CASE 100 TO L_SPR:0 - 1
		;業務中コメント
		Column_S += @"업무 중에 표시되는 한마디 코멘트를 설정합니다<br>"
		Column_S += @"바리에이션을 늘렸을 경우, 그 중에서 동일한 확률로 1개가 선택되어 표시됩니다<br>"
		Column_S += "-----------------------------------------------------------------------<br>"
		FOR LOCAL, 0, VARSIZE("業務中リスト")
			LOCAL:1 = (100 + LOCAL) * 10
			Column_S += @"<button value='{LOCAL:1}'>[{LOCAL:1}] %業務中リスト:LOCAL%</button><br>"
			SIF !INRANGE(表示モード:1, LOCAL:1, LOCAL:1+9)
				CONTINUE
			FOR L_CNT, 0, 10
				IF L_CNT == 9
					Column_S += @"<font color='#%カラーパレット_HTML("黄")%'>　　　　 바리에이션은 더 이상 늘릴 수 없습니다</font><br>"
				ELSEIF コメント_業務中:LOCAL:L_CNT != ""
					Column_S += @"<button value='{LOCAL:1+L_CNT+1}'>　[{LOCAL:1+L_CNT+1}] "
					CALL PRINT_STR_メッセージ用(コメント_業務中:LOCAL:L_CNT)
					Column_S += @"<font color='#808080'>{L_CNT+1}.</font>%RESULTS%</button><br>"
				ELSE
					Column_S += @"<button value='{LOCAL:1+L_CNT+1}'><font color='#808080'>"
					Column_S += @"　[{LOCAL:1+L_CNT+1}] 바리에이션을 늘린다</font></button><br>"
					BREAK
				ENDIF
			NEXT
		NEXT
	CASE L_SPR:0 TO L_SPR:1 - 1
		;状況別コメント
		Column_S += @"특정 상황에서 표시되는 한마디 코멘트를 설정합니다<br>"
		Column_S += @"바리에이션을 늘렸을 경우, 그 중에서 동일한 확률로 1개가 선택되어 표시됩니다<br>"
		Column_S += "-----------------------------------------------------------------------<br>"
		FOR LOCAL, 0, VARSIZE("状況別リスト")
			LOCAL:1 = (L_SPR:0 + LOCAL) * 10
			Column_S += @"<button value='{LOCAL:1}'>[{LOCAL:1}] %状況別リスト:LOCAL%</button><br>"
			SIF !INRANGE(表示モード:1, LOCAL:1, LOCAL:1+9)
				CONTINUE
			FOR L_CNT, 0, 10
				IF L_CNT == 9
					Column_S += @"<font color='#%カラーパレット_HTML("黄")%'>　　　　 바리에이션은 더 이상 늘릴 수 없습니다</font><br>"
				ELSEIF コメント_状況別:LOCAL:L_CNT != ""
					Column_S += @"<button value='{LOCAL:1+L_CNT+1}'>　[{LOCAL:1+L_CNT+1}] "
					CALL PRINT_STR_メッセージ用(コメント_状況別:LOCAL:L_CNT)
					Column_S += @"<font color='#808080'>{L_CNT+1}.</font>%RESULTS%</button><br>"
				ELSE
					Column_S += @"<button value='{LOCAL:1+L_CNT+1}'><font color='#808080'>"
					Column_S += @"　[{LOCAL:1+L_CNT+1}] 다양성을 늘리다</font></button><br>"
					BREAK
				ENDIF
			NEXT
		NEXT
	CASE L_SPR:1 TO L_SPR:1 + 6
		;好感度コメント
		LOCAL = MAX(表示モード % L_SPR:1 - 1, 0)
		LOCAL:1 = (L_SPR:1 + LOCAL) * 10
		Column_S += @"상태 화면의 관계란에 표시되는, 각종 호감도의<br>종류・단계에 따라 표시되는 코멘트를 설정합니다<br>"
		Column_S += @"(간이 에디터이므로 각 한 줄만 설정할 수 없습니다. <br>　장문으로 하고 싶다면 출력 후의 ERB 파일을 편집해 주십시오)<br>"
		Column_S += "-----------------------------------------------------------------------<br>"
		Column_S += @"・%好感度リスト:LOCAL%<br>"
		FOR L_CNT, 0, 6
			Column_S += @"<button value='{LOCAL:1 + L_CNT+1}'>\@ CSTR:キャラ固有好感度要素 != ""? (%CSTR:キャラ固有好感度要素%)# \@<font color='#808080'>"
			Column_S += @"　[{LOCAL:1+L_CNT+1}]</font> %関係名:LOCAL:L_CNT, 16, LEFT%："
			IF コメント_好感度:LOCAL:L_CNT != ""
				CALL PRINT_STR_メッセージ用(コメント_好感度:LOCAL:L_CNT)
				Column_S += @"%RESULTS%</button><br>"
			ELSE
				Column_S += @"<font color='#808080'>"
				Column_S += @"　(미설정)</font></button><br>"
				CONTINUE
			ENDIF
		NEXT
	CASE L_SPR:2 TO L_SPR:3 - 1
		;キャラ解説
		LOCAL:1 = L_SPR:2 * 10
		Column_S += @"상태 화면에 표시되는, 캐릭터 해설문을 설정합니다<br>"
		Column_S += "-----------------------------------------------------------------------<br>"
		FOR L_CNT, 0, 10
			IF L_CNT == 9
				Column_S += @"<font color='#%カラーパレット_HTML("黄")%'>줄 수는 더 이상 늘릴 수 없습니다</font><br>"
			ELSEIF コメント_解説:0:L_CNT != ""
				Column_S += @"<button value='{LOCAL:1+L_CNT+1}'>"
				CALL PRINT_STR_メッセージ用(コメント_解説:0:L_CNT)
				Column_S += @"　[{LOCAL:1+L_CNT+1}] %RESULTS%</button><br>"
			ELSE
				Column_S += @"<button value='{LOCAL:1+L_CNT+1}'><font color='#808080'>"
				Column_S += @"　[{LOCAL:1+L_CNT+1}] \@ !L_CNT? (미설정)# 줄 수를 늘리다\@</font></button><br>"
				BREAK
			ENDIF
		NEXT
ENDSELECT
Column_S += @"</div>"

HTML_PRINT Column_M + Column_S
FOR LOCAL, 0, 29
	PRINTL
NEXT
DRAWLINE
BINPUT

LOCAL = RESULT
SELECTCASE LOCAL
	CASE 100 TO L_SPR:1 - 1
		;一言コメントモード
		表示モード = LOCAL
		表示モード:1 = LOCAL * 10
	CASE L_SPR:1 TO L_SPR:2 - 1
		;好感度コメントモード
		表示モード = LOCAL
		表示モード:1 = LOCAL * 10
	CASE L_SPR:1 + 6
		;恋慕度コメントモード
		表示モード = LOCAL
	CASE L_SPR:2
		;キャラ解説モード
		表示モード = LOCAL
	CASE 600
		;一人称を入力
		SETTEXTBOX CSTR:一人称
		PRINTL 1인칭을 입력해 주십시오
		INPUTS
		CSTR:一人称 '= RESULTS
	CASE 601
		;二人称を入力
		SETTEXTBOX CSTR:二人称
		PRINTL 2인칭을 입력해 주십시오
		INPUTS
		CSTR:二人称 '= RESULTS
	CASE 700
		;一時保存
		CALL CHOICE("作業状況を保存しますか？（ERB形式では出力されません）", "はい", "いいえ")
		SIF !RESULT
			GOTO TXT出力
	CASE 701
		;一時保存
		CALL CHOICE("保存してある作業状況を呼び出しますか？（現在の作業状況はリセットされます）", "はい", "いいえ")
		SIF !RESULT
			GOTO TXT呼出
	CASE 800
		;決定・出力
		CALL CHOICE("エディタを終了し、設定された一言コメント/解説を出力しますか？", "はい", "いいえ")
		SIF !RESULT
			GOTO ERB出力
	CASE 999
		;戻る
		CALL CHOICE("一言コメント/解説エディタを終了しますか？（セーブは自動では行われません）", "はい", "いいえ")
		SIF RESULT
			GOTO コメント_LOOP
		DELCHARA CHARANUM-1, CHARANUM-2
		RETURN 0
	CASE IS >= 1000
		;入力処理
		表示モード:1 = LOCAL
		;選択した項目だけ一覧を表示
		SIF !(LOCAL % 10)
			GOTO コメント_LOOP
		SELECTCASE 表示モード
			CASE 100 TO L_SPR:0 - 1
				LOCALS = 코멘트_업무 중
			CASE L_SPR:0 TO L_SPR:1 - 1
LOCALS = 코멘트_상황별
			CASE L_SPR:1 TO L_SPR:1 + 6
				LOCALS = 코멘트_호감도
			CASE L_SPR:2 TO L_SPR:3 - 1
				LOCALS = 코멘트_해설
		ENDSELECT
		LOCALS:1 = :{(表示モード:1%100)/10}:{(表示モード:1%10)-1}
		CALL KSTR構文入力(GETVARS(@"%LOCALS+LOCALS:1%"), TARGET, LOCALS)
		SETVAR @"%LOCALS+LOCALS:1%", RESULTS
		;好感度コメント以外で入力が空欄なら後ろを詰める
		IF RESULTS == "" && LOCALS != "コメント_好感度"
			FOR LOCAL, (表示モード:1%10)-1, VARSIZE(LOCALS, 2)-1
				SETVAR @"%LOCALS%:{(表示モード:1%100)/10}:{LOCAL}", GETVARS(@"%LOCALS%:{(表示モード:1%100)/10}:{LOCAL+1}")
			NEXT
			SETVAR @"%LOCALS%:{(表示モード:1%100)/10}:{LOCAL}", ""
		ENDIF
ENDSELECT

GOTO コメント_LOOP

$TXT出力
VARSET LOCALS
LOCALS = {CSV番号}|%キャラ名%
LOCALS += "\n"
FOR LOCAL, 0, VARSIZE("コメント種類")
;	LOCALS += コメント種類:LOCAL
	FOR L_CNT, 0, VARSIZE(コメント種類:LOCAL, 1)
		FOR L_CNT2, 0, VARSIZE(コメント種類:LOCAL, 2)
			LOCALS += GETVARS(@"%コメント種類:LOCAL%:{L_CNT}:{L_CNT2}") +  "/"
		NEXT
		LOCALS += "|"
	NEXT
	LOCALS += "\n"
NEXT
LOCALS += @"%CSTR:一人称%/%CSTR:二人称%\n"
SAVETEXT LOCALS, @"dat/コメント一時保存/{CSV番号}_%キャラ名%_{GETTIME()/100000}.txt"
PRINTFORMW dat/코멘트 임시 저장/{CSV番号}_%キャラ名%_{GETTIME()/100000}.txt에 저장했습니다.

GOTO コメント_LOOP

$TXT呼出
VARSET LOCAL
VARSET LOCALS
VARSET RESULTS
LOCAL:1 = ENUMFILES("dat/コメント一時保存/", "*.txt")
IF !LOCAL:1
	PRINTW 불러올 수 있는 파일이 존재하지 않습니다
	GOTO コメント_LOOP
ENDIF
PRINTL 불러올 파일을 선택해 주세요
FOR L_CNT, 0, LOCAL:1
	LOCALS:L_CNT '= RESULTS:L_CNT
	PRINTBUTTON @"[{L_CNT, 3, RIGHT}] %NAME表示省略(REPLACE(LOCALS:L_CNT, "dat//コメント一時保存//", "")), 40, LEFT%　", L_CNT
	SIF L_CNT % 3 == 2
		PRINTL
NEXT
SIF L_CNT % 3
	PRINTL
PRINTBUTTON "[999] 돌아가기", 999
BINPUT
LOCAL = RESULT
SELECTCASE LOCAL
	CASE 999
		GOTO コメント_LOOP
	CASEELSE
		PRINTFORML 현재 작업을 중단하고, 저장된 작업 상황　%LOCALS:LOCAL%　을(를) 불러옵니다.
		CALL CHOICE("本当によろしいですか？", "はい", "いいえ")
		SIF RESULT
			GOTO コメント_LOOP
ENDSELECT

VARSET RESULTS

SPLIT LOADTEXT(LOCALS:LOCAL), "\n", RESULTS

表示モード = 100
表示モード:1 = 1000
VARSET コメント_業務中
VARSET コメント_状況別
VARSET コメント_好感度
VARSET コメント_解説
VARSET キャラ名

SPLIT RESULTS:0, "|", LOCALS
CSV番号 = TOINT(LOCALS:0)
SIF !EXISTCSV(CSV番号)
	キャラ名 = %LOCALS:1%

FOR LOCAL, 1, VARSIZE("コメント種類")+1
	VARSET LOCALS
	SPLIT RESULTS:LOCAL, "|", LOCALS
	LOCAL:1 = RESULT
	FOR L_CNT, 0, LOCAL:1-1
		SPLIT LOCALS:L_CNT, "/", コメント_値
		LOCAL:2 = RESULT
		FOR L_CNT2, 0, LOCAL:2-1
			SETVAR @"%コメント種類:(LOCAL-1)%:{L_CNT}:{L_CNT2}", コメント_値:L_CNT2
		NEXT
	NEXT
NEXT
SPLIT RESULTS:LOCAL, "/", 人称
DELCHARA TARGET

GOTO コメント_INIT

$ERB出力
CLEARLINE MAX(LINECOUNT, 500)

PRINTL ;・사용법
PRINTFORML ;「{CSV番号}」을(를) 캐릭터 번호로 치환하고, 각 함수에 처리를 넣는다
PRINTL ;--------------------------------------------------
PRINTL ;통상 화면 한마디 구상
PRINTL ;--------------------------------------------------
PRINTFORML @구상_INFO화면_한마디코멘트_{CSV番号}(대상캐릭터)
PRINTL #DIM 대상캐릭터
PRINTL CALL 구상변수초기화
HTML_PRINT "<br>"
PRINTL ;구상과 같은 감각으로 사용하기 위해 서식을 통일하고 있지만, 통상 화면에 표시되므로
PRINTL ;기본적으로 WAIT 계열은 사용하지 않는 것을 권장
PRINTL ;또한, 한 줄만 표시하는 것을 상정. 두 줄 이상은 기본적으로 금지
PRINTL ;※우후후 중에는 표시되지 않습니다
HTML_PRINT "<br>"
PRINTL ;이하는 분기의 예
PRINTL ;근무 중 한마디 구상
PRINTL IF TALENT:対象キャラ:従業員 && TCVAR:対象キャラ:休暇中 == 0 && CFLAG:対象キャラ:現在位置 == 現在仕事:対象キャラ:1 % 10000 && CFLAG:対象キャラ:現在マップ種別 == 現在仕事:対象キャラ:1 / 10000
PRINTL 	SELECTCASE 現在仕事:対象キャラ:1
PRINTL 		CASE 2
PRINTL 			;로비에서 접수 중
CALL コメント出力(コメント_業務中, 業務中リスト, "ロビー受付", "			")
PRINTL 		CASE 503
PRINTL 			;바 구역에서 바텐더 중
CALL コメント出力(コメント_業務中, 業務中リスト, "バーテンダー", "			")
PRINTL 		CASE 506
PRINTL 			;도서실에서 사서 중
CALL コメント出力(コメント_業務中, 業務中リスト, "司書", "			")
PRINTL 		CASE 1503, 15
PRINTL 			;수영장에서 감시원 중
CALL コメント出力(コメント_業務中, 業務中リスト, "プール監視員", "			")
PRINTL 		CASE IS > 10000
PRINTL 			;각종 점포에서 가게 지킴이 중
PRINTL 			CALLFORMF 空艇港店舗名表示_{空艇港店舗状況:(現在仕事:対象キャラ:1 - 10000):0}(現在仕事:対象キャラ:1 - 10000)
PRINTL 			SELECTCASE REPLACE(TSTR:場所名受渡, "『.*』", "")
PRINTL 				CASE "도구점"
CALL コメント出力(コメント_業務中, 業務中リスト, "道具屋", "					")
PRINTL 				CASE "기념품점"
CALL コメント出力(コメント_業務中, 業務中リスト, "土産物屋", "					")
PRINTL 				CASE "식당"
CALL コメント出力(コメント_業務中, 業務中リスト, "食事処", "					")
PRINTL 				CASE "장신구점"
CALL コメント出力(コメント_業務中, 業務中リスト, "装飾品店", "					")
PRINTL 			ENDSELECT
PRINTL 	ENDSELECT
PRINTL ENDIF
PRINTL ;이 시점에서 대사가 입력되어 있다면 표시로 건너뛴다
PRINTL SIF KSTR:0 != ""
PRINTL 	GOTO 表示位置
PRINTL ;상황에 따라 분기
HTML_PRINT "<br>"
PRINTL IF CFLAG:対象キャラ:飲み会
PRINTL 	;술자리 중
CALL コメント出力(コメント_状況別, 状況別リスト, "飲み会", "	")
PRINTL ELSEIF CFLAG:対象キャラ:睡眠
PRINTL 	;수면 중
CALL コメント出力(コメント_状況別, 状況別リスト, "睡眠中", "	")
PRINTL ELSEIF CFLAG:対象キャラ:デート
PRINTL 	;데이트 중
PRINTL 	;데이트 상대의 캐릭터 번호 + 100이 들어있다
PRINTL 	;당신이 상대라면 「CFLAG:対象キャラ:デート == MASTER + 100」
CALL コメント出力(コメント_状況別, 状況別リスト, "デート中", "	")
PRINTL ELSEIF CFLAG:対象キャラ:함께놀기
PRINTL 	;함께 노는 중
CALL コメント出力(コメント_状況別, 状況別リスト, "一緒に遊んでいる最中", "	")
PRINTL ELSEIF CFLAG:対象キャラ:동행
PRINTL 	;동행 중
CALL コメント出力(コメント_状況別, 状況別リスト, "同行中", "	")
PRINTL ELSEIF CFLAG:PLAYER:은밀 && CFLAG:対象キャラ:은밀
PRINTL 	;함께 은밀 중
CALL コメント出力(コメント_状況別, 状況別リスト, "一緒に隠れている最中", "	")
PRINTL ELSEIF CFLAG:PLAYER:은밀 && !CFLAG:対象キャラ:은밀
PRINTL 	;당신이 숨어있고, 캐릭터는 당신을 눈치채지 못했다
CALL コメント出力(コメント_状況別, 状況別リスト, "隠れているあなたに気づいていない時", "	")
PRINTL ELSEIF !CFLAG:PLAYER:은밀 && CFLAG:対象キャラ:은밀
PRINTL 	;캐릭터의 야외 자위 중
CALL コメント出力(コメント_状況別, 状況別リスト, "野外オナニー中", "	")
PRINTL ENDIF
PRINTL ;이 시점에서 대사가 있다면 표시로 이동
PRINTL SIF KSTR:0 != ""
PRINTL 	GOTO 표시위치
HTML_PRINT "<br>"
PRINTL ;가장 많은 호감도 요소로 분기
PRINTL ;간이 버전이므로 스테이터스 화면의 코멘트를 이용. 세부적으로 정하고 싶다면 나중에 편집해주세요
PRINTL SELECTCASE MAXRAND(CFLAG:対象キャラ:友情度, CFLAG:対象キャラ:信頼度, CFLAG:対象キャラ:恋心度, CFLAG:対象キャラ:性愛度)
PRINTL 	CASE 0
PRINTL 		;우정도
PRINTFORML 		CALL 대사_상태 화면_우정 코멘트_{CSV番号}(대상 캐릭터, 1)
PRINTL 	CASE 1
PRINTL 		;신뢰도
PRINTFORML 		CALL 대사_상태 화면_신뢰 코멘트_{CSV番号}(대상 캐릭터, 1)
PRINTL 	CASE 2
PRINTL 		;연심도
PRINTFORML 		CALL 대사_상태 화면_연심 코멘트_{CSV番号}(대상 캐릭터, 1)
PRINTL 	CASE 3
PRINTL 		;성애도
PRINTFORML 		CALL 대사_상태 화면_성애 코멘트_{CSV番号}(대상 캐릭터, 1)
PRINTL ENDSELECT
HTML_PRINT "<br>"
PRINTL IF K > 1
PRINTL 	KSTR:0 '= KSTR:0 + KSTR:1
PRINTL 	KSTR:1 '= ""
PRINTL ENDIF
HTML_PRINT "<br>"
PRINTL $表示位置
PRINTL CALL PRINT_STATE 코멘트 표시(대상 캐릭터, 2)
HTML_PRINT "<br>"
HTML_PRINT "<br>"
PRINTL ;--------------------------------------------------
PRINTL ;상태 화면 한마디 대사_우정
PRINTL ;--------------------------------------------------
PRINTFORML @口上_ステータス画面_友情コメント_{CSV番号}(対象キャラ, ARG=0)
PRINTL #DIM 対象キャラ
PRINTL CALL 대사 변수 초기화
HTML_PRINT "<br>"
PRINTL ;대사와 같은 감각으로 사용하기 위해 서식을 통일하고 있지만, 상태 화면에 표시되므로
PRINTL ;기본적으로 WAIT 계열은 사용하지 않는 것을 권장
PRINTL ;이것도 간이 버전이므로 한 줄로만 제한
HTML_PRINT "<br>"
PRINTL SELECTCASE CFLAG:対象キャラ:友情度
PRINTL 	CASE IS == 0
PRINTL 		;첫 만남
PRINTFORML 		KSTR:(K++) = %コメント_好感度:0:0%
PRINTL 	CASE IS <= 経験値テーブル:(関係閾値:1)
PRINTL 		;타인
PRINTFORML 		KSTR:(K++) = %コメント_好感度:0:1%
PRINTL 	CASE IS <= 経験値テーブル:(関係閾値:2)
PRINTL 		;아는 사람
PRINTFORML 		KSTR:(K++) = %コメント_好感度:0:2%
PRINTL 	CASE IS <= 経験値テーブル:(関係閾値:3)
PRINTL 		;친구
PRINTFORML 		KSTR:(K++) = %コメント_好感度:0:3%
PRINTL 	CASE IS <= 経験値テーブル:(関係閾値:4)
PRINTL 		;절친
PRINTFORML 		KSTR:(K++) = %コメント_好感度:0:4%
PRINTL 	CASEELSE
PRINTL 		;둘도 없는 친구
PRINTFORML 		KSTR:(K++) = %コメント_好感度:0:5%
PRINTL ENDSELECT
HTML_PRINT "<br>"
PRINTL SIF ARG
PRINTL 	RETURN
HTML_PRINT "<br>"
PRINTL CALL PRINT_STATEコメント表示(対象キャラ)
HTML_PRINT "<br>"
PRINTL ;--------------------------------------------------
PRINTL ;상태 화면 한마디 인사_신뢰
PRINTL ;--------------------------------------------------
PRINTFORML @口上_ステータス画面_信頼コメント_{CSV番号}(対象キャラ, ARG=0)
PRINTL #DIM 대상 캐릭터
PRINTL CALL 구상 변수 초기화
PRINTL SELECTCASE CFLAG:対象キャラ:신뢰도
PRINTL 	CASE IS == 0
PRINTL 		;첫 만남
PRINTFORML 		KSTR:(K++) = %コメント_好感度:1:0%
PRINTL 	CASE IS <= 경험치 테이블:(관계 임계치:1)
PRINTL 		;타인
PRINTFORML 		KSTR:(K++) = %コメント_好感度:1:1%
PRINTL 	CASE IS <= 경험치 테이블:(관계 임계치:2)
PRINTL 		;아는 사람
PRINTFORML 		KSTR:(K++) = %コメント_好感度:1:2%
PRINTL 	CASE IS <= 경험치 테이블:(관계 임계치:3)
PRINTL 		;지기
PRINTFORML 		KSTR:(K++) = %コメント_好感度:1:3%
PRINTL 	CASE IS <= 경험치 테이블:(관계 임계치:4)
PRINTL 		;파트너
PRINTFORML 		KSTR:(K++) = %コメント_好感度:1:4%
PRINTL 	CASEELSE
PRINTL 		;수어지교
PRINTFORML 		KSTR:(K++) = %コメント_好感度:1:5%
PRINTL ENDSELECT
HTML_PRINT "<br>"
PRINTL SIF ARG
PRINTL 	RETURN
HTML_PRINT "<br>"
PRINTL CALL PRINT_STATE코멘트 표시(대상 캐릭터)
HTML_PRINT "<br>"
PRINTL ;--------------------------------------------------
PRINTL ;상태 화면 한마디 인사_연심
PRINTL ;--------------------------------------------------
PRINTFORML @口上_ステータス画面_恋心コメント_{CSV番号}(対象キャラ, ARG=0)
PRINTL #DIM 対象キャラ
PRINTL CALL 口上変数初期化
PRINTL SELECTCASE CFLAG:対象キャラ:恋心度
PRINTL 	CASE IS == 0
PRINTL 		;첫 만남
PRINTFORML 		KSTR:(K++) = %コメント_好感度:2:0%
PRINTL 	CASE IS <= 経験値テーブル:(関係閾値:1)
PRINTL 		;타인
PRINTFORML 		KSTR:(K++) = %コメント_好感度:2:1%
PRINTL 	CASE IS <= 経験値テーブル:(関係閾値:2)
PRINTL 		;아는 사람
PRINTFORML 		KSTR:(K++) = %コメント_好感度:2:2%
PRINTL 	CASE IS <= 経験値テーブル:(関係閾値:3)
PRINTL 		;신경 쓰이는 사람
PRINTFORML 		KSTR:(K++) = %コメント_好感度:2:3%
PRINTL 	CASE IS <= 経験値テーブル:(関係閾値:4)
PRINTL 		;연인
PRINTFORML 		KSTR:(K++) = %コメント_好感度:2:4%
PRINTL 	CASEELSE
PRINTL 		;가장 사랑하는 사람
PRINTFORML 		KSTR:(K++) = %コメント_好感度:2:5%
PRINTL ENDSELECT
HTML_PRINT "<br>"
PRINTL SIF ARG
PRINTL 	RETURN
HTML_PRINT "<br>"
PRINTL CALL PRINT_STATE코멘트 표시(대상 캐릭터)
HTML_PRINT "<br>"
PRINTL ;--------------------------------------------------
PRINTL ;스테이터스 화면 한마디 구상_성애
PRINTL ;--------------------------------------------------
PRINTFORML @口上_ステータス画面_性愛コメント_{CSV番号}(対象キャラ, ARG=0)
PRINTL #DIM 대상 캐릭터
PRINTL CALL 구상 변수 초기화
PRINTL SELECTCASE CFLAG:対象キャラ:성애도
PRINTL 	CASE IS == 0
PRINTL 		;첫 만남
PRINTFORML 		KSTR:(K++) = %コメント_好感度:3:0%
PRINTL 	CASE IS <= 경험치 테이블:(관계 임계치:1)
PRINTL 		;타인
PRINTFORML 		KSTR:(K++) = %コメント_好感度:3:1%
PRINTL 	CASE IS <= 경험치 테이블:(관계 임계치:2)
PRINTL 		;아는 사람
PRINTFORML 		KSTR:(K++) = %コメント_好感度:3:2%
PRINTL 	CASE IS <= 경험치 테이블:(관계 임계치:3)
PRINTL 		;성벽에 맞다
PRINTFORML 		KSTR:(K++) = %コメント_好感度:3:3%
PRINTL 	CASE IS <= 경험치 테이블:(관계 임계치:4)
PRINTL 		;자위의 대상
PRINTFORML 		KSTR:(K++) = %コメント_好感度:3:4%
PRINTL 	CASEELSE
PRINTL 		;육욕의 포로
PRINTFORML 		KSTR:(K++) = %コメント_好感度:3:5%
PRINTL ENDSELECT
HTML_PRINT "<br>"
PRINTL SIF ARG
PRINTL 	RETURN
HTML_PRINT "<br>"
PRINTL CALL PRINT_STATEコメント表示(対象キャラ, 1)
HTML_PRINT "<br>"
PRINTL ;--------------------------------------------------
PRINTL ;스테이터스 화면 한마디 구상_고유 요소
PRINTL ;--------------------------------------------------
PRINTFORML @口上_ステータス画面_キャラ固有好感度要素コメント_{CSV番号}(対象キャラ, ARG=0)
PRINTL #DIM 対象キャラ
PRINTL CALL 口上変数初期化
PRINTL SELECTCASE CFLAG:対象キャラ:キャラ固有好感度
PRINTL 	CASE IS == 0
PRINTL 		;첫 만남
PRINTFORML 		KSTR:(K++) = %コメント_好感度:4:5%
PRINTL 	CASE IS <= 経験値テーブル:(関係閾値:1)
PRINTL 		;타인
PRINTFORML 		KSTR:(K++) = %コメント_好感度:4:5%
PRINTL 	CASE IS <= 経験値テーブル:(関係閾値:2)
PRINTL 		;아는 사람
PRINTFORML 		KSTR:(K++) = %コメント_好感度:4:5%
PRINTL 	CASE IS <= 経験値テーブル:(関係閾値:3)
PRINTL 		;
PRINTFORML 		KSTR:(K++) = %コメント_好感度:4:5%
PRINTL 	CASE IS <= 経験値テーブル:(関係閾値:4)
PRINTL 		;
PRINTFORML 		KSTR:(K++) = %コメント_好感度:4:5%
PRINTL 	CASEELSE
PRINTL 		;
PRINTFORML 		KSTR:(K++) = %コメント_好感度:4:5%
PRINTL ENDSELECT
HTML_PRINT "<br>"
PRINTL SIF ARG
PRINTL 	RETURN
HTML_PRINT "<br>"
PRINTL CALL PRINT_STATEコメント表示(対象キャラ, 1)
HTML_PRINT "<br>"
PRINTL ;--------------------------------------------------
PRINTL ;스테이터스 화면 한마디 구상_연모
PRINTL ;--------------------------------------------------
PRINTFORML @口上_ステータス画面_恋慕コメント_{CSV番号}(対象キャラ, ARG=0)
PRINTL #DIM 対象キャラ
PRINTL CALL 口上変数初期化
PRINTL PRINTL 
PRINTL SELECTCASE CFLAG:対象キャラ:恋慕レベル
PRINTL 	CASE IS == 0
PRINTL 		;가망 없음
PRINTFORML 		KSTR:(K++) = %コメント_好感度:5:0%
PRINTL 	CASE IS <= 関係閾値:1
PRINTL 		;조금 신경 쓰임
PRINTFORML 		KSTR:(K++) = %コメント_好感度:5:1%
PRINTL 	CASE IS <= 関係閾値:2
PRINTL 		;왠지 좋을지도
PRINTFORML 		KSTR:(K++) = %コメント_好感度:5:2%
PRINTL 	CASE IS <= 関係閾値:3
PRINTL 		;호의를 자각
PRINTFORML 		KSTR:(K++) = %コメント_好感度:5:3%
PRINTL 	CASE IS <= 関係閾値:4
PRINTL 		;러브러브
PRINTFORML 		KSTR:(K++) = %コメント_好感度:5:4%
PRINTL 	CASEELSE
PRINTL 		;가장 사랑하는 사람
PRINTFORML 		KSTR:(K++) = %コメント_好感度:5:5%
PRINTL ENDSELECT
HTML_PRINT "<br>"
PRINTL SIF ARG
PRINTL 	RETURN
HTML_PRINT "<br>"
PRINTL CALL PRINT_STATE코멘트 표시(대상 캐릭터, 1)
HTML_PRINT "<br>"
PRINTL ;--------------------------------------------------
PRINTL ;캐릭터에 대한 해설
PRINTL ;--------------------------------------------------
PRINTFORML @구상_스테이터스 화면_캐릭터 해설_{CSV番号}(대상 캐릭터)
PRINTL #DIM 대상 캐릭터
PRINTL ;EX 캐릭터의 출처를 해설하거나, 캐릭터의 설정·배경을 해설하는 것
HTML_PRINT "<br>"
IF コメント_解説:0:0 != ""
	FOR LOCAL, 0, VARSIZE("コメント_解説", 2)
		SIF コメント_解説:0:LOCAL == ""
			BREAK
		PRINTFORML KSTR:(K++) = %コメント_解説:0:LOCAL%
	NEXT
ELSE
	PRINTL KSTR:(K++) = 　
	PRINTL KSTR:(K++) = 　
	PRINTL KSTR:(K++) = 　
	PRINTL KSTR:(K++) = 　
ENDIF

IF !EXISTFUNCTION(@"口上側初期パラメータ変更_{CSV番号}") && EXISTCSV(CSV番号) && (CSVCSTR(CSV番号, GETNUM(CSTR, "一人称")) != CSTR:一人称 || CSVCSTR(CSV番号, GETNUM(CSTR, "二人称")) != CSTR:二人称)
	HTML_PRINT "<br>"
	PRINTL ;--------------------------------------------------
	PRINTL ;초기 파라미터 변경
	PRINTL ;--------------------------------------------------
	PRINTFORML @구상측 초기 파라미터 변경_{CSV番号}
	PRINTL ;NEWGAME 시에 호출되는 함수, 로드 시에는 호출되지 않음에 주의
	PRINTL ;TALENT를 ONOFF하거나, EXP의 취득이나 초기 ABL의 변경 등을 여기에 기술할 것
	PRINTL LOCAL = GETCHARA({CSV番号})
	HTML_PRINT "<br>"
	PRINTL ;캐릭터가 자신을 지칭할 때의 호칭
	PRINTFORML CSTR:LOCAL:一人称 = %CSTR:一人称%
	HTML_PRINT "<br>"
	PRINTL ;캐릭터가 당신을 지칭할 때의 호칭
	PRINTFORML CSTR:LOCAL:二人称 = %CSTR:二人称%
	HTML_PRINT "<br>"
	PRINTL ;--------------------------------------------------
	PRINTL ;로드 시 파라미터 변경
	PRINTL ;--------------------------------------------------
	PRINTL @口上側LOADENDパラメータ変更_{CSV番号}
	PRINTL ;로드 시 호출되는 변수. NEWGAME 시 호출되지 않음에 주의
	PRINTL ;위 함수만으로는 나중에 추가했을 때 버그가 발생하므로 추가
	PRINTL LOCAL = GETCHARA({CSV番号})
	HTML_PRINT "<br>"
	PRINTL ;캐릭터가 자신을 지칭할 때의 호칭
	PRINTL IF CSTR:LOCAL:一人称 == ""
	PRINTFORML 	CSTR:LOCAL:一人称 = %CSTR:一人称%
	PRINTL ENDIF
	PRINTL ;캐릭터가 당신을 지칭할 때의 호칭
	PRINTL IF CSTR:LOCAL:二人称 == ""
	PRINTFORML 	CSTR:LOCAL:二人称 = %CSTR:二人称%
	PRINTL ENDIF
	HTML_PRINT "<br>"
ENDIF

OUTPUTLOG @"ERB_EDITFILE/口上_{CSV番号}_%キャラ名%_ステータス画面.ERB", 1
PRINTFORML ERB_EDITFILE 폴더에 출력했습니다. 「ERB/구상_캐릭터 개별 ERB/{CSV番号}_%キャラ名%」 폴더로 이동시켜 주십시오
PRINTFORMW (게임에 반영하려면 Emuera 본체를 다시 시작해야 합니다)
DELCHARA CHARANUM-1, CHARANUM-2
RETURN 0

@コメント出力(コメント, リスト, 種類, インデント)
#DIMS 種類
#DIMS インデント 
#DIMS REF リスト,0
#DIMS REF コメント,0,0
#DIM L_CNT

LOCAL = FINDELEMENT(リスト, 種類, , ,1)
IF コメント:LOCAL:1 == ""
	PRINTFORML %インデント%KSTR:(K++) = %コメント:LOCAL:0%
ELSE
	PRINTFORML %インデント%STRDATA KSTR:(K++)
	FOR L_CNT, 0, VARSIZE("コメント", 2)
		SIF コメント:LOCAL:L_CNT == ""
			BREAK
		PRINTFORML %インデント%	DATA %コメント:LOCAL:L_CNT%
	NEXT
	PRINTFORML %インデント%ENDDATA
ENDIF


;-------------------------------------------------
;整数ARG:0をARG:1桁で切り上げる関数。作らなくてもどっかありそうなんだけどなー
;-------------------------------------------------
@ROUNDUP(ARG, ARG:1)
#FUNCTION
IF ARG:1 <= 0
	THROW "@DECIMAL_STRINGの二番目の引数に0以下の値が指定されました({ARG:1})"
ENDIF
LOCAL = ARG / POWER(10, ARG:1)
SIF ARG % POWER(10, ARG:1)
	LOCAL ++
RETURNF LOCAL*POWER(10, ARG:1)
