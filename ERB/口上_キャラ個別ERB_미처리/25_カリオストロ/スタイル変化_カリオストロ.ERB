;****************************************
;スタイル変更系の処理に使う特殊関数
;****************************************
;・使い方
;「25」をキャラクター番号に置換し、それぞれの関数に処理を入れる
;「[天才美人錬金術師]カリオストロ」を任意のスタイル名に変更する
;****************************************

;--------------------------------------------------
;スタイル変更基礎関数
;ARG = 1:肉体再錬成コマンドからの呼び出し 2:ZPショップでの素質変化による起床時処理からの呼び出し
;--------------------------------------------------
@スタイル変更_25(対象キャラ, 動作モード, ARG=0)
#DIM 対象キャラ
#DIMS 動作モード

;この関数はいくつ別スタイル作ってもキャラ毎に一個
;必須関数、スタイル変更を追加する場合、必ず作成すること

SELECTCASE 動作モード
	CASE "スタイル名取得"
        ;ここは触らない
		VARSET RESULTS
		RESULTS:0 = %NAME:対象キャラ%
		RESULTS:10 = ノーマル

		;RESULTS:Xに名前全体を、RESULTS:X+10にリミテッドや水着など通称(？)を入れる
        ;例：
		; RESULTS:1 = [強化状態二つ名]テスト太郎
		; RESULTS:11 = 強化スタイル

		;スタイル変更の条件を付けたい場合、RESULTSを条件分岐の中にいれる。
		;以下はキャラの陥落を条件にする場合の条件分岐

		;陥落済みかつ非妊娠時、起床前の能力画面からのみ変更可能
		IF 陥落チェック_性的(対象キャラ) && TFLAG:調教モード == -1 && !CFLAG:対象キャラ:妊娠発覚
			RESULTS:1 = [天才美人錬金術師]カリオストロ
			RESULTS:11 = 大人
		ENDIF
        
		; 複数スタイルを作りたい場合はRESULTS:2、RESULTS:12のように数字をふやしていく
        
	CASE @"スタイル解説_%NAME:対象キャラ%"
		TSTR:スタイル解説 = 
		TSTR:スタイル解説 += @"■%NAME:対象キャラ%<br>"
		TSTR:スタイル解説 += "<br>"
		TSTR:スタイル解説 += "칼리오스트로 자신이 세계에서 가장 귀여워☆라고 자부하는 모습. <br>"
		TSTR:スタイル解説 += "신장 130cm의 사랑스러운 용모가 보호욕을 자극하는, 사실 틀림없는 미소녀이긴 하다……외모만은. <br>"
		TSTR:スタイル解説 += "육체 재연성이나 ZP 상점에서 캐릭터 소질을 변화시켰을 때<br>"
		TSTR:スタイル解説 += "특정 조건에서 벗어났을 경우에도, 이쪽으로 변화한다<br>"
		TSTR:スタイル解説 += "<br>"
		TSTR:スタイル解説 += @"<font color='#%カラーパレット_HTML("黄")%'>주의: 이 기능으로 스타일을 변경했을 경우<br>"
		TSTR:スタイル解説 += @"성별・종족・신장・가슴 사이즈・체형・하반신의 소질이 리셋됩니다. </font><br>"
        ;このCALLはそのままで良い
		CALL スタイル奥義アビ表示_汎用文章(対象キャラ, NAME:対象キャラ)
	CASE "スタイル解説_[天才美人錬金術師]カリオストロ"
		TSTR:スタイル解説 = 
		TSTR:スタイル解説 += "■[천재 미인 연금술사]칼리오스트로<br>"
		TSTR:スタイル解説 += "<br>"
		TSTR:スタイル解説 += "칼리오스트로가 연장자로서의 자각과 자의식으로 만들어낸 모습. <br>"
		TSTR:スタイル解説 += "성장한 그 용모는, 어른스러운 요염함을 풍기면서도 본래의 귀여움도 유지하고 있다. <br>"
		TSTR:スタイル解説 += "육체 재연성이나 ZP 상점에서 캐릭터 소질을 변화시켰을 때<br>"
		TSTR:スタイル解説 += "「종족: 휴먼」이며 「체격: 보통」 이상, 및<br>"
		TSTR:スタイル解説 += @"「가슴: 거유」 이상으로 설정했을 경우에도, 이쪽으로 변화한다<br>"
		TSTR:スタイル解説 += "<br>"
  		TSTR:スタイル解説 += @"<font color='#%カラーパレット_HTML("黄")%'>주의: 이 기능으로 스타일을 변경했을 경우<br>"
		TSTR:スタイル解説 += @"성별・종족・신장・가슴 사이즈・체형・하반신의 소질이 덮어쓰기됩니다. </font><br>"
      ;このCALLはそのままで良い、戦闘アビが変動しない場合は消しても良い
		CALL スタイル奥義アビ表示_汎用文章(対象キャラ, "[天才美人錬金術師]カリオストロ")
	CASE "変更後処理"
		;CSTR:対象キャラ:スタイル管理文字列をキーにして処理を実行
		;一人称や二人称、素質の変化などの調教側ステータスの変更を想定
        ;戦闘ステータスは別の関数
		SELECTCASE CSTR:対象キャラ:スタイル管理文字列
			CASE ""
                ;通常時に戻す処理
				IF ARG == 0
					TALENT:対象キャラ:バストサイズ = バストサイズ_貧乳
					TALENT:対象キャラ:体格 = 体格_小柄
					TALENT:対象キャラ:種族 = 種族_ヒューマン
					TALENT:対象キャラ:性別 = 性別_女性
					TALENT:対象キャラ:体型 = 体型_普通
					TALENT:対象キャラ:下半身 = 下半身_普通
					BASE:対象キャラ:身長 = CSVBASE(NO:対象キャラ, GETNUM(BASE, "身長"))
					BASE:対象キャラ:バスト = 0
					BASE:対象キャラ:ウエスト = 0
					BASE:対象キャラ:ヒップ = 0
					CALL SET_BODYSIZE(対象キャラ)
				ENDIF
				TALENT:対象キャラ:外見年齢 = 年齢層_若い
				CSTR:対象キャラ:フォルダ判定キー = 칼리오스트로
				SWAP BASE:対象キャラ:変動バスト, MAXBASE:対象キャラ:変動バスト
				SWAP BASE:対象キャラ:変動ウエスト, MAXBASE:対象キャラ:変動ウエスト
				SWAP BASE:対象キャラ:変動ヒップ, MAXBASE:対象キャラ:変動ヒップ
				SWAP CSTR:対象キャラ:画像フォルダ, CSTR:対象キャラ:スタイル変更前画像フォルダ
				SIF !HAS_RESOURCES(対象キャラ, 0)
					CSTR:対象キャラ:画像フォルダ '= GET_RESOURCES_BASE_FOLDER(対象キャラ)
				特定状況口上用フラグ:対象キャラ:19 = 0
				FOR LOCAL, 0, 9
					SWAP 今日の服装:対象キャラ:LOCAL,今日の服装:対象キャラ:(10+LOCAL)
				NEXT
				SIF 今日の服装:対象キャラ:衣装 == ""
					CALL CLOTHES_TODAY(対象キャラ)

			CASE "[天才美人錬金術師]カリオストロ"
                ;スタイル変更時の処理
				IF ARG == 0
					;前傾姿勢で並んだ時、直立姿勢のクラリスより少し高いくらいだったので、160cmくらい？
					TALENT:対象キャラ:バストサイズ = バストサイズ_巨乳
					TALENT:対象キャラ:体格 = 体格_普通
					TALENT:対象キャラ:種族 = 種族_ヒューマン
					TALENT:対象キャラ:性別 = 性別_女性
					TALENT:対象キャラ:体型 = 体型_普通
					TALENT:対象キャラ:下半身 = 下半身_普通
					BASE:対象キャラ:身長 = 1595
					BASE:対象キャラ:バスト = 0
					BASE:対象キャラ:ウエスト = 0
					BASE:対象キャラ:ヒップ = 0
					CALL SET_BODYSIZE(対象キャラ)
				ENDIF
				TALENT:対象キャラ:外見年齢 = 年齢層_大人
				CSTR:対象キャラ:フォルダ判定キー = 성인 칼리오스트로
				SWAP BASE:対象キャラ:変動バスト, MAXBASE:対象キャラ:変動バスト
				SWAP BASE:対象キャラ:変動ウエスト, MAXBASE:対象キャラ:変動ウエスト
				SWAP BASE:対象キャラ:変動ヒップ, MAXBASE:対象キャラ:変動ヒップ
				SWAP CSTR:対象キャラ:画像フォルダ, CSTR:対象キャラ:スタイル変更前画像フォルダ
				SIF !HAS_RESOURCES(対象キャラ, 0)
					CSTR:対象キャラ:画像フォルダ '= GET_RESOURCES_BASE_FOLDER(対象キャラ)
				特定状況口上用フラグ:対象キャラ:19 = 0
				FOR LOCAL, 0, 9
					SWAP 今日の服装:対象キャラ:LOCAL,今日の服装:対象キャラ:(10+LOCAL)
				NEXT
				SIF 今日の服装:対象キャラ:衣装 == ""
					CALL CLOTHES_TODAY(対象キャラ)
		ENDSELECT
ENDSELECT

[SKIPSTART]
;--------------------------------------------------
;スタイル変更時、戦闘ステータス変動
;--------------------------------------------------
@スタイルステータス補正_<スタイル二つ名>_<キャラ名>(対象キャラ)
#DIM 対象キャラ
;関数名に[]が使えないため、しょうがなく[]排除時の文字列をキーに
;例えば[強化状態二つ名]テスト太郎というスタイルなら、
;@スタイルステータス補正_強化状態二つ名_テスト太郎　という関数名にすること

;属性の変更、火とか水とか文字を変えるだけでOK
装備ステータス補正保存:対象キャラ:基礎属性変更 = 属性文字列数値変換("風") + 10
;ステータスの変更
装備ステータス補正保存:対象キャラ:攻撃力 += 100

;装備再計算時にこの関数は呼ばれる
;補正の順番は「スタイル＞指輪＞耳飾り＞料理など＞パーティキャラ補正」
;補正可能なステータスは「装備ステータス補正保存.ERD」を参照のこと


;--------------------------------------------------
;スタイル変更時、使用可能アビリティの変動
;--------------------------------------------------
;テンプレート「固有アビリティ_キャラ名.ERB」に記述する
;「@固有アビ_25_任意の文字列(ARGS, 対象キャラ)」の上部にある分岐を修正する

; IF スタイル判定関数(対象キャラ, "デフォルト") == 0
; を以下のように修正
; IF スタイル判定関数(対象キャラ, "[天才美人錬金術師]カリオストロ") == 0

;こうすることで、そのアビは[天才美人錬金術師]カリオストロになっている時のみ使用可能という意味になる


;--------------------------------------------------
;スタイル変更時、使用可能奥義の変動
;--------------------------------------------------
;奥義はアビのように複数種類を使うことを想定していないため、別関数を呼ぶことを推奨。
;奥義テンプレにある以下の分岐のうち、任意のスタイル名の部分を編集した上で
;奥義テンプレをコピーして作成した関数に貼り付け、中身を記述する。

; IF CSTR:対象キャラ:スタイル管理文字列 == "任意のスタイル名"
; 	CALL 任意のスタイル名固有奥義(ARGS, 対象キャラ)
; 	RETURN RESULT
; ENDIF
[SKIPEND]