
@知識系素質の取得(ARG)
;話術、釣り技能もここで成長
IF ARG == MASTER
	SELECTCASE EXP:MASTER:会話経験
		CASE IS >= 5000
			IF ABL:MASTER:話術技能 <= 9
				PRINTFORML %CALLNAME:MASTER%의 화술 기능이 Lv10이 되었다!
				ABL:MASTER:話術技能 = 10
			ENDIF
		CASE IS >= 2500
			IF ABL:MASTER:話術技能 <= 8
				PRINTFORML %CALLNAME:MASTER%의 화술 기능이 Lv9이 되었다!
				ABL:MASTER:話術技能 = 9
			ENDIF
		CASE IS >= 1500
			IF ABL:MASTER:話術技能 <= 7
				PRINTFORML %CALLNAME:MASTER%의 화술 기능이 Lv8이 되었다!
				ABL:MASTER:話術技能 = 8
			ENDIF
		CASE IS >= 1000
			IF ABL:MASTER:話術技能 <= 6
				PRINTFORML %CALLNAME:MASTER%의 화술 기능이 Lv7이 되었다!
				ABL:MASTER:話術技能 = 7
			ENDIF
		CASE IS >= 750
			IF ABL:MASTER:話術技能 <= 5
				PRINTFORML %CALLNAME:MASTER%의 화술 기능이 Lv6이 되었다!
				ABL:MASTER:話術技能 = 6
			ENDIF
		CASE IS >= 500
			IF ABL:MASTER:話術技能 <= 4
				PRINTFORML %CALLNAME:MASTER%의 화술 기능이 Lv5이 되었다!
				ABL:MASTER:話術技能 = 5
			ENDIF
		CASE IS >= 300
			IF ABL:MASTER:話術技能 <= 3
				PRINTFORML %CALLNAME:MASTER%의 화술 기능이 Lv4이 되었다!
				ABL:MASTER:話術技能 = 4
			ENDIF
		CASE IS >= 100
			IF ABL:MASTER:話術技能 <= 2
				PRINTFORML %CALLNAME:MASTER%의 화술 기능이 Lv3이 되었다!
				ABL:MASTER:話術技能 = 3
			ENDIF
		CASE IS >= 30
			IF ABL:MASTER:話術技能 <= 1
				PRINTFORML %CALLNAME:MASTER%의 화술 기능이 Lv2이 되었다!
				ABL:MASTER:話術技能 = 2
			ENDIF
		CASE IS >= 5
			IF ABL:MASTER:話術技能 <= 0
				PRINTFORML %CALLNAME:MASTER%의 화술 기능이 Lv1이 되었다!
				ABL:MASTER:話術技能 = 1
			ENDIF
	ENDSELECT
	SELECTCASE EXP:MASTER:釣り経験
		CASE IS >= 1000
			IF ABL:MASTER:釣り技能 <= 9
				PRINTFORML %CALLNAME:MASTER%의 낚시 기능이 Lv10이 되었다!
				ABL:MASTER:釣り技能 = 10
			ENDIF
		CASE IS >= 800
			IF ABL:MASTER:釣り技能 <= 8
				PRINTFORML %CALLNAME:MASTER%의 낚시 기능이 Lv9이 되었다!
				ABL:MASTER:釣り技能 = 9
			ENDIF
		CASE IS >= 650
			IF ABL:MASTER:釣り技能 <= 7
				PRINTFORML %CALLNAME:MASTER%의 낚시 기능이 Lv8이 되었다!
				ABL:MASTER:釣り技能 = 8
			ENDIF
		CASE IS >= 500
			IF ABL:MASTER:釣り技能 <= 6
				PRINTFORML %CALLNAME:MASTER%의 낚시 기능이 Lv7이 되었다!
				ABL:MASTER:釣り技能 = 7
			ENDIF
		CASE IS >= 350
			IF ABL:MASTER:釣り技能 <= 5
				PRINTFORML %CALLNAME:MASTER%의 낚시 기능이 Lv6이 되었다!
				ABL:MASTER:釣り技能 = 6
			ENDIF
		CASE IS >= 200
			IF ABL:MASTER:釣り技能 <= 4
				PRINTFORML %CALLNAME:MASTER%의 낚시 기술이 Lv5가 되었다!
				ABL:MASTER:釣り技能 = 5
			ENDIF
		CASE IS >= 100
			IF ABL:MASTER:釣り技能 <= 3
				PRINTFORML %CALLNAME:MASTER%의 낚시 기술이 Lv4가 되었다!
				ABL:MASTER:釣り技能 = 4
			ENDIF
		CASE IS >= 50
			IF ABL:MASTER:釣り技能 <= 2
				PRINTFORML %CALLNAME:MASTER%의 낚시 기술이 Lv3이 되었다!
				ABL:MASTER:釣り技能 = 3
			ENDIF
		CASE IS >= 20
			IF ABL:MASTER:釣り技能 <= 1
				PRINTFORML %CALLNAME:MASTER%의 낚시 기술이 Lv2가 되었다!
				ABL:MASTER:釣り技能 = 2
			ENDIF
		CASE IS >= 5
			IF ABL:MASTER:釣り技能 <= 0
				PRINTFORML %CALLNAME:MASTER%의 낚시 기술이 Lv1이 되었다!
				ABL:MASTER:釣り技能 = 1
			ENDIF
	ENDSELECT
ENDIF
;マッサージ
SELECTCASE EXP:ARG:マッサージ施術経験
	CASE IS >= 1000
		IF ABL:ARG:マッサージ技能 <= 4
			PRINTFORML %CALLNAME:ARG%의 마사지 기술이 Lv5가 되었다!
			ABL:ARG:マッサージ技能 = 5
		ENDIF
	CASE IS >= 650
		IF ABL:ARG:マッサージ技能 <= 3
			PRINTFORML %CALLNAME:ARG%의 마사지 기술이 Lv4가 되었다!
			ABL:ARG:マッサージ技能 = 4
		ENDIF
	CASE IS >= 350
		IF ABL:ARG:マッサージ技能 <= 2
			PRINTFORML %CALLNAME:ARG%의 마사지 기술이 Lv3이 되었다!
			ABL:ARG:マッサージ技能 = 3
		ENDIF
	CASE IS >= 100
		IF ABL:ARG:マッサージ技能 <= 1
			PRINTFORML %CALLNAME:ARG%의 마사지 기술이 Lv2가 되었다!
			ABL:ARG:マッサージ技能 = 2
		ENDIF
	CASE IS >= 20
		IF ABL:ARG:マッサージ技能 <= 0
			PRINTFORML %CALLNAME:ARG%의 마사지 기술이 Lv1이 되었다!
			ABL:ARG:マッサージ技能 = 1
		ENDIF
ENDSELECT



;ここから知識系素質
FOR LOCAL, 1, 100
	;知識マイナスの場合は通常成長しない
	SIF 知識素質:ARG:LOCAL < 0
		CONTINUE
	LOCAL:1 = POWER(10, 知識素質:ARG:LOCAL) * 100
	IF 知識素質:ARG:(LOCAL + 100) >= LOCAL:1
		知識素質:ARG:LOCAL += 1
		PRINTFORMW %CALLNAME:ARG%은(는) [%ERDNAME(知識素質, LOCAL)%Lv{知識素質:ARG:LOCAL}]를 습득했다!
		;知識成長口上
		TRYCALLFORM KOJO_SKILLUP_知識素質_{NO:ARG}(ARG, LOCAL)
		;経験値を0に戻す
		知識素質:ARG:(LOCAL + 100) = 0
	ENDIF
NEXT

;買春経験が10を超えた場合
IF EXP:PLAYER:買春経験 >= 10 && あなた特殊能力:ルピえっち交渉術 < 1
	PRINTFORML 말을 거는 방법이나 싫어하지 않는 대화의 시작 방법, 원하는 말을 이끌어내는 기술…….
	PRINTFORMW 지금까지 수많은 직원에게 루피로 야한 짓을 시켜온 %CALLNAME:PLAYER%은, 이러한 협상에 익숙해졌다는 실감을 느낀다…….
	PRINTL
	PRINTFORM %CALLNAME:PLAYER%은(는)
	SETCOLOR カラーパレット("赤ピンク")
	PRINTFORM 루피 야한 협상술
	RESETCOLOR
	PRINTFORML 을(를) 익혔다!
	PRINTFORMW 이거라면 직원이 아니더라도, 루피로 야한 짓을 하게 해달라고 교섭할 수 있을지도 모른다!
	あなた特殊能力:ルピえっち交渉術 = 1
ENDIF

;ここからあなた特殊能力の成長処理
IF ARG == MASTER
	;ハーレム素質成長処理
	SELECTCASE あなた恋慕人数()
		CASE IS >= 10
			IF あなた特殊能力:ハーレム < 4
				DRAWLINE
				PRINTFORML %CALLNAME:MASTER%은(는) 하렘의 극의를 깨달았다!
				PRINTFORMW 능력[%GET_あなた特殊能力NAME(1, あなた特殊能力:ハーレム)%]이(가) 성장하여, [%GET_あなた特殊能力NAME(1, 4)%]에 눈떴다!
				あなた特殊能力:ハーレム = 4
			ENDIF
		CASE IS >= 5
			IF あなた特殊能力:ハーレム < 3
				DRAWLINE
				PRINTFORML %CALLNAME:MASTER%은(는) 하렘 관리에 숙달했다!
				PRINTFORMW 능력[%GET_あなた特殊能力NAME(1, あなた特殊能力:ハーレム)%]이(가) 성장하여, [%GET_あなた特殊能力NAME(1, 3)%]에 눈떴다!
				あなた特殊能力:ハーレム = 3
			ENDIF
		CASE IS >= 3
			IF あなた特殊能力:ハーレム < 2
				DRAWLINE
				PRINTFORML %CALLNAME:MASTER%은(는) 하렘의 요령을 터득했다!
				PRINTFORMW 능력[%GET_あなた特殊能力NAME(1, あなた特殊能力:ハーレム)%]이(가) 성장하여, [%GET_あなた特殊能力NAME(1, 2)%]에 눈떴다!
				あなた特殊能力:ハーレム = 2
			ENDIF
	ENDSELECT

	;遊び人素質成長処理
	SELECTCASE あなたセフレ人数()
		CASE IS >= 10
			IF あなた特殊能力:遊び人 < 4
				DRAWLINE
				PRINTFORML %CALLNAME:MASTER%은(는) 밤놀이의 극의를 깨달았다!
				PRINTFORMW 능력[%GET_あなた特殊能力NAME(11, あなた特殊能力:遊び人)%]이(가) 성장하여, [%GET_あなた特殊能力NAME(11, 4)%]에 눈떴다!
				あなた特殊能力:遊び人 = 4
			ENDIF
		CASE IS >= 5
			IF あなた特殊能力:遊び人 < 3
				DRAWLINE
				PRINTFORML %CALLNAME:MASTER%은(는) 밤놀이에 숙달했다!
				PRINTFORMW 능력[%GET_あなた特殊能力NAME(11, あなた特殊能力:遊び人)%]이(가) 성장하여, [%GET_あなた特殊能力NAME(11, 3)%]에 눈떴다!
				あなた特殊能力:遊び人 = 3
			ENDIF
		CASE IS >= 3
			IF あなた特殊能力:遊び人 < 2
				DRAWLINE
				PRINTFORML %CALLNAME:MASTER%은(는) 밤놀이의 요령을 터득했다!
				PRINTFORMW 능력[%GET_あなた特殊能力NAME(11, あなた特殊能力:遊び人)%]이(가) 성장하여, [%GET_あなた特殊能力NAME(11, 2)%]에 눈떴다!
				あなた特殊能力:遊び人 = 2
			ENDIF
	ENDSELECT

	;触手技能成長処理
	IF EXP:MASTER:触手操作経験 > 5000 && あなた特殊能力:触手変化術 < 5
		DRAWLINE
		PRINTFORML %CALLNAME:MASTER%은(는) 촉수 다루기를 통달했다!
		PRINTW 촉수 변화술의 레벨이 5로 상승했다!
		あなた特殊能力:触手変化術 = 5
	ELSEIF EXP:MASTER:触手操作経験 > 2500 && あなた特殊能力:触手変化術 < 4
		DRAWLINE
		PRINTFORML %CALLNAME:MASTER%은(는) 촉수 다루기에 숙달했다!
		PRINTW 촉수 변화술의 레벨이 4로 상승했다!
		あなた特殊能力:触手変化術 = 4
	ELSEIF EXP:MASTER:触手操作経験 > 1000 && あなた特殊能力:触手変化術 < 3
		DRAWLINE
		PRINTFORML %CALLNAME:MASTER%은(는) 촉수 다루기에 자신감을 가질 수 있게 되었다!
		PRINTW 촉수 변화술의 레벨이 3으로 상승했다!
		あなた特殊能力:触手変化術 = 3
	ELSEIF EXP:MASTER:触手操作経験 > 300 && あなた特殊能力:触手変化術 < 2
		DRAWLINE
		PRINTFORML %CALLNAME:MASTER%은(는) 촉수 다루기의 요령을 터득했다!
		PRINTW 촉수 변화술의 레벨이 2로 상승했다!
		あなた特殊能力:触手変化術 = 2
	ENDIF

	;ギャンブラー成長
	IF EXP:PLAYER:ギャンブル経験 > 50 && あなた特殊能力:ギャンブラー < 2
		DRAWLINE
		PRINTFORML %CALLNAME:MASTER%은(는) 도박사의 분위기를 터득했다!
		PRINTFORMW 능력[%GET_あなた特殊能力NAME(2, あなた特殊能力:ギャンブラー)%]이 성장하여, 능력[%GET_あなた特殊能力NAME(2, 2)%]에 눈떴다!
		あなた特殊能力:ギャンブラー = 2
	ENDIF
ENDIF


@性知識段階表示(ARG, ARG:1, ツールチップフラグ = 0)
#FUNCTIONS
#DIM ツールチップフラグ
;ARGは性知識レベル、ARG:1はキャラ番号
;普段キャラ番号は使わないが、耳年増算出のために引っ張ってくる

SELECTCASE ARG
	CASE -2
		IF ツールチップフラグ
			RETURNF "<br>知識レベル：マイナス<br>性行為そのものを知らない、理解していない状態。いわゆる無知シチュ。<br>特別な手段を用いない限り、レベルは上昇しない。<br>"
		ENDIF
		RETURNF "無知"
	CASE -1
		IF ツールチップフラグ
			RETURNF "<br>知識レベル：マイナス<br>性行為＝交尾のような認識をもつ状態。恋愛などは存在は知っていても、理解はしていない。<br>特別な手段を用いない限り、レベルは上昇しない。<br>"
		ENDIF
		RETURNF "獣並み"
	CASE 0
		IF ARG:1 > 0 && TALENT:(ARG:1):性的興味 > 0
			IF ツールチップフラグ
				RETURNF "<br>知識レベル：０<br>性的興味が強く、聞きかじりの知識は多いが正確な知識は少ない。<br>"
			ENDIF
			RETURNF "耳年増"
		ELSE
			IF ツールチップフラグ
				RETURNF "<br>知識レベル：０<br>性的な知識が少なく、経験も乏しい状態。<br>処女、あるいは未成年者などが多く該当する。<br>"
			ENDIF
			RETURNF "疎い"
		ENDIF
	CASE 1
		IF ツールチップフラグ
			RETURNF "<br>知識レベル：１<br>正しく性知識があり、恋愛を楽しむ下地がある状態。<br>非処女、あるいは成人などが多く該当する。<br>"
		ENDIF
		RETURNF "必要十分"
	CASE 2
		IF ツールチップフラグ
			RETURNF "<br>知識レベル：２<br>マニアックな性知識にも精通しており、詳しく説明する能力がある状態。<br>"
		ENDIF
		RETURNF "有識者"
	CASE 3
		IF ツールチップフラグ
			RETURNF "<br>知識レベル：３<br>性について殆どのことを知り尽くしている状態。<br>"
		ENDIF
		RETURNF "百戦錬磨"
ENDSELECT


@自動学習処理(対象キャラ)
#DIM 対象キャラ
#DIM 入手経験値
#DIM 学習対象
#DIM 経験値保存
#DIM DYNAMIC ランダム配列, 100

学習対象 = 0
経験値保存 = 0

;業務の場合は指定されてるのでそれ読んで学習処理へ
IF 現在仕事:対象キャラ:0 == 7 && TCVAR:対象キャラ:休暇中 == 0
	学習対象 = 現在仕事:対象キャラ:1
	GOTO 学習処理
ENDIF

;何を学習するかを決定
FOR LOCAL, 1, 100
	SIF ERDNAME(知識素質, LOCAL) == ""
		BREAK
	;まずはLv1の知識を優先
	IF 知識素質:対象キャラ:LOCAL == 1 && 経験値保存 < 知識素質:対象キャラ:(LOCAL + 100)
		学習対象 = LOCAL
		経験値保存 = 知識素質:対象キャラ:(LOCAL + 100)
	ENDIF
NEXT
IF 経験値保存 == 0
	;Lv1がないならLv0を対象
	FOR LOCAL, 1, 100
		SIF ERDNAME(知識素質, LOCAL) == ""
			BREAK
		IF 経験値保存 < 知識素質:対象キャラ:(LOCAL + 100)
			学習対象 = LOCAL
			経験値保存 = 知識素質:対象キャラ:(LOCAL + 100)
		ENDIF
	NEXT
ENDIF
IF 経験値保存 == 0
	;ここまで来ても０ということは全部の知識が同条件なのでランダムで算出
	VARSET ランダム配列
	LOCAL:1 = 0
	FOR LOCAL, 1, 100
		SIF ERDNAME(知識素質, LOCAL) == ""
			BREAK
		;Lv2以上は対象にならない
		IF 知識素質:対象キャラ:LOCAL < 2
			ランダム配列:(LOCAL:1) = LOCAL
			LOCAL:1 ++
		ENDIF
	NEXT
	IF LOCAL:1 == 0
		;それでも対象がないということは知識全部２以上なので戻す
		RETURN 0
	ELSE
		学習対象 = ランダム配列:(RAND:(LOCAL:1))
	ENDIF
ENDIF

$学習処理
IF STRFIND(学校利用者:学習対象, @"_{対象キャラ}_") < 0 && STRFIND(学校利用者:学習対象, @"{対象キャラ}_") != 0
	学校利用者:学習対象 += @"{対象キャラ}_"
	学校利用者:0 = 表示
ENDIF
;学習対象が決定したら入手経験値を決定
;既存の知識が多いほど経験値が減る
LOCAL:1 = 0
FOR LOCAL, 1, 100
	SIF ERDNAME(知識素質, LOCAL) == ""
		BREAK
	;種類だけカウント
	IF 知識素質:対象キャラ:LOCAL
		LOCAL:1 ++
	ENDIF
NEXT

入手経験値 = MAX(1, 27 - (LOCAL:1 * 3 / 2))
SELECTCASE TALENT:対象キャラ:習得速度
	CASE -1
		入手経験値 -= 5
	CASE 1
		入手経験値 += 5
	CASE 2
		入手経験値 += 25
ENDSELECT
;教師がいる場合
IF 教師レベル保存:学習対象 > 0
	入手経験値 += 教師レベル保存:学習対象
ENDIF

知識素質:対象キャラ:(学習対象 + 100) += MAX(1, 入手経験値)
