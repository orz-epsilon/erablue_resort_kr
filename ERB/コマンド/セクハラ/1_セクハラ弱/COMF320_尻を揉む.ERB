
@COMNAME320
#FUNCTIONS
IF 月算出() == "冬の月" && ITEM:おこた != 0 && GETPLACENAME(CFLAG:MASTER:現在マップ種別, CFLAG:MASTER:現在位置) == "和室" && CFLAG:TARGET:睡眠
	TSTR:コマンド名受渡 = 몰래 엉덩이를 만지다
ELSE
	TSTR:コマンド名受渡 = 엉덩이를 주무르다
ENDIF

;===================================================
;コマンドタイプ
;===================================================
@COMTYPE_320
#FUNCTION
TFLAG:コマンドタイプ受渡 = COMTYPE("セクハラ")
弱点コマンドカテゴリ = A
睡眠中許可 = 1

@COM_TOOLTIP_320
LOCALS = <br>■엉덩이를 주무르다<br>
LOCALS += "상대의 엉덩이를 마음껏 주무르는 커맨드.<br>대상이 하반신 뒤쪽에 갑옷을 입고 있는 경우는 실행 불가.<br>데려가기 가능 시, 모드화하여 동행 상태가 된다."
LOCALS += "<br>COM 타입: 성희롱<br>획득 소스: 접촉・노출・쾌락A・환락(일정 조건 시)・불쾌(일정 조건 시)・반감(일정 조건 시)"
LOCALS += "<br>고유 획득 경험: 없음<br>"
TSTR:ツールチップ受渡 = %LOCALS%

@COM320
#DIM 同行数
;尻を揉む



SIF 同性愛性癖判定(PLAYER,TARGET)
	EXP:PLAYER:同性愛経験 += 1

;発生する快楽は受け手の状態に依存しない
CALL SOURCE_CALC_快Ａ(TARGET, PLAYER, 50)
SIF TALENT:PLAYER:器用な指
	CALL SOURCE_CALC_快Ａ(TARGET, PLAYER, 30)

TIME += 10

CALL ヒップ変動処理(TARGET, "愛撫", 1)

SIF CFLAG:TARGET:睡眠
	RETURN 1

SIF 同性愛性癖判定(TARGET,PLAYER)
	EXP:TARGET:同性愛経験 += 1

CALL セクハラ反応タイプ判定(TARGET)
;RFLAG:コマンド結果受渡し変数
;1:拒絶  2:受け入れ  3:喜び
;RFLAG:コマンド結果受渡し変数２
;1:無知  2:無反応  3:嫌悪  4:拒否  5:余裕  6:羞恥  7:愉悦  8:汎用

SELECTCASE RFLAG:コマンド結果受渡し変数２
	CASE 1
		;無知
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1 TO 2
				;拒絶と受け入れに違い無し
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 50)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
			CASE 3
				;喜び時は喜ぶ
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 150)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 10)
		ENDSELECT
	CASE 2
		;無反応
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1 TO 2
				;拒絶と受け入れ時は反応なし
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
			CASE 3
				;喜び時はちょっと喜ぶ
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 50)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 10)
		ENDSELECT
	CASE 3
		;嫌悪
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;拒絶
				CALL SOURCE_CALC_不快(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_反感(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
			CASE 2
				;受け入れ
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 10)
			CASE 3
				;喜び
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 150)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 100)
		ENDSELECT
	CASE 4
		;拒否
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;拒絶
				CALL SOURCE_CALC_不快(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_反感(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
			CASE 2
				;受け入れ
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 100)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 10)
			CASE 3
				;喜び
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 100)
		ENDSELECT
	CASE 5
		;余裕
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;拒絶
				CALL SOURCE_CALC_不快(TARGET, PLAYER, 50)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
			CASE 2
				;受け入れ
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 100)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 20)
			CASE 3
				;喜び
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 100)
		ENDSELECT
	CASE 6
		;羞恥
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;拒絶
				CALL SOURCE_CALC_不快(TARGET, PLAYER, 100)
				CALL SOURCE_CALC_反感(TARGET, PLAYER, 100)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
			CASE 2
				;受け入れ
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 50)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 20)
			CASE 3
				;喜び
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 150)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 120)
		ENDSELECT
	CASE 7
		;愉悦
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;拒絶
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 50)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
			CASE 2
				;受け入れ
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 100)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 30)
			CASE 3
				;喜び
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 100)
		ENDSELECT
	CASE 8
		;汎用
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;拒絶
				CALL SOURCE_CALC_不快(TARGET, PLAYER, 100)
				CALL SOURCE_CALC_反感(TARGET, PLAYER, 100)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
			CASE 2
				;受け入れ
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 50)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 10)
			CASE 3
				;喜び
				CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 150)
				CALL SOURCE_CALC_接触(TARGET, PLAYER, 200)
				CALL SOURCE_CALC_露出(TARGET, PLAYER, 250)
				CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 100)
		ENDSELECT
ENDSELECT

;同行が二人未満なら同行化
IF !CFLAG:TARGET:睡眠 && (CFLAG:TARGET:デート == 0 || CFLAG:TARGET:デート == PLAYER + 100)
	同行数 = 0
	FOR LOCAL,1,CHARANUM
		SIF TARGET:LOCAL < 1
			BREAK
		IF CFLAG:(TARGET:LOCAL):同行 
			同行数 ++
		ENDIF
	NEXT
	IF 同行数 < 2
		CALL MODE_CHANGE("尻揉み", PLAYER, TARGET)
		CFLAG:TARGET:同行 = 60 + (CFLAG:好感度レベル - 関係閾値:2) * 5
		RFLAG:コマンド結果受渡し変数３ = 1
	ENDIF
ENDIF

RETURN 1

;-------------------------------------------------
;実行判定
;-------------------------------------------------
@COM_ABLE320
;尻を揉む実行判定
SIF SAVESTR:ゲームフェイズ管理 != "通常モード"
	RETURN 0
;一括管理
SIF GLOBAL_COMABLE(320) && !RFLAG:罰ゲーム中
	RETURN RESULT
SIF TEQUIP:下腹部後鎧あり
	RETURN 0
;TARGETの好感度レベル
SIF CFLAG:好感度レベル < 1 + 関係閾値:2
	RETURN 0
RETURN 1

;-------------------------------------------------
;実行時メッセージ
;-------------------------------------------------
@MESSAGE_COM320

IF 月算出() == "冬の月" && ITEM:おこた != 0 && GETPLACENAME(CFLAG:MASTER:現在マップ種別, CFLAG:MASTER:現在位置) == "和室" && CFLAG:TARGET:睡眠
	PRINTFORML %CALLNAME:PLAYER%은(는) %TEXTR("새근새근 잠꼬대를 하는/코타츠에서 잠들어 버린")%%CALLNAME:TARGET%의 %TEXTR("무방비한/")%등 뒤로 몰래 손을 뻗어,
	IF TALENT:種族 == 4
		PRINTFORM 조그마한
	ELSEIF 固有素質チェック(TARGET, "筋肉質") && TALENT:性別 == 2
	;女の尻を筋肉質って表現すると微妙になっちゃう可能性を考えて一応男のみに。好きな人はいると思うけどね？念のため
		PRINTFORM %TEXTR("탄탄한/근육질의")%
	ELSEIF 固有素質チェック(TARGET, "アイドル", "スクールアイドル", "ショロトルの巫女")
		PRINTFORM 아이돌의
	ELSEIF 下半身体型(TARGET) >= 2
		PRINTFORM %TEXTR("탱탱한/말랑말랑한/살집 좋은")%
	ELSE
		PRINTFORM %TEXTR("무방비한/")%
	ENDIF
	PRINTFORML 엉덩이%TEXTR("를 주물렀다/의 감촉을 만끽했다")%
ELSEIF CFLAG:TARGET:睡眠
	PRINTFORML %CALLNAME:PLAYER%은(는) 새근새근 잠든 %CALLNAME:TARGET%의\@ TALENT:種族 == 4 ? 조그마한 # \@엉덩이에 손을 뻗어, 주물렀다
ELSE
	PRINTFORML %CALLNAME:PLAYER%은(는) 등 뒤에서 %CALLNAME:TARGET%의\@ TALENT:種族 == 4 ? 조그마한 # \@엉덩이에 손을 뻗어, 주물렀다
	IF CUP:TARGET:快Ａ > 1000
		;一定以上の快楽が発生した時にちょっと声が出る
		IF CFLAG:TARGET:睡眠
			PRINTFORML 뜻밖의 쾌락에, %CALLNAME:TARGET%은(는) 잠든 채 작게 신음했다…
		ELSE
			PRINTFORML 뜻밖의 쾌락에, %CALLNAME:TARGET%은(는) 무심코 작은 소리를 내고 말았다…
		ENDIF
		PRINTL
	ENDIF
ENDIF

IF RFLAG:コマンド結果受渡し変数３
	PRINTL 
	PRINTFORML %CALLNAME:PLAYER%은(는) 엉덩이를 잡은 채, %CALLNAME:TARGET%을(를) 데리고 다니기로 했다
ENDIF

@MESSAGE_COM320_非口上時

IF CFLAG:TARGET:睡眠
	PRINTFORML %CALLNAME:TARGET%은(는) 새근새근 잠들어 있다……
	RETURN 0
ENDIF

SELECTCASE RFLAG:コマンド結果受渡し変数２
	CASE 1
		;無知
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1 TO 2
				;拒絶と受け入れに違い無し
				PRINTFORML %CALLNAME:TARGET%은(는) 그런 일을 해서 즐거울까 하고 신기한 듯이 보고 있다…
			CASE 3
				;喜び時は喜ぶ
				PRINTFORML %CALLNAME:TARGET%은(는) 잘 모르겠지만, %CALLNAME:PLAYER%이(가) 즐겁다면 좋다고 기쁜 듯이 보고 있다
		ENDSELECT
	CASE 2
		;無反応
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1 TO 2
				;拒絶と受け入れ時は反応なし
				PRINTFORML %CALLNAME:TARGET%은(는) 아무런 반응도 보이지 않고, 태연하게 있다
			CASE 3
				;喜び時はちょっと喜ぶ
				PRINTFORML %CALLNAME:TARGET%은(는) 태연하게 있지만, 조금 얼굴을 붉히고 %CALLNAME:PLAYER%에게 몸을 비벼왔다…
		ENDSELECT
	CASE 3
		;嫌悪
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;拒絶
				PRINTFORML %CALLNAME:TARGET%은(는) 불쾌감을 드러낸 표정으로 %CALLNAME:PLAYER%을(를) 노려보고 있다…
			CASE 2
				;受け入れ
				PRINTFORML %CALLNAME:TARGET%은(는) 한숨을 쉬고, %CALLNAME:PLAYER%의 손을 뿌리쳤다
			CASE 3
				;喜び
				PRINTFORML %CALLNAME:TARGET%은(는) 어쩔 수 없는 사람이네, 라는 얼굴로 %CALLNAME:PLAYER%이(가) 하고 싶은 대로 내버려두고 있다…
		ENDSELECT
	CASE 4
		;拒否
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;拒絶
				PRINTFORML %CALLNAME:TARGET%은(는), 확실히 이런 일은 그만두었으면 좋겠다고 %CALLNAME:PLAYER%에게 말했다
			CASE 2
				;受け入れ
				PRINTFORML %CALLNAME:TARGET%은(는) 어이없다는 듯한 얼굴로 %CALLNAME:PLAYER%을(를) 보고 있다
			CASE 3
				;喜び
				PRINTFORML %CALLNAME:TARGET%은(는) 나쁘지 않은 기분인 듯, %CALLNAME:PLAYER%이(가) 하고 싶은 대로 내버려두고 있다…
		ENDSELECT
	CASE 5
		;余裕
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;拒絶
				PRINTFORML %CALLNAME:TARGET%은(는) %CALLNAME:PLAYER%을(를) 꾸짖으며, 이런 일은 해서는 안 된다고 타일렀다
			CASE 2
				;受け入れ
PRINTFORML %CALLNAME:TARGET%은(는) 곤란한 듯 웃으며, 말뿐인 주의를%CALLNAME:PLAYER%에게 하고 있다
			CASE 3
				;喜び
PRINTFORML %CALLNAME:TARGET%은(는)%CALLNAME:PLAYER%에게, 주위에 들키지 않도록 몰래 만지라고 말해왔다…
		ENDSELECT
	CASE 6
		;羞恥
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;拒絶
PRINTFORML %CALLNAME:TARGET%은(는) 새빨개져서, 눈물 어린 눈으로%CALLNAME:PLAYER%에게 항의의 시선을 보내고 있다…
			CASE 2
				;受け入れ
PRINTFORML %CALLNAME:TARGET%은(는) 쭈뼛쭈뼛 얼굴을 붉히면서, %CALLNAME:PLAYER%을(를) 멈추지 않고 시선을 피하고 있다
			CASE 3
				;喜び
PRINTFORML %CALLNAME:TARGET%은(는) 붉어진 얼굴로%CALLNAME:PLAYER%을(를) 바라보며, 살며시 몸을 기대왔다…
		ENDSELECT
	CASE 7
		;愉悦
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;拒絶
PRINTFORML %CALLNAME:TARGET%은(는) 재미있다는 듯 미소 지으며, %CALLNAME:PLAYER%의 만지는 방식이 서툴다고 지적해왔다
			CASE 2
				;受け入れ
PRINTFORML %CALLNAME:TARGET%은(는) 다른 곳도 만질 거냐며, 농담조로%CALLNAME:PLAYER%을(를) 놀리고 있다…
			CASE 3
				;喜び
PRINTFORML %CALLNAME:TARGET%은(는) 다른 곳도 만질 거냐며, 요염한 표정으로%CALLNAME:PLAYER%을(를) 도발하고 있다…
		ENDSELECT
	CASE 8
		;汎用
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;拒絶
PRINTFORML %CALLNAME:TARGET%은(는)%CALLNAME:PLAYER%의 성희롱을 싫어하고 있다…
			CASE 2
				;受け入れ
PRINTFORML %CALLNAME:TARGET%은(는)%CALLNAME:PLAYER%의 손길을 싫어하지 않고, 받아들이고 있다
			CASE 3
				;喜び
PRINTFORML %CALLNAME:TARGET%은(는)%CALLNAME:PLAYER%에게 만져지는 것을 조금 기쁘게 생각하는 것 같다…
		ENDSELECT
ENDSELECT

