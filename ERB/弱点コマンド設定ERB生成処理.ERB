;弱点コマンド口上設定を作るための処理
;コマンド番号とにらめっこするのがめんどいので作成

@弱点コマンド設定ERB生成処理()
#DIM CSV番号
#DIM 配列番号
#DIM 表示数
#DIM CSVページ数
#DIM 次ページフラグ
#DIM 表示配列, 3000

VARSET 表示配列
表示数 = 0
FOR CSV番号, 1, 3000
	SIF EXISTCSV(CSV番号) == 0
		CONTINUE
	SIF CSV番号 == 999
		CONTINUE
	表示配列:表示数 = CSV番号
	表示数 ++
NEXT

$処理部分

DRAWLINE
PRINTL 약점 커맨드 설정 ERB를 작성하는 에디터입니다.
PRINTL 대상 캐릭터를 선택해주세요.
DRAWLINE

表示数 = 0
次ページフラグ = 0
FOR 配列番号, CSVページ数 * 30, CSVページ数 * 30 + 30
	SIF 表示配列:配列番号 < 1
		CONTINUE
	PRINTBUTTON @"[{表示配列:配列番号, 4}] %CSVNAME(表示配列:配列番号),41,LEFT%", 表示配列:配列番号
	表示数 ++
	SIF 表示数 % 2 == 0
		PRINTL
NEXT
SIF 表示数 % 2
	PRINTL
DRAWLINE
IF CSVページ数 > 0
	PRINTBUTTONLC "[9997] 이전 페이지로", 9997
ELSE
	PRINTLC 　
ENDIF
IF CSVページ数 * 30 + 30 < 3000 && 表示配列:(CSVページ数 * 30 + 30) > 0
	PRINTBUTTONLC "[9998] 다음 페이지로", 9998
ENDIF
PRINTL
PRINTBUTTONLC "[9999] 돌아가기", 9999
PRINTL

BINPUT
LOCAL = RESULT
SELECTCASE RESULT
	CASE 9997
		CSVページ数 --
		GOTO 処理部分
	CASE 9998
		CSVページ数 ++
		GOTO 処理部分
	CASE 9999
		RETURN -1
	CASEELSE
		ADDCHARA 0
		ADDCHARA LOCAL
		CALL 弱点ERB生成_実処理(1)
		DELALLCHARA
		RESTART
ENDSELECT


@弱点ERB生成_実処理(対象キャラ)
#DIM 対象キャラ
#DIM コマンド番号
#DIM 派生番号
#DIM ページ数
#DIMS 表示配列, 3000
#DIMS 弱点配列, 50
#DIM 表示数

VARSET 表示配列
VARSET 弱点配列
表示数 = 0
FOR コマンド番号, 0, 3000
	SIF EXISTFUNCTION(@"COMTYPE_{コマンド番号}") <= 0
		CONTINUE
	TFLAG:コマンドタイプ受渡 = 0
	CALLFORMF COMTYPE_{コマンド番号}
	SELECTCASE TFLAG:コマンドタイプ受渡
		CASE 1, 2, 3, 5, 6, 7, 8, 9, 12, 15, 16, 17
			表示配列:表示数 = {コマンド番号}
			表示数 ++
		CASE 100, 101
			IF STRFIND(TSTR:複合コマンドタイプ受け渡し, "セクハラ") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "うふふ") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "Ｖ系") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し,"Ａ系") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "道具系") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "特殊プレイ") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "触手系") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "全裸散歩") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "奉仕") >= 0
				表示配列:表示数 = {コマンド番号}
				表示数 ++
			ENDIF
	ENDSELECT
	FOR 派生番号, 1, 50
		SIF EXISTFUNCTION(@"COMTYPE_S_{コマンド番号}_{派生番号}") <= 0
			CONTINUE
		TFLAG:コマンドタイプ受渡 = 0
		CALLFORMF COMTYPE_S_{コマンド番号}_{派生番号}
		SELECTCASE TFLAG:コマンドタイプ受渡
			CASE 1, 2, 3, 5, 6, 7, 8, 9, 12, 15, 16, 17
				表示配列:表示数 = {コマンド番号}_{派生番号}
				表示数 ++
			CASE 100, 101
				IF STRFIND(TSTR:複合コマンドタイプ受け渡し, "セクハラ") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "うふふ") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "Ｖ系") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し,"Ａ系") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "道具系") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "特殊プレイ") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "触手系") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "全裸散歩") >= 0 || STRFIND(TSTR:複合コマンドタイプ受け渡し, "奉仕") >= 0
					表示配列:表示数 = {コマンド番号}_{派生番号}
					表示数 ++
				ENDIF
		ENDSELECT
	NEXT
NEXT

$表示処理

DRAWLINE
PRINTFORML %NAME表示(対象キャラ)%의 약체 설정 ERB를 작성합니다.
PRINTL 약점으로 만들고 싶은 커맨드를 선택해주세요.
DRAWLINE

表示数 = 0
FOR コマンド番号, ページ数 * 80, ページ数 * 80 + 80
	SIF 表示配列:コマンド番号 == ""
		CONTINUE
	TSTR:コマンド名受渡 = 
	IF ISNUMERIC(表示配列:コマンド番号)
		CALLFORMF COMNAME%表示配列:コマンド番号%
	ELSE
		CALLFORMF COMNAME_S%表示配列:コマンド番号%
	ENDIF
	IF TSTR:コマンド名受渡 != ""
		SIF MATCH(弱点配列, 表示配列:コマンド番号)
			SETCOLOR カラーパレット("黄")
		PRINTBUTTONLC @"[%表示配列:コマンド番号, 5%] %TSTR:コマンド名受渡%", 表示配列:コマンド番号
		RESETCOLOR
		表示数 ++
		SIF 表示数 % 4 == 0
			PRINTL
	ENDIF
NEXT
SIF 表示数 % 4
	PRINTL
DRAWLINE
IF ページ数 > 0
	PRINTBUTTONLC "[9997] 이전 페이지로", 9997
ELSE
	PRINTLC 　
ENDIF
IF 表示配列:(ページ数 * 80 + 80) != ""
	PRINTBUTTONLC "[9998] 다음 페이지로", 9998
ENDIF
PRINTL 
PRINTL 
PRINTBUTTONLC "[9999] 돌아가기", 9999
PRINTBUTTONLC "[9996] 이 설정으로 ERB를 생성합니다.", 9996


BINPUTS
LOCALS = %RESULTS%
SELECTCASE LOCALS
	CASE "9997"
		ページ数 --
	CASE "9998"
		ページ数 ++
	CASE "9999"
		RETURN 0
	CASE "9996"
		;ERBファイル生成
		CLEARLINE LINECOUNT
		;記述データPRINT
		PRINTFORML @약점 커맨드 변경_{NO:対象キャラ}
		PRINTL ;각 변수에 커맨드 번호를 넣을 것
		PRINTL ;파생 커맨드나 전용 커맨드는 「370_1」처럼 기술할 것
		PRINTL 
		PRINTL ;여기서 지정하지 않은 칸은 랜덤으로 채워진다
		PRINTL ;랜덤으로 채울 경우, 칸 0・1은 성희롱 커맨드, 2・3은 우후후 커맨드, 4는 완전 랜덤으로 선택된다
		PRINTFORML LOCAL = GETCHARA({NO:対象キャラ})
		PRINTL 
		FOR LOCAL, 0, 50
			IF 弱点配列:LOCAL != ""
				PRINTFORML 약점 커맨드 칸:LOCAL:{LOCAL} = %弱点配列:LOCAL%
			ENDIF
		NEXT
		PRINTL

		OUTPUTLOG @"ERB_EDITFILE/%CALLNAME:対象キャラ%_パラメータ設定.ERB", 1
		CLEARLINE LINECOUNT

		PRINTL ERB_EDITFILE에 약점 설정용 ERB를 기록했습니다. ERB 폴더로 이동하여 재시작하십시오.
		PRINTW 기존의 약점 설정 구상이 있는 경우, 제대로 작동하지 않을 수 있으므로 주의하십시오.
		RETURN 0
	CASEELSE
		IF MATCH(弱点配列, LOCALS)
			ARRAYREMOVE 弱点配列, FINDELEMENT(弱点配列, LOCALS, , , 1), 1
		ELSE
			LOCAL:1 = 0
			FOR LOCAL, 0, VARSIZE("弱点配列")
				IF 弱点配列:LOCAL == ""
					弱点配列:LOCAL = %LOCALS%
					LOCAL:1 = 1
					BREAK
				ENDIF
			NEXT
			IF LOCAL:1 == 0
				PRINTW 약점 칸에 빈 공간이 없습니다
			ENDIF
		ENDIF
ENDSELECT

GOTO 表示処理
