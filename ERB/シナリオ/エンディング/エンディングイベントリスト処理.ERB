
@エンディングイベントリスト(クリア済み視聴)
#DIM 表示用リスト, 200
#DIMS NEWフラグ用リスト, 100
#DIM 表示候補数
#DIM 配列番号
#DIM 表示キー
#DIM 周回フラグ
#DIM クリア済み視聴
#DIM 表示カテゴリ
#DIMS CONST エンドカテゴリ = "" ,"MA", "CH", "EX", "GE"
#DIM DYNAMIC 初回起動
VARSET LOCAL
VARSET LOCALS
VARSET NEWフラグ用リスト

FLAG:クリア済み視聴フラグ = クリア済み視聴
IF 初回起動 == 0
	;存在するエンディングをソートして突っ込む
	表示候補数 = DT_ROW_LENGTH("エンディング用変数配列")
	DT_SELECT "エンディング用変数配列", "", "ソート値 ASC", 表示用リスト
	表示カテゴリ = 0
	表示キー = -1
	初回起動 = 1
ENDIF

SPLIT TSTR:NEWイベントフラグ, "_", NEWフラグ用リスト

DRAWLINE
IF FLAG:クリア済み視聴フラグ
	PRINTL 다시 시청할 클리어한 엔딩 이벤트를 선택해 주세요.
	PRINTL ※기본적으로 다시 시청할 때는 보상 등을 얻을 수 없습니다. 이벤트 중에 「◯◯을(를) 입수했다」고 나와도 얻을 수 없습니다.
	PRINTL ※다시 시청할 때는 엔딩 처리가 되지 않습니다. 강하게 뉴 게임의 조건도 충족하지 않습니다.
ELSE
	PRINTL 시작할 이벤트를 선택해 주세요.
ENDIF
DRAWLINE
PRINT 표시 카테고리:
SIF 表示カテゴリ == 0
	SETCOLOR カラーパレット("黄")
PRINTBUTTON "[ALL]", 10001
RESETCOLOR
PRINT  / 
SIF 表示カテゴリ == 1
	SETCOLOR カラーパレット("黄")
PRINTBUTTON "[MA]", 10002
RESETCOLOR
PRINT  / 
SIF 表示カテゴリ == 2
	SETCOLOR カラーパレット("黄")
PRINTBUTTON "[CH]", 10003
RESETCOLOR
PRINT  / 
SIF 表示カテゴリ == 3
	SETCOLOR カラーパレット("黄")
PRINTBUTTON "[EX]", 10004
RESETCOLOR
PRINT  / 
SIF 表示カテゴリ == 4
	SETCOLOR カラーパレット("黄")
PRINTBUTTON "[GE]", 10005
RESETCOLOR
PRINTL 
DRAWLINE
IF FLAG:クリア済み視聴フラグ
	FOR LOCAL, 0, 表示候補数
		TSTR:コマンド名受渡 = 
		CALLFORM イベント関数_エンディングイベント_%DT_CELL_GETS("エンディング用変数配列", 表示用リスト:LOCAL, "イベント名", 1)%("設定取得", 表示用リスト:LOCAL)
		IF 表示カテゴリ
			SIF STRFIND(TSTR:コマンド名受渡, エンドカテゴリ:表示カテゴリ) < 0
				CONTINUE
		ENDIF
		IF DT_CELL_GET("エンディング用変数配列", 表示用リスト:LOCAL, "イベント完了フラグ", 1) == 1
			IF 表示キー == LOCAL
				LOCALS:1 += @"<font color='#%カラーパレット_HTML("黄")%'><button value='{LOCAL}'>[{LOCAL}]%TSTR:コマンド名受渡% %DT_CELL_GETS("エンディング用変数配列", 表示用リスト:LOCAL, "イベント名", 1)%</button></font><br>"
			ELSE
				LOCALS:1 += @"<button value='{LOCAL}'>[{LOCAL}]%TSTR:コマンド名受渡% %DT_CELL_GETS("エンディング用変数配列", 表示用リスト:LOCAL, "イベント名", 1)%</button><br>"
			ENDIF
		ELSE
			LOCALS:1 += @"<font color='#%カラーパレット_HTML("グレーアウト")%'><nonbutton>[{LOCAL}]%TSTR:コマンド名受渡% ?????</nonbutton></font><br>"
		ENDIF
	NEXT
ELSE
	IF FLAG:エンディング後フラグ
		LOCALS:1 += "엔딩 도달 완료"
	ELSE
		FOR LOCAL, 0, 表示候補数
			SIF DT_CELL_GET("エンディング用変数配列", 表示用リスト:LOCAL, "イベント発生フラグ", 1) == 0
				CONTINUE
			TSTR:コマンド名受渡 = 
			CALLFORM イベント関数_エンディングイベント_%DT_CELL_GETS("エンディング用変数配列", 表示用リスト:LOCAL, "イベント名", 1)%("設定取得", 表示用リスト:LOCAL)
			IF 表示カテゴリ
				SIF STRFIND(TSTR:コマンド名受渡, エンドカテゴリ:表示カテゴリ) < 0
					CONTINUE
			ENDIF
			LOCALS:10 = 
			LOCALS:11 = 
			IF DT_CELL_GET("エンディング用変数配列", 表示用リスト:LOCAL, "イベント完了フラグ", 1) == 1
				LOCALS:11 += "　시청 완료"
			ELSEIF MATCH(NEWフラグ用リスト, @"ENDHING%TOSTR(表示用リスト:LOCAL)%")
				LOCALS:10 += @"<font color='#%カラーパレット_HTML("黄")%'>"
				LOCALS:11 += @"</font><font color='#FF5555'> NEW!!</font>"
			ENDIF
			IF 表示キー == LOCAL
				LOCALS:1 += @"<font color='#%カラーパレット_HTML("黄")%'><button value='{LOCAL}'>[{LOCAL}]%TSTR:コマンド名受渡% %DT_CELL_GETS("エンディング用変数配列", 表示用リスト:LOCAL, "イベント名", 1)%</button>%LOCALS:11%</font><br>"
			ELSE
				LOCALS:1 += @"%LOCALS:10%<button value='{LOCAL}'>[{LOCAL}]%TSTR:コマンド名受渡% %DT_CELL_GETS("エンディング用変数配列", 表示用リスト:LOCAL, "イベント名", 1)%</button>%LOCALS:11%<br>"
			ENDIF
		NEXT
	ENDIF
ENDIF

LOCALS = <div rect='81,31,1937,2812' border='31' bcolor='#C0C0C0'></div><div rect='156,156,1837,2712'><nobr>%LOCALS:1%</nobr></div>
LOCALS += "<div width='1050' height='125' xpos='337' ypos='0' color='#101010'>엔딩 이벤트</div>"
LOCALS += "<div rect='2081,31,3937,2812' border='31' bcolor='#C0C0C0' padding='50,25,50'>"
IF FLAG:エンディング後フラグ && !FLAG:クリア済み視聴フラグ
	LOCALS += "이번 회차에서는 이미 엔딩에 도달했습니다。<br>"
	LOCALS += "다른 결말을 원할 경우, 「강하게 NEWGAME」에서 회차를 진행해 주세요。<br>"
ELSEIF 表示キー == -1
	LOCALS += "왼쪽 목록에서 원하는 엔딩을 선택해 주세요。<br>"
	LOCALS += "이 칸에는 엔딩의 상세 내용과, 엔딩을 시청할지 여부의 확인 버튼이 표시됩니다。<br>"
ELSE
	CALLFORM イベント関数_エンディングイベント_%DT_CELL_GETS("エンディング用変数配列", 表示用リスト:表示キー, "イベント名", 1)%("設定取得", 表示用リスト:表示キー)
	LOCALS += TSTR:ツールチップ受渡
	LOCALS += "<br>"
	IF FLAG:クリア済み視聴フラグ
		LOCALS += "<button value='10000'>[10000]이 엔딩을 다시 시청하기</button><br>"
	ELSE
		RESULT = 0
		CALLFORM イベント関数_エンディングイベント_%DT_CELL_GETS("エンディング用変数配列", 表示用リスト:表示キー, "イベント名", 1)%("実行条件", 表示用リスト:表示キー)
		IF RESULT
			LOCALS += "<button value='10000'>[10000]이 엔딩으로 결정한다</button><br>"
		ELSE
			LOCALS += @"<font color='#%カラーパレット_HTML("グレーアウト")%'>[10000]이 엔딩으로 결정한다　　※실행 조건 미달</font><br>"
		ENDIF
	ENDIF
ENDIF
LOCALS += "</div>"

HTML_PRINT LOCALS

FOR LOCAL, 0, 25
	PRINTL
NEXT
PRINTBUTTON "[9997]시스템 설명", 9997
PRINTL
PRINTBUTTON "[9999]돌아가기", 9999
PRINTL

IF チュートリアルフラグ:エンディングリスト == 0
	LOCAL = 9997
ELSE
	BINPUT
	LOCAL = RESULT
ENDIF
SELECTCASE LOCAL
	CASE 10001 TO 100005
		表示カテゴリ = LOCAL - 10001
		表示キー = -1
		RESTART
	CASE IS < 表示候補数
		IF MATCH(NEWフラグ用リスト, @"ENDHING%TOSTR(表示用リスト:LOCAL)%")
			REPLACE TSTR:NEWイベントフラグ, @"ENDHING%TOSTR(表示用リスト:LOCAL)%_", ""
			TSTR:NEWイベントフラグ = %RESULTS%
		ENDIF
		表示キー = LOCAL
		RESTART
	CASE 9997
		CALL エンディングリストチュートリアル()
		RESTART
	CASE 9999
		FLAG:クリア済み視聴フラグ = 0
		表示カテゴリ = 0
		表示キー = -1
		RETURN 0
	CASE 10000
		DRAWLINE
		IF !FLAG:クリア済み視聴フラグ
			PRINTFORML 『%DT_CELL_GETS("エンディング用変数配列", 表示用リスト:表示キー, "イベント名", 1)%』의 엔딩을 맞이합니다.
			PRINTL 괜찮습니까?
			PRINTBUTTONLC "[0] 예", 0
			PRINTBUTTONLC "[1] 아니요", 1
			PRINTL
			BINPUT
			SIF RESULT != 0
				RESTART
		ENDIF
		CALLFORM イベント関数_エンディングイベント_%DT_CELL_GETS("エンディング用変数配列", 表示用リスト:表示キー, "イベント名", 1)%("実処理", 表示用リスト:表示キー)
		IF !FLAG:クリア済み視聴フラグ
			周回フラグ = RESULT
			FLAG:エンディング後フラグ = 1
			CALLFORM イベント関数_エンディングイベント_%DT_CELL_GETS("エンディング用変数配列", 表示用リスト:表示キー, "イベント名", 1)%("設定取得", 表示用リスト:表示キー)
			STR:エンド後_エンディング番号 '= TSTR:コマンド名受渡
			DT_CELL_SET "エンディング用変数配列", 表示用リスト:表示キー, "イベント完了フラグ", 1, 1
			
			IF 周回フラグ
				CALL 周回引き継ぎ処理(1)
				RETURN -1
			ENDIF
		ENDIF
ENDSELECT

@エンディングイベント完了フラグ汎用処理(ARGS)
#DIM 行番号

SIF FLAG:クリア済み視聴フラグ
	RETURN 0

FOR LOCAL, 0, DT_ROW_LENGTH("エンディング用変数配列")
	LOCALS = %DT_CELL_GETS("エンディング用変数配列", LOCAL, "イベント名")%
	IF LOCALS == ARGS
		行番号 = LOCAL
		BREAK
	ENDIF
NEXT
DT_CELL_SET "エンディング用変数配列", 行番号, "イベント完了フラグ", 1


@エンディングイベント完了フラグ確認(ARGS)
#FUNCTION
#DIM 行番号
VARSET LOCAL

FOR LOCAL, 0, DT_ROW_LENGTH("エンディング用変数配列")
	LOCALS = %DT_CELL_GETS("エンディング用変数配列", LOCAL, "イベント名")%
	IF LOCALS == ARGS
		行番号 = LOCAL
		LOCAL:1 = 1
		BREAK
	ENDIF
NEXT
IF LOCAL:1
	RETURNF DT_CELL_GET("エンディング用変数配列", 行番号, "イベント完了フラグ")
ELSE
	RETURNF -1
ENDIF



