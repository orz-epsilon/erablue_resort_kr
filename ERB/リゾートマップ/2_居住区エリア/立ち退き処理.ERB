@立ち退き処理
#DIM ループ用
#DIM 定住者一覧, 500
#DIM ページ数
#DIM 配列番号
#DIM 選択定住者番号
#DIM 動作モード ;0:定住立ち退き 1:同棲解除
#DIM 降順ソート用配列, 200
#DIM 降順ソート用番号配列, 200
#DIMS Arrays = "降順ソート用配列", "降順ソート用番号配列"

VARSET 定住者一覧

DRAWLINE
PRINTL 정착자를 퇴거시킵니다.
PRINTL 퇴거시킨 캐릭터는 호감도 요소: 우정 및 신뢰도가 크게 하락하므로 주의하십시오.
PRINTL
DRAWLINE
IF 動作モード
	SETCOLOR カラーパレット("グレーアウト")
	PRINTBUTTON "[정착자를 퇴거시키기]", 1003
	RESETCOLOR
	PRINT  / 
	PRINTPLAIN [동거를 해제한다]
ELSE
	PRINTPLAIN [정착자를 퇴거시키기]
	PRINT  / 
	SETCOLOR カラーパレット("グレーアウト")
	PRINTBUTTON "[동거를 해제한다]", 1003
	RESETCOLOR
ENDIF
PRINTL
DRAWLINE

IF 動作モード == 0
	;現在いる定住者を一覧表示
	LOCAL:1 = 0

	FOR LOCAL, 0, VARSIZE("定住者部屋割り配列")
		SIF 定住者部屋割り配列:LOCAL == ""
			CONTINUE
		;部屋の居住者を配列へ
		VARSET RESULTS
		SPLIT 定住者部屋割り配列:LOCAL, "_", RESULTS
		FOR 配列番号, 0, RESULT
			IF ISNUMERIC(RESULTS:配列番号)
				定住者一覧:(LOCAL:1) = TOINT(RESULTS:配列番号)
				LOCAL:1 += 1
			ENDIF
		NEXT
	NEXT
ELSE
	;現在いる同棲相手を一覧表示
	LOCAL:1 = 0

	FOR 配列番号, 0, VARSIZE("同棲部屋割り配列")
		;一部屋ずつ見て突っ込む
		IF 同棲部屋割り配列:配列番号 > 0
			定住者一覧:(LOCAL:1) = 同棲部屋割り配列:配列番号
			LOCAL:1 += 1
		ENDIF
	NEXT
ENDIF

LOCALS = <div rect='81,31,1937,2812' border='31' bcolor='#C0C0C0'></div><div rect='2050,31,3875,2812' border='31' bcolor='#C0C0C0'></div>
LOCALS += "<div rect='156,156,1937,2812'>"
FOR LOCAL, ページ数 * 17, ページ数 * 17 + 17
	IF 定住者一覧:LOCAL < 1
		LOCALS += "<br>"
		CONTINUE
	ENDIF
	IF CFLAG:(定住者一覧:LOCAL):定住追い出しフラグ
		LOCALS += @"<font color='#%カラーパレット_HTML("グレーアウト")%'>%CALLNAME:(定住者一覧:LOCAL), 16, LEFT%　호감도Lv:{CFLAG:(定住者一覧:LOCAL):好感度レベル, 3}　"
		IF TALENT:(定住者一覧:LOCAL):恋慕
			LOCALS += @"<font color='#%カラーパレット_HTML("えっちな色")%'>연</font>"
		ELSEIF TALENT:(定住者一覧:LOCAL):セフレ
			LOCALS += @"<font color='#%カラーパレット_HTML("ピンク")%'>세</font>"
		ENDIF
		LOCALS += "</font>"
	ELSE
		LOCALS += @"<button value='{LOCAL}'>%CALLNAME:(定住者一覧:LOCAL), 16, LEFT%　호감도Lv:{CFLAG:(定住者一覧:LOCAL):好感度レベル, 3}　"
		IF TALENT:(定住者一覧:LOCAL):恋慕
			LOCALS += @"<font color='#%カラーパレット_HTML("えっちな色")%'>연</font>"
		ELSEIF TALENT:(定住者一覧:LOCAL):セフレ
			LOCALS += @"<font color='#%カラーパレット_HTML("ピンク")%'>세</font>"
		ENDIF
		LOCALS += "</button>"
	ENDIF
	LOCALS += "<br>"
NEXT
IF ページ数 > 0
	LOCALS += "<button value='1001'>　＜ 이전 페이지</button>"
ELSE
	LOCALS += "　　　　　　　 "
ENDIF
LOCALS += "　　　　"
IF 定住者一覧:(ページ数 * 17 + 17) > 0
	LOCALS += "<button value='1002'>다음 페이지 ＞</button>"
ENDIF
LOCALS += "<br>"
LOCALS += "<br>"
LOCALS += "<button value='999'>[999] 돌아가기</button>"
LOCALS += "</div>"

LOCALS += "<div rect='2125,156,3675,2812'>"
IF 選択定住者番号 > -1
	LOCALS += @"■%NAME表示(定住者一覧:選択定住者番号), 26, LEFT%"
	LOCALS:1 = %属性数値文字色変換_HTML(基礎BATTLE_STATE:(定住者一覧:選択定住者番号):属性)%
	LOCALS += @"<font color='#%LOCALS:1%'>속성：%属性数値文字列変換(基礎BATTLE_STATE:(定住者一覧:選択定住者番号):属性)%</font>"
	LOCALS += @"　특기 무기：%得意武器表示文字列(基礎BATTLE_STATE:(定住者一覧:選択定住者番号):得意武器)%"
	SIF 基礎BATTLE_STATE:(定住者一覧:選択定住者番号):ステータスタイプ保存 > -1
		LOCALS += @"　타입：%成長タイプ:(基礎BATTLE_STATE:(定住者一覧:選択定住者番号):ステータスタイプ保存)%"
	LOCALS += "<br><br>"
	LOCALS += "□ 정보 □---------------------------------------------------------------<br>"
	LOCALS += @"　종족：%GET_TALENTNAME(200, TALENT:(定住者一覧:選択定住者番号):種族,,定住者一覧:選択定住者番号)%"
	IF TALENT:(定住者一覧:選択定住者番号):エルーン耳
		LOCALS += "（엘룬 귀）"
	ENDIF
	IF TALENT:(定住者一覧:選択定住者番号):尻尾あり
		LOCALS += "（꼬리）"
	ENDIF
	IF TALENT:(定住者一覧:選択定住者番号):角あり
		LOCALS += "（뿔 있음）"
	ENDIF
	IF TALENT:(定住者一覧:選択定住者番号):ハーヴィン耳
		LOCALS += "（하빈 귀）"
	ENDIF
	LOCALS += "<br>"
	LOCALS += "　성별："
	SELECTCASE TALENT:(定住者一覧:選択定住者番号):性別
		CASE 1
			LOCALS += "여성"
			IF TALENT:(定住者一覧:選択定住者番号):処女 == 0
				LOCALS += "　　　　　　　　　"
			ELSE
				LOCALS += "（처녀）　　　　　"
			ENDIF
		CASE 3
			LOCALS += "후타나리"
			IF TALENT:(定住者一覧:選択定住者番号):処女 == 0
				LOCALS += "　　　　"
			ELSE
				LOCALS += "（처녀）"
			ENDIF
			IF TALENT:(定住者一覧:選択定住者番号):非童貞 == 1
				LOCALS += "　　　　　"
			ELSE
				LOCALS += "（동정）　"
			ENDIF
	ENDSELECT
	LOCALS += @"가슴 사이즈：%GET_TALENTNAME(205, TALENT:(定住者一覧:選択定住者番号):バストサイズ,,定住者一覧:選択定住者番号)%"
	LOCALS += "<br>"
	LOCALS += @"　성지식 레벨：%性知識段階表示(知識素質:(定住者一覧:選択定住者番号):性知識, 定住者一覧:選択定住者番号)%"
	IF TALENT:(定住者一覧:選択定住者番号):ランダムキャラ
		LOCALS += @"<br>　용모：%GET_TALENTNAME(160, TALENT:(定住者一覧:選択定住者番号):容姿,,定住者一覧:選択定住者番号)%　　"
		LOCALS += @"체격：%GET_TALENTNAME(161,TALENT:(定住者一覧:選択定住者番号):体格,,定住者一覧:選択定住者番号)%"
		IF TALENT:(定住者一覧:選択定住者番号):性別 == 3
			LOCALS += @"<br>　남성기 사이즈：%GET_TALENTNAME(162, TALENT:(定住者一覧:選択定住者番号):男性器サイズ,,定住者一覧:選択定住者番号)%"
		ENDIF
	ENDIF
	LOCALS += "<br>"
	LOCALS += "<br>"
	LOCALS += "□ 소질 □---------------------------------------------------------------<br>"
	
	FOR ループ用,8,160
		IF STRLENS(GET_TALENTNAME(ループ用,TALENT:(定住者一覧:選択定住者番号):ループ用, 0,定住者一覧:選択定住者番号))
			LOCALS += @"[%GET_TALENTNAME(ループ用,TALENT:(定住者一覧:選択定住者番号):ループ用, 0, 定住者一覧:選択定住者番号)%]"
		ENDIF
	NEXT
	FOR ループ用,220,300
		IF STRLENS(GET_TALENTNAME(ループ用,TALENT:(定住者一覧:選択定住者番号):ループ用,,定住者一覧:選択定住者番号))
			LOCALS += @"[%GET_TALENTNAME(ループ用,TALENT:(定住者一覧:選択定住者番号):ループ用,,定住者一覧:選択定住者番号)%]"
		ENDIF
	NEXT
	FOR ループ用,1,100
		IF 知識素質:(定住者一覧:選択定住者番号):ループ用
			LOCALS += @"[%ERDNAME(知識素質,ループ用)%Lv{知識素質:(定住者一覧:選択定住者番号):ループ用}]"
		ENDIF
	NEXT

	LOCALS += "<br>"
	LOCALS += "<br>"
	LOCALS += "□ 능력 □---------------------------------------------------------------<br>"
	LOCAL:1 = 0
	LOCAL:2 = 0
	VARSET 降順ソート用配列
	VARSET 降順ソート用番号配列
	FOR LOCAL, 0, 40
		SIF LOCAL >= 21 && LOCAL <= 27
			CONTINUE
		IF ABL:(定住者一覧:選択定住者番号):LOCAL > 0
			降順ソート用配列:(LOCAL:1) = ABL:(定住者一覧:選択定住者番号):LOCAL
			降順ソート用番号配列:(LOCAL:1) = LOCAL
			LOCAL:1 += 1
		ENDIF
	NEXT
	ARRAYMSORTEX 降順ソート用配列, Arrays, 0
	
	FOR LOCAL, 0, 6
		IF 降順ソート用配列:LOCAL < 1
			SIF LOCAL:2
				LOCALS += "<br>"
			BREAK
		ENDIF
		LOCALS += @"%ABLNAME:(降順ソート用番号配列:LOCAL), 16%:{ABL:(定住者一覧:選択定住者番号):(降順ソート用番号配列:LOCAL), 2}   "
		LOCAL:2 += 1
		IF LOCAL == 5
			LOCALS += "그 외<br>"
		ELSEIF LOCAL:2 == 3
			LOCALS += "<br>"
			LOCAL:2 = 0
		ENDIF
	NEXT
	LOCALS += "<br>"
	LOCALS += "□ 경험 □---------------------------------------------------------------<br>"
	LOCAL:1 = 0
	LOCAL:2 = 0
	VARSET 降順ソート用配列
	VARSET 降順ソート用番号配列
	FOR LOCAL, 0, 95
		SIF LOCAL == 89
			CONTINUE
		IF EXP:(定住者一覧:選択定住者番号):LOCAL > 0
			降順ソート用配列:(LOCAL:1) = EXP:(定住者一覧:選択定住者番号):LOCAL
			降順ソート用番号配列:(LOCAL:1) = LOCAL
			LOCAL:1 += 1
		ENDIF
	NEXT
	ARRAYMSORTEX 降順ソート用配列, Arrays, 0
	
	FOR LOCAL, 0, 6
		IF 降順ソート用配列:LOCAL < 1
			SIF LOCAL:2
				LOCALS += "<br>"
			BREAK
		ENDIF
		LOCALS += @"%GET_EXPNAME(降順ソート用番号配列:LOCAL, 定住者一覧:選択定住者番号), 16%:{EXP:(定住者一覧:選択定住者番号):(降順ソート用番号配列:LOCAL), 3}   "
		LOCAL:2 += 1
		IF LOCAL == 5
			LOCALS += "그 외<br>"
		ELSEIF LOCAL:2 == 3
			LOCALS += "<br>"
			LOCAL:2 = 0
		ENDIF
	NEXT
	LOCALS += "<br>"
	LOCALS += "<br>"
	LOCALS += "<button value='1000'>[1000]이 캐릭터를 퇴거시킨다</button>"
ENDIF
LOCALS += "</div>"

HTML_PRINT LOCALS
FOR LOCAL, 0, 25
	PRINTL
NEXT
DRAWLINE

BINPUT
LOCAL = RESULT
SELECTCASE LOCAL
	CASE 0 TO 499
		選択定住者番号 = LOCAL
		RESTART
	CASE 999
		選択定住者番号 = -1
		ページ数 = 0
		RETURN 0
	CASE 1001
		ページ数 -= 1
		RESTART
	CASE 1002
		ページ数 += 1
		RESTART
	CASE 1003
		INVERTBIT 動作モード, 0
		RESTART
	CASE 1000
		PRINTL
		IF 動作モード == 0
			PRINTFORML 정말로 %NAME表示((定住者一覧:選択定住者番号))%을(를) 퇴거시키겠습니까?
		ELSE
			PRINTFORML 정말로 %NAME表示((定住者一覧:選択定住者番号))%와의 동거를 해제하시겠습니까?
		ENDIF
		PRINTBUTTON "[0]예", 0
		PRINTL
		PRINTBUTTON "[1]아니요", 1
		PRINTL
		BINPUT
		SELECTCASE RESULT
			CASE 0
				CALL 立ち退き実処理(定住者一覧:選択定住者番号, 動作モード)
				選択定住者番号 = -1
				RESTART
			CASE 1
				RESTART
		ENDSELECT
ENDSELECT


@立ち退き実処理(キャラ番号, 動作モード)
#DIM キャラ番号
#DIM ループ用
#DIM 要素最大値
#DIM 配列番号
#DIM 計算後レベル
#DIM 部屋割り成功フラグ
#DIM 動作モード ;0:定住立ち退き 1:同棲解除

IF TALENT:キャラ番号:定住者 < 1
	PRINTFORMW %CALLNAME:キャラ番号%은(는) 정주자가 아닙니다.
	RETURN -1
ENDIF

; IF なんか立ち退き不可の条件があったら後からここに付け足す
; 	PRINTFORMW %CALLNAME:キャラ番号%は立ち退きできません。
; 	RETURN 0
; ENDIF

IF 動作モード
	PRINTFORML %NAME表示(キャラ番号)%와의 동거를 해제했습니다.
ELSE
	PRINTFORML %NAME表示(キャラ番号)%을(를) 퇴거시켰습니다.
ENDIF
TRYCALLFORM KOJO_EVENT_立ち退き_{NO:キャラ番号}(キャラ番号)

IF TALENT:キャラ番号:従業員
	部屋割り成功フラグ = 0
	FOR LOCAL, 0, 従業員部屋数
		IF 従業員部屋割り配列:LOCAL < 1
			CALL 滞在者部屋割り配列削除処理(キャラ番号)
			TALENT:キャラ番号:定住者 = 0
			従業員部屋割り配列:LOCAL = キャラ番号
			部屋割り成功フラグ = 1
			PRINTL 직원 방으로 이동합니다.
			PRINTL
			FOR 配列番号, 0, VARSIZE("同棲部屋割り配列")
				IF 同棲部屋割り配列:配列番号 == キャラ番号
					同棲部屋割り配列:配列番号 = 0
					BREAK
				ENDIF
			NEXT
			BREAK
		ENDIF
	NEXT
	IF 部屋割り成功フラグ == 0
		;追い出しフラグを建てて翌日に出ていく
		IF STRFIND(NAME:キャラ番号, "[従業員]") > -1
			NAME:キャラ番号 = [一般人]%CALLNAME:キャラ番号%
		ENDIF
		現在仕事:キャラ番号:0 = 0
		現在仕事:キャラ番号:1 = 0
		現在制服:キャラ番号:0 = 0
		CFLAG:キャラ番号:招待不可フラグ = 0
		CALL 従業員人数チェック()
		PRINTL 직원 방이 가득 차서 해고했습니다.
		PRINTL 다음 날 방에서 나갑니다.
		PRINTL
		CFLAG:キャラ番号:定住追い出しフラグ = 1
	ENDIF
ELSE
	;追い出しフラグを建てて翌日に出ていく
	PRINTL 다음 날 방에서 나갑니다.
	PRINTL
	CFLAG:キャラ番号:定住追い出しフラグ = 1
ENDIF

;信頼度低下30000
CFLAG:キャラ番号:信頼度 = MAX(CFLAG:キャラ番号:信頼度 - 30000, 0)
CFLAG:キャラ番号:友情度 = MAX(CFLAG:キャラ番号:友情度 - 30000, 0)
PRINTFORML %CALLNAME:キャラ番号%의 우정・신뢰도가 하락했습니다…
;好感度レベルの再計算

要素最大値 = MAX(CFLAG:キャラ番号:友情度, CFLAG:キャラ番号:信頼度, CFLAG:キャラ番号:恋心度, CFLAG:キャラ番号:性愛度)
FOR ループ用, 0, 100
	IF 経験値テーブル:ループ用 >= 要素最大値
		BREAK
	ENDIF
NEXT
計算後レベル = ループ用

IF CFLAG:キャラ番号:好感度レベル > 計算後レベル
	IF あなた特殊能力:フレンドリーセンス
		PRINTFORML %CALLNAME:キャラ番号%의 호감도 레벨이 {CFLAG:キャラ番号:好感度レベル - 計算後レベル} 하락했습니다…
	ELSE
		PRINTFORML %CALLNAME:キャラ番号%의 호감도 레벨이 하락했습니다…
	ENDIF
	CFLAG:キャラ番号:好感度レベル = 計算後レベル
ENDIF

CALL ユニーク客人数チェック()

WAIT
RETURN 1
