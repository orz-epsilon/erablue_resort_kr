;-------------------------------------------------
;唇でリップマッサージ
;-------------------------------------------------
@MASSAGE_COMNAME30
#FUNCTIONS
TSTR:コマンド名受渡 = 입술로 립 마사지


;===================================================
;コマンドタイプ
;===================================================
@MASSAGE_COMTYPE_30
#FUNCTION
TFLAG:コマンドタイプ受渡 = MASSAGE_COMTYPE("エロマッサージ")

@MASSAGE_COM_TOOLTIP_30
LOCALS = <br>■입술로 립 마사지<br>
LOCALS += "키스 모드에는 돌입하지 않는 단발 커맨드."
LOCALS += "손님의 입술을, 똑같이 부드럽고 섬세한 시술 도구──즉 당신의 입술로 『마사지』해 준다."
LOCALS += "<br>어디까지나 이것은 마사지이지 키스가 아니므로, 따라서 바람 같은 것도 아닐 것이다."
LOCALS += "<br>COM 타입: 에로 마사지<br>획득 소스: 노출・접촉・쾌S・불결・고통(일정 조건 시)"
LOCALS += "<br>고유 획득 경험: 키스 경험(PLAYER＆TARGET)<br>"
TSTR:ツールチップ受渡 = %LOCALS%

@MASSAGE_COM30
;-------------------------------------------------
;ソース追加処理
;-------------------------------------------------

;基盤ができたあとで理性を削る処理を入れる

;誰がどう見たってただのキスなので、キスのコマンドからそのまま持ってきた。
;どう考えてもマッサージじゃないので歓楽は上がらない

;舌を使う調教では、調教者の舌使いによって、快感のソース増加
IF TALENT:PLAYER:舌使い
	CALL SOURCE_CALC_接触(TARGET, PLAYER, 50)
ENDIF

IF TALENT:TARGET:舌使い
	CALL SOURCE_CALC_快Ｓ(PLAYER, TARGET, 150)
ENDIF

;猫舌では減少
SIF TALENT:PLAYER:猫舌
	CALL SOURCE_CALC_苦痛(TARGET, PLAYER, 20)

;同性愛
SIF 同性愛性癖判定(PLAYER,TARGET)
	EXP:PLAYER:同性愛経験 += 3
SIF 同性愛性癖判定(TARGET,PLAYER)
	EXP:TARGET:同性愛経験 += 3

SIF TALENT:恋慕
	EXP:愛情経験 += 1

SIF TALENT:TARGET:猫舌
	EXP:嗜虐快楽経験 += 1

CALL SOURCE_CALC_快Ｓ(TARGET, PLAYER, 150)
CALL SOURCE_CALC_快Ｓ(PLAYER, TARGET, 150)
IF TALENT:PLAYER:舌使い
	CALL SOURCE_CALC_快Ｓ(TARGET, PLAYER, 150)
ENDIF

IF BASE:TARGET:理性 <= 1
;理性がおしまいになってしまった場合、快楽に流されて警戒が下がっていく。
	BASE:TARGET:性欲 += 40
	BASE:TARGET:警戒 += 警戒変動値算出(TARGET, -40)
	CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 100)

ELSEIF 知識素質:TARGET:性知識 <= -1
;性知識がない場合でも「流石にこれはダメなやつなのでは？」と思いはじめる。が、まぁいいかとなる。
;心地いいので警戒と理性は下がり続ける。
	BASE:TARGET:理性 += 理性変動値算出(TARGET, -50)
	BASE:TARGET:性欲 += 20
	BASE:TARGET:警戒 += 警戒変動値算出(TARGET, -30)
	CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 80)

ELSEIF (BASE:TARGET:理性 + BASE:TARGET:警戒) < 400
;実行に際し十分な理性・警戒削りがなされている場合。
;激しい快楽はないが、浮つくような心地の中で唇を奪われて抵抗する気持ちがうまく芽生えない状態。100警戒してるはずなのに、100絆されてプラマイゼロ。
	BASE:TARGET:理性 += 理性変動値算出(TARGET, -100)
	BASE:TARGET:性欲 += 40
	BASE:TARGET:警戒 +=警戒変動値算出(TARGET, 100)
	CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 80)
ELSE
;実行に際し十分な理性・警戒削りがなされていない場合。
;どう言い訳しようとキスであることは間違いないので警戒と理性が跳ねる。
	BASE:TARGET:理性 +=理性変動値算出(TARGET, 125)
	BASE:TARGET:性欲 += 40
	BASE:TARGET:警戒 +=警戒変動値算出(TARGET, 250)
	CALL SOURCE_CALC_好感度要素_性愛度UP(TARGET, PLAYER, 50)
ENDIF

IF TARGET == MASTER
	CALL ちんイラ増加処理(PLAYER, 150)
ELSE
	CALL ちんイラ増加処理(TARGET, 300)
ENDIF

;-------------------------------------------------
;経験の処理
;-------------------------------------------------

CALL 初体験日登録処理(PLAYER, TARGET, "ファーストキス", DAY * 1440 + TIME, GETPLACENAME(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置), "唇", "", 1)
IF RESULT
	RCVAR:PLAYER:ファーストキス中フラグ = 1
	CALL 履歴データベース登録(CFLAG:PLAYER:人物番号, @"<font color='#%カラーパレット_HTML("薄ピンク")%'>エステ中に%CALLNAME:TARGET%の[唇]にファーストキスを捧げた</font><img src='えっちハート'>","うふふ")
ENDIF

CALL 初体験日登録処理(TARGET, PLAYER, "ファーストキス", DAY * 1440 + TIME, GETPLACENAME(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置), "唇", "", 0)
IF RESULT
	RCVAR:TARGET:ファーストキス中フラグ = 1
	CALL 履歴データベース登録(CFLAG:TARGET:人物番号, @"<font color='#%カラーパレット_HTML("薄ピンク")%'>エステ中に%CALLNAME:PLAYER%の[唇]にファーストキスを奪われた</font><img src='えっちハート'>","うふふ")
ENDIF
CALL 初体験日登録処理(PLAYER, TARGET, "キス", DAY * 1440 + TIME, GETPLACENAME(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置), "唇", "", 0)
CALL 初体験日登録処理(TARGET, PLAYER, "キス", DAY * 1440 + TIME, GETPLACENAME(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置), "唇", "", 0)


;-------------------------------------------------
;実行判定
;-------------------------------------------------

@MASSAGE_COM_ABLE30
SIF SAVESTR:ゲームフェイズ管理 != "マッサージモード"
	RETURN 0

SIF GLOBAL_MASSAGE_COMABLE(30)
	RETURN RESULT

;キスモードには入らない単発コマンド

;うつ伏せだとダメ
SIF TCVAR:TARGET:マッサージ_うつ伏せフラグ == 1
	RETURN 0

;理性警戒の合計が700以下じゃないとダメ
;実行自体はできるが、この時点だと警戒と理性が跳ねる。されるがままになっちゃうのは合計値400以下くらいを想定。
SIF (BASE:TARGET:理性 + BASE:TARGET:警戒) > 700
	RETURN 0


RETURN 1

;-------------------------------------------------
;実行時メッセージ
;-------------------------------------------------
@MASSAGE_MESSAGE_COM30

PRINTFORM %CALLNAME:PLAYER%은(는)%TEXTR("「이건 마사지니까」라고 속여서/「이건 마사지다」라고 강변으로 밀어붙여서/마사지를 핑계 삼아")%、
PRINTFORML %CALLNAME:TARGET%%TEXTR("와 입술을 포개었다/의 입술을 빼앗았다/의 입술을 만끽했다/의 달콤한 입술을 빨았다/의 입술에 달라붙었다/의 입술을 핥았다/와의 키스를 만끽했다")%…

;削りが十分な時は追加のメッセージ
IF (BASE:TARGET:理性 + BASE:TARGET:警戒) < 400
	PRINTW 
	PRINTFORM %CALLNAME:TARGET%은(는)%TEXTR("황홀하게 눈가를 녹이며/녹아내린 얼굴로 헤프게 입을 벌리고/법열에 눈가를 녹이며")%、
	PRINTFORML %CALLNAME:PLAYER%%TEXTR("에게 입술을 내밀고 있다/스스로도 입술을 바치고 있다/와의 키스에 취해 있다/에게 당하는 대로 되어 있다/의 키스를 받아들이고 있다/의 키스를 감수하고 있다/와의 키스에 몰두하고 있다")%…
ENDIF
